"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate/route";
exports.ids = ["app/api/generate/route"];
exports.modules = {

/***/ "bcrypt":
/*!*************************!*\
  !*** external "bcrypt" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bcrypt");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "@libsql/client":
/*!*********************************!*\
  !*** external "@libsql/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = import("@libsql/client");;

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_bytedance_Desktop_nababa_dress_src_app_api_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/generate/route.ts */ \"(rsc)/./src/app/api/generate/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_bytedance_Desktop_nababa_dress_src_app_api_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_Users_bytedance_Desktop_nababa_dress_src_app_api_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate/route\",\n        pathname: \"/api/generate\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate/route\"\n    },\n    resolvedPagePath: \"/Users/bytedance/Desktop/nababa-dress/src/app/api/generate/route.ts\",\n    nextConfigOutput,\n    userland: _Users_bytedance_Desktop_nababa_dress_src_app_api_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZ2VuZXJhdGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZnZW5lcmF0ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmJ5dGVkYW5jZSUyRkRlc2t0b3AlMkZuYWJhYmEtZHJlc3MlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGYnl0ZWRhbmNlJTJGRGVza3RvcCUyRm5hYmFiYS1kcmVzcyZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDbUI7QUFDaEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uYWJhYmEtZHJlc3MvP2ZjM2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2J5dGVkYW5jZS9EZXNrdG9wL25hYmFiYS1kcmVzcy9zcmMvYXBwL2FwaS9nZW5lcmF0ZS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9nZW5lcmF0ZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvZ2VuZXJhdGUvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYnl0ZWRhbmNlL0Rlc2t0b3AvbmFiYWJhLWRyZXNzL3NyYy9hcHAvYXBpL2dlbmVyYXRlL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9nZW5lcmF0ZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/generate/route.ts":
/*!***************************************!*\
  !*** ./src/app/api/generate/route.ts ***!
  \***************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/next */ \"(rsc)/./node_modules/next-auth/next/index.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/dao/user-dao */ \"(rsc)/./src/lib/dao/user-dao.ts\");\n/* harmony import */ var _lib_dao_credits_dao__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/dao/credits-dao */ \"(rsc)/./src/lib/dao/credits-dao.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v4/classic/schemas.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_auth__WEBPACK_IMPORTED_MODULE_2__, _lib_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _lib_dao_credits_dao__WEBPACK_IMPORTED_MODULE_4__]);\n([_lib_auth__WEBPACK_IMPORTED_MODULE_2__, _lib_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__, _lib_dao_credits_dao__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\nconst generateSchema = zod__WEBPACK_IMPORTED_MODULE_5__.object({\n    userImage: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(1, \"请上传用户照片\"),\n    clothingImages: zod__WEBPACK_IMPORTED_MODULE_5__.array(zod__WEBPACK_IMPORTED_MODULE_5__.string()).min(1, \"请至少上传一件服装图片\"),\n    generationType: zod__WEBPACK_IMPORTED_MODULE_5__[\"enum\"]([\n        \"single\",\n        \"batch\"\n    ]).default(\"single\")\n});\n// APIcore AI 配置\nconst APICORE_AI_URL = \"https://kg-api.cloud/v1/chat/completions\";\nconst APICORE_AI_KEY = process.env.APICORE_AI_KEY || \"sk-yUPD9rfqfCrhxVzwmadPNlR3dtQ67PqWshJVgYihz8EWWU8D\";\n// 换衣专业Prompt模板\nconst generateTryOnPrompt = (clothingCount = 1)=>{\n    const basePrompt = `请将用户照片中的人物换上新的服装，要求：\n1. 保持人物的面部特征、发型、体型和姿态完全不变\n2. 服装要自然贴合人物身形，考虑光影和褶皱效果  \n3. 保持原照片的背景、光线和整体氛围\n4. 生成真实感强的穿着效果，避免违和感\n5. 确保服装的材质、颜色和细节准确还原`;\n    const multiplePrompt = clothingCount > 1 ? `\\n6. 请为这一个人物分别生成穿着每件不同服装的效果图，每张图保持人物一致性` : \"\";\n    return basePrompt + multiplePrompt;\n};\n// 调用APIcore AI接口\nasync function callApicoreAI(userImage, clothingImages, retryCount = 0) {\n    const prompt = generateTryOnPrompt(clothingImages.length);\n    // 构建消息内容\n    const messageContent = [\n        {\n            type: \"text\",\n            text: prompt\n        },\n        {\n            type: \"image_url\",\n            image_url: {\n                url: userImage.startsWith(\"data:\") ? userImage : `data:image/jpeg;base64,${userImage}`\n            }\n        }\n    ];\n    // 添加服装图片\n    clothingImages.forEach((clothingImage)=>{\n        messageContent.push({\n            type: \"image_url\",\n            image_url: {\n                url: clothingImage.startsWith(\"data:\") ? clothingImage : `data:image/jpeg;base64,${clothingImage}`\n            }\n        });\n    });\n    const requestBody = {\n        model: \"gemini-2.5-flash-image\",\n        messages: [\n            {\n                role: \"user\",\n                content: messageContent\n            }\n        ],\n        max_tokens: 500\n    };\n    try {\n        console.log(`AI生成请求开始 (重试次数: ${retryCount})`);\n        const response = await fetch(APICORE_AI_URL, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": `Bearer ${APICORE_AI_KEY}`\n            },\n            body: JSON.stringify(requestBody),\n            // 60秒超时\n            signal: AbortSignal.timeout(60000)\n        });\n        if (!response.ok) {\n            throw new Error(`API调用失败: ${response.status} ${response.statusText}`);\n        }\n        const result = await response.json();\n        console.log(\"AI生成响应:\", result);\n        if (!result.choices || !result.choices[0] || !result.choices[0].message) {\n            throw new Error(\"API返回格式异常\");\n        }\n        const content = result.choices[0].message.content;\n        // 提取图片URL（从markdown格式中提取）\n        const imageUrlRegex = /!\\[.*?\\]\\((https?:\\/\\/[^\\)]+)\\)/g;\n        const matches = [];\n        let match;\n        while((match = imageUrlRegex.exec(content)) !== null){\n            matches.push(match[1]);\n        }\n        if (matches.length === 0) {\n            throw new Error(\"未从AI响应中提取到图片URL\");\n        }\n        console.log(`成功生成 ${matches.length} 张图片`);\n        return matches;\n    } catch (error) {\n        console.error(`AI生成失败 (重试次数: ${retryCount}):`, error);\n        // 重试机制：失败后立即重试最多2次\n        if (retryCount < 2) {\n            console.log(`准备重试 ${retryCount + 1}/2`);\n            return await callApicoreAI(userImage, clothingImages, retryCount + 1);\n        }\n        throw error;\n    }\n}\nasync function POST(request) {\n    try {\n        // 检查用户是否登录\n        const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session?.user?.id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"请先登录\"\n            }, {\n                status: 401\n            });\n        }\n        const userId = parseInt(session.user.id);\n        const body = await request.json();\n        // 验证输入数据\n        const validationResult = generateSchema.safeParse(body);\n        if (!validationResult.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"输入数据无效\",\n                errors: validationResult.error.issues\n            }, {\n                status: 400\n            });\n        }\n        const { userImage, clothingImages, generationType } = validationResult.data;\n        // 获取用户信息\n        const user = await _lib_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO.findUserById(userId);\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"用户不存在\"\n            }, {\n                status: 404\n            });\n        }\n        // 检查用户等级权限\n        const clothingCount = clothingImages.length;\n        const userLevel = user.user_level;\n        if (userLevel === \"free\" && clothingCount > 1) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"Free用户只能上传1件服装图片，请升级到Plus或Pro\"\n            }, {\n                status: 403\n            });\n        }\n        if (userLevel === \"plus\" && clothingCount > 3) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"Plus用户最多上传3件服装图片，请升级到Pro\"\n            }, {\n                status: 403\n            });\n        }\n        if (userLevel === \"pro\" && clothingCount > 10) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"Pro用户最多上传10件服装图片\"\n            }, {\n                status: 403\n            });\n        }\n        // 计算积分消耗\n        const isBatchGeneration = clothingCount > 1 && userLevel === \"pro\";\n        const requiredCredits = isBatchGeneration ? 20 : 2;\n        // 检查积分余额\n        if (user.credits < requiredCredits) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: `积分不足，需要${requiredCredits}积分，当前余额${user.credits}积分`,\n                requiredCredits,\n                currentCredits: user.credits\n            }, {\n                status: 402\n            });\n        }\n        // 先扣除积分（失败时会退还）\n        await _lib_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO.updateUserCredits(userId, -requiredCredits);\n        // 记录生成任务开始\n        const generationRecord = await _lib_dao_credits_dao__WEBPACK_IMPORTED_MODULE_4__.CreditsDAO.createGenerationHistory(userId, requiredCredits, clothingCount, isBatchGeneration ? \"batch\" : \"single\");\n        try {\n            console.log(`开始AI生成：用户${userId}, 服装数量${clothingCount}, 类型${isBatchGeneration ? \"批量\" : \"单次\"}`);\n            // 调用AI接口生成图片\n            const resultImages = await callApicoreAI(userImage, clothingImages);\n            // 更新生成记录为成功\n            await _lib_dao_credits_dao__WEBPACK_IMPORTED_MODULE_4__.CreditsDAO.updateGenerationStatus(generationRecord.id, \"completed\");\n            console.log(`AI生成成功：用户${userId}, 生成${resultImages.length}张图片`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: `生成成功！消耗${requiredCredits}积分`,\n                data: {\n                    images: resultImages,\n                    creditsUsed: requiredCredits,\n                    generationType: isBatchGeneration ? \"batch\" : \"single\",\n                    generatedCount: resultImages.length\n                }\n            });\n        } catch (error) {\n            console.error(\"AI生成最终失败:\", error);\n            // 退还积分\n            await _lib_dao_user_dao__WEBPACK_IMPORTED_MODULE_3__.UserDAO.updateUserCredits(userId, requiredCredits);\n            // 更新生成记录为失败\n            await _lib_dao_credits_dao__WEBPACK_IMPORTED_MODULE_4__.CreditsDAO.updateGenerationStatus(generationRecord.id, \"failed\", error instanceof Error ? error.message : \"未知错误\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                message: \"生成失败，积分已退还。请稍后重试\",\n                error: error instanceof Error ? error.message : \"未知错误\"\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error(\"生成请求处理失败:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: \"请求处理失败，请稍后重试\"\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JKLGFBQWFoRSxNQUFNO2dCQUNyQztZQUNGO1FBRUYsRUFBRSxPQUFPd0MsT0FBTztZQUNkeEIsUUFBUXdCLEtBQUssQ0FBQyxhQUFhQTtZQUUzQixPQUFPO1lBQ1AsTUFBTWhFLHNEQUFPQSxDQUFDcUYsaUJBQWlCLENBQUNkLFFBQVFXO1lBRXhDLFlBQVk7WUFDWixNQUFNakYsNERBQVVBLENBQUN3RixzQkFBc0IsQ0FBQ0gsaUJBQWlCakIsRUFBRSxFQUFFLFVBQVVMLGlCQUFpQlgsUUFBUVcsTUFBTUwsT0FBTyxHQUFHO1lBRWhILE9BQU85RCxxREFBWUEsQ0FBQzRELElBQUksQ0FBQztnQkFDdkJhLFNBQVM7Z0JBQ1RYLFNBQVM7Z0JBQ1RLLE9BQU9BLGlCQUFpQlgsUUFBUVcsTUFBTUwsT0FBTyxHQUFHO1lBQ2xELEdBQUc7Z0JBQUVMLFFBQVE7WUFBSTtRQUNuQjtJQUVGLEVBQUUsT0FBT1UsT0FBTztRQUNkeEIsUUFBUXdCLEtBQUssQ0FBQyxhQUFhQTtRQUUzQixPQUFPbkUscURBQVlBLENBQUM0RCxJQUFJLENBQUM7WUFDdkJhLFNBQVM7WUFDVFgsU0FBUztRQUNYLEdBQUc7WUFBRUwsUUFBUTtRQUFJO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uYWJhYmEtZHJlc3MvLi9zcmMvYXBwL2FwaS9nZW5lcmF0ZS9yb3V0ZS50cz85MWRlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL25leHQnO1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2xpYi9hdXRoJztcbmltcG9ydCB7IFVzZXJEQU8gfSBmcm9tICdAL2xpYi9kYW8vdXNlci1kYW8nO1xuaW1wb3J0IHsgQ3JlZGl0c0RBTyB9IGZyb20gJ0AvbGliL2Rhby9jcmVkaXRzLWRhbyc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuY29uc3QgZ2VuZXJhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHVzZXJJbWFnZTogei5zdHJpbmcoKS5taW4oMSwgJ+ivt+S4iuS8oOeUqOaIt+eFp+eJhycpLFxuICBjbG90aGluZ0ltYWdlczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgJ+ivt+iHs+WwkeS4iuS8oOS4gOS7tuacjeijheWbvueJhycpLFxuICBnZW5lcmF0aW9uVHlwZTogei5lbnVtKFsnc2luZ2xlJywgJ2JhdGNoJ10pLmRlZmF1bHQoJ3NpbmdsZScpXG59KTtcblxuLy8gQVBJY29yZSBBSSDphY3nva5cbmNvbnN0IEFQSUNPUkVfQUlfVVJMID0gJ2h0dHBzOi8va2ctYXBpLmNsb3VkL3YxL2NoYXQvY29tcGxldGlvbnMnO1xuY29uc3QgQVBJQ09SRV9BSV9LRVkgPSBwcm9jZXNzLmVudi5BUElDT1JFX0FJX0tFWSB8fCAnc2steVVQRDlyZnFmQ3JoeFZ6d21hZFBObFIzZHRRNjdQcVdzaEpWZ1lpaHo4RVdXVThEJztcblxuLy8g5o2i6KGj5LiT5LiaUHJvbXB05qih5p2/XG5jb25zdCBnZW5lcmF0ZVRyeU9uUHJvbXB0ID0gKGNsb3RoaW5nQ291bnQgPSAxKSA9PiB7XG4gIGNvbnN0IGJhc2VQcm9tcHQgPSBg6K+35bCG55So5oi354Wn54mH5Lit55qE5Lq654mp5o2i5LiK5paw55qE5pyN6KOF77yM6KaB5rGC77yaXG4xLiDkv53mjIHkurrniannmoTpnaLpg6jnibnlvoHjgIHlj5HlnovjgIHkvZPlnovlkozlp7/mgIHlrozlhajkuI3lj5hcbjIuIOacjeijheimgeiHqueEtui0tOWQiOS6uueJqei6q+W9ou+8jOiAg+iZkeWFieW9seWSjOiktueaseaViOaenCAgXG4zLiDkv53mjIHljp/nhafniYfnmoTog4zmma/jgIHlhYnnur/lkozmlbTkvZPmsJvlm7RcbjQuIOeUn+aIkOecn+WunuaEn+W8uueahOepv+edgOaViOaenO+8jOmBv+WFjei/neWSjOaEn1xuNS4g56Gu5L+d5pyN6KOF55qE5p2Q6LSo44CB6aKc6Imy5ZKM57uG6IqC5YeG56Gu6L+Y5Y6fYDtcblxuICBjb25zdCBtdWx0aXBsZVByb21wdCA9IGNsb3RoaW5nQ291bnQgPiAxID8gXG4gICAgYFxcbjYuIOivt+S4uui/meS4gOS4quS6uueJqeWIhuWIq+eUn+aIkOepv+edgOavj+S7tuS4jeWQjOacjeijheeahOaViOaenOWbvu+8jOavj+W8oOWbvuS/neaMgeS6uueJqeS4gOiHtOaAp2AgOiAnJztcbiAgICBcbiAgcmV0dXJuIGJhc2VQcm9tcHQgKyBtdWx0aXBsZVByb21wdDtcbn07XG5cbi8vIOiwg+eUqEFQSWNvcmUgQUnmjqXlj6NcbmFzeW5jIGZ1bmN0aW9uIGNhbGxBcGljb3JlQUkodXNlckltYWdlOiBzdHJpbmcsIGNsb3RoaW5nSW1hZ2VzOiBzdHJpbmdbXSwgcmV0cnlDb3VudCA9IDApOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIGNvbnN0IHByb21wdCA9IGdlbmVyYXRlVHJ5T25Qcm9tcHQoY2xvdGhpbmdJbWFnZXMubGVuZ3RoKTtcbiAgXG4gIC8vIOaehOW7uua2iOaBr+WGheWuuVxuICBjb25zdCBtZXNzYWdlQ29udGVudDogYW55W10gPSBbXG4gICAge1xuICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgdGV4dDogcHJvbXB0XG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiAnaW1hZ2VfdXJsJyxcbiAgICAgIGltYWdlX3VybDoge1xuICAgICAgICB1cmw6IHVzZXJJbWFnZS5zdGFydHNXaXRoKCdkYXRhOicpID8gdXNlckltYWdlIDogYGRhdGE6aW1hZ2UvanBlZztiYXNlNjQsJHt1c2VySW1hZ2V9YFxuICAgICAgfVxuICAgIH1cbiAgXTtcblxuICAvLyDmt7vliqDmnI3oo4Xlm77niYdcbiAgY2xvdGhpbmdJbWFnZXMuZm9yRWFjaChjbG90aGluZ0ltYWdlID0+IHtcbiAgICBtZXNzYWdlQ29udGVudC5wdXNoKHtcbiAgICAgIHR5cGU6ICdpbWFnZV91cmwnLFxuICAgICAgaW1hZ2VfdXJsOiB7XG4gICAgICAgIHVybDogY2xvdGhpbmdJbWFnZS5zdGFydHNXaXRoKCdkYXRhOicpID8gY2xvdGhpbmdJbWFnZSA6IGBkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCR7Y2xvdGhpbmdJbWFnZX1gXG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xuICAgIG1vZGVsOiAnZ2VtaW5pLTIuNS1mbGFzaC1pbWFnZScsXG4gICAgbWVzc2FnZXM6IFtcbiAgICAgIHtcbiAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICBjb250ZW50OiBtZXNzYWdlQ29udGVudFxuICAgICAgfVxuICAgIF0sXG4gICAgbWF4X3Rva2VuczogNTAwXG4gIH07XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgQUnnlJ/miJDor7fmsYLlvIDlp4sgKOmHjeivleasoeaVsDogJHtyZXRyeUNvdW50fSlgKTtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSUNPUkVfQUlfVVJMLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7QVBJQ09SRV9BSV9LRVl9YFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcbiAgICAgIC8vIDYw56eS6LaF5pe2XG4gICAgICBzaWduYWw6IEFib3J0U2lnbmFsLnRpbWVvdXQoNjAwMDApXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSeiwg+eUqOWksei0pTogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgY29uc29sZS5sb2coJ0FJ55Sf5oiQ5ZON5bqUOicsIHJlc3VsdCk7XG5cbiAgICBpZiAoIXJlc3VsdC5jaG9pY2VzIHx8ICFyZXN1bHQuY2hvaWNlc1swXSB8fCAhcmVzdWx0LmNob2ljZXNbMF0ubWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBUEnov5Tlm57moLzlvI/lvILluLgnKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb250ZW50ID0gcmVzdWx0LmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50O1xuICAgIFxuICAgIC8vIOaPkOWPluWbvueJh1VSTO+8iOS7jm1hcmtkb3du5qC85byP5Lit5o+Q5Y+W77yJXG4gICAgY29uc3QgaW1hZ2VVcmxSZWdleCA9IC8hXFxbLio/XFxdXFwoKGh0dHBzPzpcXC9cXC9bXlxcKV0rKVxcKS9nO1xuICAgIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgICBsZXQgbWF0Y2g7XG4gICAgXG4gICAgd2hpbGUgKChtYXRjaCA9IGltYWdlVXJsUmVnZXguZXhlYyhjb250ZW50KSkgIT09IG51bGwpIHtcbiAgICAgIG1hdGNoZXMucHVzaChtYXRjaFsxXSk7XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+acquS7jkFJ5ZON5bqU5Lit5o+Q5Y+W5Yiw5Zu+54mHVVJMJyk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYOaIkOWKn+eUn+aIkCAke21hdGNoZXMubGVuZ3RofSDlvKDlm77niYdgKTtcbiAgICByZXR1cm4gbWF0Y2hlcztcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEFJ55Sf5oiQ5aSx6LSlICjph43or5XmrKHmlbA6ICR7cmV0cnlDb3VudH0pOmAsIGVycm9yKTtcbiAgICBcbiAgICAvLyDph43or5XmnLrliLbvvJrlpLHotKXlkI7nq4vljbPph43or5XmnIDlpJoy5qyhXG4gICAgaWYgKHJldHJ5Q291bnQgPCAyKSB7XG4gICAgICBjb25zb2xlLmxvZyhg5YeG5aSH6YeN6K+VICR7cmV0cnlDb3VudCArIDF9LzJgKTtcbiAgICAgIHJldHVybiBhd2FpdCBjYWxsQXBpY29yZUFJKHVzZXJJbWFnZSwgY2xvdGhpbmdJbWFnZXMsIHJldHJ5Q291bnQgKyAxKTtcbiAgICB9XG4gICAgXG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyDmo4Dmn6XnlKjmiLfmmK/lkKbnmbvlvZVcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucyk7XG4gICAgaWYgKCFzZXNzaW9uPy51c2VyPy5pZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICfor7flhYjnmbvlvZUnXG4gICAgICB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlSW50KHNlc3Npb24udXNlci5pZCk7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIFxuICAgIC8vIOmqjOivgei+k+WFpeaVsOaNrlxuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBnZW5lcmF0ZVNjaGVtYS5zYWZlUGFyc2UoYm9keSk7XG4gICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAn6L6T5YWl5pWw5o2u5peg5pWIJyxcbiAgICAgICAgZXJyb3JzOiB2YWxpZGF0aW9uUmVzdWx0LmVycm9yLmlzc3Vlc1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgeyB1c2VySW1hZ2UsIGNsb3RoaW5nSW1hZ2VzLCBnZW5lcmF0aW9uVHlwZSB9ID0gdmFsaWRhdGlvblJlc3VsdC5kYXRhO1xuICAgIFxuICAgIC8vIOiOt+WPlueUqOaIt+S/oeaBr1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyREFPLmZpbmRVc2VyQnlJZCh1c2VySWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICfnlKjmiLfkuI3lrZjlnKgnXG4gICAgICB9LCB7IHN0YXR1czogNDA0IH0pO1xuICAgIH1cblxuICAgIC8vIOajgOafpeeUqOaIt+etiee6p+adg+mZkFxuICAgIGNvbnN0IGNsb3RoaW5nQ291bnQgPSBjbG90aGluZ0ltYWdlcy5sZW5ndGg7XG4gICAgY29uc3QgdXNlckxldmVsID0gdXNlci51c2VyX2xldmVsO1xuICAgIFxuICAgIGlmICh1c2VyTGV2ZWwgPT09ICdmcmVlJyAmJiBjbG90aGluZ0NvdW50ID4gMSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGcmVl55So5oi35Y+q6IO95LiK5LygMeS7tuacjeijheWbvueJh++8jOivt+WNh+e6p+WIsFBsdXPmiJZQcm8nXG4gICAgICB9LCB7IHN0YXR1czogNDAzIH0pO1xuICAgIH1cbiAgICBcbiAgICBpZiAodXNlckxldmVsID09PSAncGx1cycgJiYgY2xvdGhpbmdDb3VudCA+IDMpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnUGx1c+eUqOaIt+acgOWkmuS4iuS8oDPku7bmnI3oo4Xlm77niYfvvIzor7fljYfnuqfliLBQcm8nXG4gICAgICB9LCB7IHN0YXR1czogNDAzIH0pO1xuICAgIH1cbiAgICBcbiAgICBpZiAodXNlckxldmVsID09PSAncHJvJyAmJiBjbG90aGluZ0NvdW50ID4gMTApIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnUHJv55So5oi35pyA5aSa5LiK5LygMTDku7bmnI3oo4Xlm77niYcnXG4gICAgICB9LCB7IHN0YXR1czogNDAzIH0pO1xuICAgIH1cblxuICAgIC8vIOiuoeeul+enr+WIhua2iOiAl1xuICAgIGNvbnN0IGlzQmF0Y2hHZW5lcmF0aW9uID0gY2xvdGhpbmdDb3VudCA+IDEgJiYgdXNlckxldmVsID09PSAncHJvJztcbiAgICBjb25zdCByZXF1aXJlZENyZWRpdHMgPSBpc0JhdGNoR2VuZXJhdGlvbiA/IDIwIDogMjtcbiAgICBcbiAgICAvLyDmo4Dmn6Xnp6/liIbkvZnpop1cbiAgICBpZiAodXNlci5jcmVkaXRzIDwgcmVxdWlyZWRDcmVkaXRzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogYOenr+WIhuS4jei2s++8jOmcgOimgSR7cmVxdWlyZWRDcmVkaXRzfeenr+WIhu+8jOW9k+WJjeS9meminSR7dXNlci5jcmVkaXRzfeenr+WIhmAsXG4gICAgICAgIHJlcXVpcmVkQ3JlZGl0cyxcbiAgICAgICAgY3VycmVudENyZWRpdHM6IHVzZXIuY3JlZGl0c1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMiB9KTtcbiAgICB9XG5cbiAgICAvLyDlhYjmiaPpmaTnp6/liIbvvIjlpLHotKXml7bkvJrpgIDov5jvvIlcbiAgICBhd2FpdCBVc2VyREFPLnVwZGF0ZVVzZXJDcmVkaXRzKHVzZXJJZCwgLXJlcXVpcmVkQ3JlZGl0cyk7XG4gICAgXG4gICAgLy8g6K6w5b2V55Sf5oiQ5Lu75Yqh5byA5aeLXG4gICAgY29uc3QgZ2VuZXJhdGlvblJlY29yZCA9IGF3YWl0IENyZWRpdHNEQU8uY3JlYXRlR2VuZXJhdGlvbkhpc3RvcnkoXG4gICAgICB1c2VySWQsXG4gICAgICByZXF1aXJlZENyZWRpdHMsXG4gICAgICBjbG90aGluZ0NvdW50LFxuICAgICAgaXNCYXRjaEdlbmVyYXRpb24gPyAnYmF0Y2gnIDogJ3NpbmdsZSdcbiAgICApO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKGDlvIDlp4tBSeeUn+aIkO+8mueUqOaItyR7dXNlcklkfSwg5pyN6KOF5pWw6YePJHtjbG90aGluZ0NvdW50fSwg57G75Z6LJHtpc0JhdGNoR2VuZXJhdGlvbiA/ICfmibnph48nIDogJ+WNleasoSd9YCk7XG4gICAgICBcbiAgICAgIC8vIOiwg+eUqEFJ5o6l5Y+j55Sf5oiQ5Zu+54mHXG4gICAgICBjb25zdCByZXN1bHRJbWFnZXMgPSBhd2FpdCBjYWxsQXBpY29yZUFJKHVzZXJJbWFnZSwgY2xvdGhpbmdJbWFnZXMpO1xuICAgICAgXG4gICAgICAvLyDmm7TmlrDnlJ/miJDorrDlvZXkuLrmiJDlip9cbiAgICAgIGF3YWl0IENyZWRpdHNEQU8udXBkYXRlR2VuZXJhdGlvblN0YXR1cyhnZW5lcmF0aW9uUmVjb3JkLmlkLCAnY29tcGxldGVkJyk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBBSeeUn+aIkOaIkOWKn++8mueUqOaItyR7dXNlcklkfSwg55Sf5oiQJHtyZXN1bHRJbWFnZXMubGVuZ3RofeW8oOWbvueJh2ApO1xuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBg55Sf5oiQ5oiQ5Yqf77yB5raI6ICXJHtyZXF1aXJlZENyZWRpdHN956ev5YiGYCxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGltYWdlczogcmVzdWx0SW1hZ2VzLFxuICAgICAgICAgIGNyZWRpdHNVc2VkOiByZXF1aXJlZENyZWRpdHMsXG4gICAgICAgICAgZ2VuZXJhdGlvblR5cGU6IGlzQmF0Y2hHZW5lcmF0aW9uID8gJ2JhdGNoJyA6ICdzaW5nbGUnLFxuICAgICAgICAgIGdlbmVyYXRlZENvdW50OiByZXN1bHRJbWFnZXMubGVuZ3RoXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0FJ55Sf5oiQ5pyA57uI5aSx6LSlOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgLy8g6YCA6L+Y56ev5YiGXG4gICAgICBhd2FpdCBVc2VyREFPLnVwZGF0ZVVzZXJDcmVkaXRzKHVzZXJJZCwgcmVxdWlyZWRDcmVkaXRzKTtcbiAgICAgIFxuICAgICAgLy8g5pu05paw55Sf5oiQ6K6w5b2V5Li65aSx6LSlXG4gICAgICBhd2FpdCBDcmVkaXRzREFPLnVwZGF0ZUdlbmVyYXRpb25TdGF0dXMoZ2VuZXJhdGlvblJlY29yZC5pZCwgJ2ZhaWxlZCcsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+acquefpemUmeivrycpO1xuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ+eUn+aIkOWksei0pe+8jOenr+WIhuW3sumAgOi/mOOAguivt+eojeWQjumHjeivlScsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICfmnKrnn6XplJnor68nXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+eUn+aIkOivt+axguWkhOeQhuWksei0pTonLCBlcnJvcik7XG4gICAgXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ+ivt+axguWkhOeQhuWksei0pe+8jOivt+eojeWQjumHjeivlSdcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdldFNlcnZlclNlc3Npb24iLCJhdXRoT3B0aW9ucyIsIlVzZXJEQU8iLCJDcmVkaXRzREFPIiwieiIsImdlbmVyYXRlU2NoZW1hIiwib2JqZWN0IiwidXNlckltYWdlIiwic3RyaW5nIiwibWluIiwiY2xvdGhpbmdJbWFnZXMiLCJhcnJheSIsImdlbmVyYXRpb25UeXBlIiwiZW51bSIsImRlZmF1bHQiLCJBUElDT1JFX0FJX1VSTCIsIkFQSUNPUkVfQUlfS0VZIiwicHJvY2VzcyIsImVudiIsImdlbmVyYXRlVHJ5T25Qcm9tcHQiLCJjbG90aGluZ0NvdW50IiwiYmFzZVByb21wdCIsIm11bHRpcGxlUHJvbXB0IiwiY2FsbEFwaWNvcmVBSSIsInJldHJ5Q291bnQiLCJwcm9tcHQiLCJsZW5ndGgiLCJtZXNzYWdlQ29udGVudCIsInR5cGUiLCJ0ZXh0IiwiaW1hZ2VfdXJsIiwidXJsIiwic3RhcnRzV2l0aCIsImZvckVhY2giLCJjbG90aGluZ0ltYWdlIiwicHVzaCIsInJlcXVlc3RCb2R5IiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwibWF4X3Rva2VucyIsImNvbnNvbGUiLCJsb2ciLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic2lnbmFsIiwiQWJvcnRTaWduYWwiLCJ0aW1lb3V0Iiwib2siLCJFcnJvciIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJyZXN1bHQiLCJqc29uIiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJpbWFnZVVybFJlZ2V4IiwibWF0Y2hlcyIsIm1hdGNoIiwiZXhlYyIsImVycm9yIiwiUE9TVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwidXNlciIsImlkIiwic3VjY2VzcyIsInVzZXJJZCIsInBhcnNlSW50IiwidmFsaWRhdGlvblJlc3VsdCIsInNhZmVQYXJzZSIsImVycm9ycyIsImlzc3VlcyIsImRhdGEiLCJmaW5kVXNlckJ5SWQiLCJ1c2VyTGV2ZWwiLCJ1c2VyX2xldmVsIiwiaXNCYXRjaEdlbmVyYXRpb24iLCJyZXF1aXJlZENyZWRpdHMiLCJjcmVkaXRzIiwiY3VycmVudENyZWRpdHMiLCJ1cGRhdGVVc2VyQ3JlZGl0cyIsImdlbmVyYXRpb25SZWNvcmQiLCJjcmVhdGVHZW5lcmF0aW9uSGlzdG9yeSIsInJlc3VsdEltYWdlcyIsInVwZGF0ZUdlbmVyYXRpb25TdGF0dXMiLCJpbWFnZXMiLCJjcmVkaXRzVXNlZCIsImdlbmVyYXRlZENvdW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/generate/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _dao_user_dao__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dao/user-dao */ \"(rsc)/./src/lib/dao/user-dao.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dao_user_dao__WEBPACK_IMPORTED_MODULE_1__]);\n_dao_user_dao__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst authOptions = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n                try {\n                    // 查找用户\n                    const user = await _dao_user_dao__WEBPACK_IMPORTED_MODULE_1__.UserDAO.findUserByEmail(credentials.email);\n                    if (!user) {\n                        return null;\n                    }\n                    // 验证密码\n                    const isValidPassword = await _dao_user_dao__WEBPACK_IMPORTED_MODULE_1__.UserDAO.verifyPassword(credentials.password, user.password_hash);\n                    if (!isValidPassword) {\n                        return null;\n                    }\n                    // 登录时不自动发放积分，改由专门的签到接口处理\n                    return {\n                        id: user.id.toString(),\n                        email: user.email,\n                        name: user.email,\n                        userLevel: user.user_level,\n                        credits: user.credits,\n                        wechatUpgraded: user.wechat_upgraded\n                    };\n                } catch (error) {\n                    console.error(\"认证失败:\", error);\n                    return null;\n                }\n            }\n        })\n    ],\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.userLevel = user.userLevel;\n                token.credits = user.credits;\n                token.wechatUpgraded = user.wechatUpgraded;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token.sub) {\n                // 每次获取session时刷新用户信息\n                try {\n                    const user = await _dao_user_dao__WEBPACK_IMPORTED_MODULE_1__.UserDAO.findUserById(parseInt(token.sub));\n                    if (user) {\n                        session.user.id = user.id.toString();\n                        session.user.userLevel = user.user_level;\n                        session.user.credits = user.credits;\n                        session.user.wechatUpgraded = user.wechat_upgraded;\n                        session.user.isPremiumUser = await _dao_user_dao__WEBPACK_IMPORTED_MODULE_1__.UserDAO.isPremiumUser(user.id);\n                        session.user.isProUser = await _dao_user_dao__WEBPACK_IMPORTED_MODULE_1__.UserDAO.isProUser(user.id);\n                    }\n                } catch (error) {\n                    console.error(\"刷新session失败:\", error);\n                }\n            }\n            return session;\n        }\n    },\n    pages: {\n        signIn: \"/auth/signin\"\n    },\n    session: {\n        strategy: \"jwt\",\n        maxAge: 30 * 24 * 60 * 60\n    },\n    secret: process.env.NEXTAUTH_SECRET\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ2tFO0FBQ3pCO0FBR2xDLE1BQU1FLGNBQStCO0lBQzFDQyxXQUFXO1FBQ1RILDJFQUFtQkEsQ0FBQztZQUNsQkksTUFBTTtZQUNOQyxhQUFhO2dCQUNYQyxPQUFPO29CQUFFQyxPQUFPO29CQUFTQyxNQUFNO2dCQUFRO2dCQUN2Q0MsVUFBVTtvQkFBRUYsT0FBTztvQkFBWUMsTUFBTTtnQkFBVztZQUNsRDtZQUNBLE1BQU1FLFdBQVVMLFdBQVc7Z0JBQ3pCLElBQUksQ0FBQ0EsYUFBYUMsU0FBUyxDQUFDRCxhQUFhSSxVQUFVO29CQUNqRCxPQUFPO2dCQUNUO2dCQUVBLElBQUk7b0JBQ0YsT0FBTztvQkFDUCxNQUFNRSxPQUFPLE1BQU1WLGtEQUFPQSxDQUFDVyxlQUFlLENBQUNQLFlBQVlDLEtBQUs7b0JBQzVELElBQUksQ0FBQ0ssTUFBTTt3QkFDVCxPQUFPO29CQUNUO29CQUVBLE9BQU87b0JBQ1AsTUFBTUUsa0JBQWtCLE1BQU1aLGtEQUFPQSxDQUFDYSxjQUFjLENBQ2xEVCxZQUFZSSxRQUFRLEVBQ3BCRSxLQUFLSSxhQUFhO29CQUdwQixJQUFJLENBQUNGLGlCQUFpQjt3QkFDcEIsT0FBTztvQkFDVDtvQkFFQSx5QkFBeUI7b0JBRXpCLE9BQU87d0JBQ0xHLElBQUlMLEtBQUtLLEVBQUUsQ0FBQ0MsUUFBUTt3QkFDcEJYLE9BQU9LLEtBQUtMLEtBQUs7d0JBQ2pCRixNQUFNTyxLQUFLTCxLQUFLO3dCQUNoQlksV0FBV1AsS0FBS1EsVUFBVTt3QkFDMUJDLFNBQVNULEtBQUtTLE9BQU87d0JBQ3JCQyxnQkFBZ0JWLEtBQUtXLGVBQWU7b0JBQ3RDO2dCQUNGLEVBQUUsT0FBT0MsT0FBTztvQkFDZEMsUUFBUUQsS0FBSyxDQUFDLFNBQVNBO29CQUN2QixPQUFPO2dCQUNUO1lBQ0Y7UUFDRjtLQUNEO0lBQ0RFLFdBQVc7UUFDVCxNQUFNQyxLQUFJLEVBQUVDLEtBQUssRUFBRWhCLElBQUksRUFBRTtZQUN2QixJQUFJQSxNQUFNO2dCQUNSZ0IsTUFBTVQsU0FBUyxHQUFHUCxLQUFLTyxTQUFTO2dCQUNoQ1MsTUFBTVAsT0FBTyxHQUFHVCxLQUFLUyxPQUFPO2dCQUM1Qk8sTUFBTU4sY0FBYyxHQUFHVixLQUFLVSxjQUFjO1lBQzVDO1lBQ0EsT0FBT007UUFDVDtRQUNBLE1BQU1DLFNBQVEsRUFBRUEsT0FBTyxFQUFFRCxLQUFLLEVBQUU7WUFDOUIsSUFBSUEsTUFBTUUsR0FBRyxFQUFFO2dCQUNiLHFCQUFxQjtnQkFDckIsSUFBSTtvQkFDRixNQUFNbEIsT0FBTyxNQUFNVixrREFBT0EsQ0FBQzZCLFlBQVksQ0FBQ0MsU0FBU0osTUFBTUUsR0FBRztvQkFDMUQsSUFBSWxCLE1BQU07d0JBQ1JpQixRQUFRakIsSUFBSSxDQUFDSyxFQUFFLEdBQUdMLEtBQUtLLEVBQUUsQ0FBQ0MsUUFBUTt3QkFDbENXLFFBQVFqQixJQUFJLENBQUNPLFNBQVMsR0FBR1AsS0FBS1EsVUFBVTt3QkFDeENTLFFBQVFqQixJQUFJLENBQUNTLE9BQU8sR0FBR1QsS0FBS1MsT0FBTzt3QkFDbkNRLFFBQVFqQixJQUFJLENBQUNVLGNBQWMsR0FBR1YsS0FBS1csZUFBZTt3QkFDbERNLFFBQVFqQixJQUFJLENBQUNxQixhQUFhLEdBQUcsTUFBTS9CLGtEQUFPQSxDQUFDK0IsYUFBYSxDQUFDckIsS0FBS0ssRUFBRTt3QkFDaEVZLFFBQVFqQixJQUFJLENBQUNzQixTQUFTLEdBQUcsTUFBTWhDLGtEQUFPQSxDQUFDZ0MsU0FBUyxDQUFDdEIsS0FBS0ssRUFBRTtvQkFDMUQ7Z0JBQ0YsRUFBRSxPQUFPTyxPQUFPO29CQUNkQyxRQUFRRCxLQUFLLENBQUMsZ0JBQWdCQTtnQkFDaEM7WUFDRjtZQUNBLE9BQU9LO1FBQ1Q7SUFDRjtJQUNBTSxPQUFPO1FBQ0xDLFFBQVE7SUFDVjtJQUNBUCxTQUFTO1FBQ1BRLFVBQVU7UUFDVkMsUUFBUSxLQUFLLEtBQUssS0FBSztJQUN6QjtJQUNBQyxRQUFRQyxRQUFRQyxHQUFHLENBQUNDLGVBQWU7QUFDckMsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL25hYmFiYS1kcmVzcy8uL3NyYy9saWIvYXV0aC50cz82NjkyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gJ25leHQtYXV0aCc7XG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzJztcbmltcG9ydCB7IFVzZXJEQU8gfSBmcm9tICcuL2Rhby91c2VyLWRhbyc7XG5pbXBvcnQgeyBDcmVkaXRzREFPIH0gZnJvbSAnLi9kYW8vY3JlZGl0cy1kYW8nO1xuXG5leHBvcnQgY29uc3QgYXV0aE9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBuYW1lOiAnY3JlZGVudGlhbHMnLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6ICdFbWFpbCcsIHR5cGU6ICdlbWFpbCcgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6ICdQYXNzd29yZCcsIHR5cGU6ICdwYXNzd29yZCcgfVxuICAgICAgfSxcbiAgICAgIGFzeW5jIGF1dGhvcml6ZShjcmVkZW50aWFscykge1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzPy5lbWFpbCB8fCAhY3JlZGVudGlhbHM/LnBhc3N3b3JkKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIOafpeaJvueUqOaIt1xuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyREFPLmZpbmRVc2VyQnlFbWFpbChjcmVkZW50aWFscy5lbWFpbCk7XG4gICAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyDpqozor4Hlr4bnoIFcbiAgICAgICAgICBjb25zdCBpc1ZhbGlkUGFzc3dvcmQgPSBhd2FpdCBVc2VyREFPLnZlcmlmeVBhc3N3b3JkKFxuICAgICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmQsXG4gICAgICAgICAgICB1c2VyLnBhc3N3b3JkX2hhc2hcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKCFpc1ZhbGlkUGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIOeZu+W9leaXtuS4jeiHquWKqOWPkeaUvuenr+WIhu+8jOaUueeUseS4k+mXqOeahOetvuWIsOaOpeWPo+WkhOeQhlxuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiB1c2VyLmlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICAgIG5hbWU6IHVzZXIuZW1haWwsXG4gICAgICAgICAgICB1c2VyTGV2ZWw6IHVzZXIudXNlcl9sZXZlbCxcbiAgICAgICAgICAgIGNyZWRpdHM6IHVzZXIuY3JlZGl0cyxcbiAgICAgICAgICAgIHdlY2hhdFVwZ3JhZGVkOiB1c2VyLndlY2hhdF91cGdyYWRlZFxuICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign6K6k6K+B5aSx6LSlOicsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIF0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyIH0pIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLnVzZXJMZXZlbCA9IHVzZXIudXNlckxldmVsO1xuICAgICAgICB0b2tlbi5jcmVkaXRzID0gdXNlci5jcmVkaXRzO1xuICAgICAgICB0b2tlbi53ZWNoYXRVcGdyYWRlZCA9IHVzZXIud2VjaGF0VXBncmFkZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW47XG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xuICAgICAgaWYgKHRva2VuLnN1Yikge1xuICAgICAgICAvLyDmr4/mrKHojrflj5ZzZXNzaW9u5pe25Yi35paw55So5oi35L+h5oGvXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJEQU8uZmluZFVzZXJCeUlkKHBhcnNlSW50KHRva2VuLnN1YikpO1xuICAgICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnVzZXIuaWQgPSB1c2VyLmlkLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICBzZXNzaW9uLnVzZXIudXNlckxldmVsID0gdXNlci51c2VyX2xldmVsO1xuICAgICAgICAgICAgc2Vzc2lvbi51c2VyLmNyZWRpdHMgPSB1c2VyLmNyZWRpdHM7XG4gICAgICAgICAgICBzZXNzaW9uLnVzZXIud2VjaGF0VXBncmFkZWQgPSB1c2VyLndlY2hhdF91cGdyYWRlZDtcbiAgICAgICAgICAgIHNlc3Npb24udXNlci5pc1ByZW1pdW1Vc2VyID0gYXdhaXQgVXNlckRBTy5pc1ByZW1pdW1Vc2VyKHVzZXIuaWQpO1xuICAgICAgICAgICAgc2Vzc2lvbi51c2VyLmlzUHJvVXNlciA9IGF3YWl0IFVzZXJEQU8uaXNQcm9Vc2VyKHVzZXIuaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfliLfmlrBzZXNzaW9u5aSx6LSlOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHNlc3Npb247XG4gICAgfVxuICB9LFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogJy9hdXRoL3NpZ25pbidcbiAgfSxcbiAgc2Vzc2lvbjoge1xuICAgIHN0cmF0ZWd5OiAnand0JyxcbiAgICBtYXhBZ2U6IDMwICogMjQgKiA2MCAqIDYwLCAvLyAzMCBkYXlzXG4gIH0sXG4gIHNlY3JldDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVULFxufTtcblxuLy8g5omp5bGVTmV4dEF1dGjnsbvlnotcbmRlY2xhcmUgbW9kdWxlICduZXh0LWF1dGgnIHtcbiAgaW50ZXJmYWNlIFVzZXIge1xuICAgIHVzZXJMZXZlbD86ICdmcmVlJyB8ICdwbHVzJyB8ICdwcm8nO1xuICAgIGNyZWRpdHM/OiBudW1iZXI7XG4gICAgd2VjaGF0VXBncmFkZWQ/OiBib29sZWFuO1xuICB9XG5cbiAgaW50ZXJmYWNlIFNlc3Npb24ge1xuICAgIHVzZXI6IHtcbiAgICAgIGlkOiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGVtYWlsPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGltYWdlPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIHVzZXJMZXZlbD86ICdmcmVlJyB8ICdwbHVzJyB8ICdwcm8nO1xuICAgICAgY3JlZGl0cz86IG51bWJlcjtcbiAgICAgIHdlY2hhdFVwZ3JhZGVkPzogYm9vbGVhbjtcbiAgICAgIGlzUHJlbWl1bVVzZXI/OiBib29sZWFuO1xuICAgICAgaXNQcm9Vc2VyPzogYm9vbGVhbjtcbiAgICB9O1xuICB9XG59XG5cbmRlY2xhcmUgbW9kdWxlICduZXh0LWF1dGgvand0JyB7XG4gIGludGVyZmFjZSBKV1Qge1xuICAgIHVzZXJMZXZlbD86ICdmcmVlJyB8ICdwbHVzJyB8ICdwcm8nO1xuICAgIGNyZWRpdHM/OiBudW1iZXI7XG4gICAgd2VjaGF0VXBncmFkZWQ/OiBib29sZWFuO1xuICB9XG59Il0sIm5hbWVzIjpbIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJVc2VyREFPIiwiYXV0aE9wdGlvbnMiLCJwcm92aWRlcnMiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJlbWFpbCIsImxhYmVsIiwidHlwZSIsInBhc3N3b3JkIiwiYXV0aG9yaXplIiwidXNlciIsImZpbmRVc2VyQnlFbWFpbCIsImlzVmFsaWRQYXNzd29yZCIsInZlcmlmeVBhc3N3b3JkIiwicGFzc3dvcmRfaGFzaCIsImlkIiwidG9TdHJpbmciLCJ1c2VyTGV2ZWwiLCJ1c2VyX2xldmVsIiwiY3JlZGl0cyIsIndlY2hhdFVwZ3JhZGVkIiwid2VjaGF0X3VwZ3JhZGVkIiwiZXJyb3IiLCJjb25zb2xlIiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJzZXNzaW9uIiwic3ViIiwiZmluZFVzZXJCeUlkIiwicGFyc2VJbnQiLCJpc1ByZW1pdW1Vc2VyIiwiaXNQcm9Vc2VyIiwicGFnZXMiLCJzaWduSW4iLCJzdHJhdGVneSIsIm1heEFnZSIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJORVhUQVVUSF9TRUNSRVQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/dao/credits-dao.ts":
/*!************************************!*\
  !*** ./src/lib/dao/credits-dao.ts ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CreditsDAO: () => (/* binding */ CreditsDAO)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./src/lib/db.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nclass CreditsDAO {\n    static{\n        // 积分包配置\n        this.CREDIT_PACKAGES = [\n            {\n                name: \"入门体验包\",\n                price: 6,\n                baseCredits: 10,\n                bonusCredits: 2,\n                totalCredits: 12,\n                description: \"新用户试用\"\n            },\n            {\n                name: \"基础使用包\",\n                price: 30,\n                baseCredits: 50,\n                bonusCredits: 15,\n                totalCredits: 65,\n                description: \"轻度用户\"\n            },\n            {\n                name: \"热门推荐包\",\n                price: 98,\n                baseCredits: 170,\n                bonusCredits: 50,\n                totalCredits: 220,\n                description: \"中度用户\"\n            },\n            {\n                name: \"专业用户包\",\n                price: 198,\n                baseCredits: 350,\n                bonusCredits: 100,\n                totalCredits: 450,\n                description: \"重度用户\"\n            },\n            {\n                name: \"商业用户包\",\n                price: 328,\n                baseCredits: 600,\n                bonusCredits: 180,\n                totalCredits: 780,\n                description: \"商业用户\"\n            },\n            {\n                name: \"企业定制包\",\n                price: 648,\n                baseCredits: 1300,\n                bonusCredits: 400,\n                totalCredits: 1700,\n                description: \"企业用户\"\n            }\n        ];\n    }\n    // 获取周数\n    static getWeekNumber(date) {\n        const firstDayOfYear = new Date(date.getFullYear(), 0, 1);\n        const pastDaysOfYear = (date.getTime() - firstDayOfYear.getTime()) / 86400000;\n        return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);\n    }\n    // 用户签到\n    static async userCheckin(userId, userLevel) {\n        const now = new Date();\n        // 根据用户等级确定签到类型和周期\n        const isWeeklyUser = userLevel === \"free\";\n        const checkinType = isWeeklyUser ? \"weekly\" : \"daily\";\n        // 生成签到周期标识\n        let checkinPeriod;\n        if (isWeeklyUser) {\n            const year = now.getFullYear();\n            const week = this.getWeekNumber(now);\n            checkinPeriod = `${year}-W${week.toString().padStart(2, \"0\")}`;\n        } else {\n            checkinPeriod = now.toISOString().split(\"T\")[0]; // YYYY-MM-DD\n        }\n        try {\n            // 检查是否已签到\n            const existingCheckin = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: \"SELECT id FROM user_checkins WHERE user_id = ? AND checkin_period = ?\",\n                args: [\n                    userId,\n                    checkinPeriod\n                ]\n            });\n            if (existingCheckin.rows.length > 0) {\n                const periodDesc = isWeeklyUser ? \"本周\" : \"今日\";\n                return {\n                    success: false,\n                    message: `${periodDesc}已签到`\n                };\n            }\n            // 开始事务：发放积分并记录签到\n            const creditsAwarded = 6;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.batch([\n                // 增加用户积分\n                {\n                    sql: \"UPDATE users SET credits = credits + ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\",\n                    args: [\n                        creditsAwarded,\n                        userId\n                    ]\n                },\n                // 记录签到\n                {\n                    sql: \"INSERT INTO user_checkins (user_id, checkin_type, checkin_period, credits_awarded) VALUES (?, ?, ?, ?)\",\n                    args: [\n                        userId,\n                        checkinType,\n                        checkinPeriod,\n                        creditsAwarded\n                    ]\n                }\n            ]);\n            return {\n                success: true,\n                message: `签到成功，获得${creditsAwarded}积分`,\n                creditsAwarded,\n                checkinType\n            };\n        } catch (error) {\n            console.error(\"用户签到失败:\", error);\n            return {\n                success: false,\n                message: \"签到失败，请稍后重试\"\n            };\n        }\n    }\n    // 检查签到状态\n    static async getCheckinStatus(userId, userLevel) {\n        const now = new Date();\n        const isWeeklyUser = userLevel === \"free\";\n        const checkinType = isWeeklyUser ? \"weekly\" : \"daily\";\n        let checkinPeriod;\n        let nextCheckinTime;\n        if (isWeeklyUser) {\n            const year = now.getFullYear();\n            const week = this.getWeekNumber(now);\n            checkinPeriod = `${year}-W${week.toString().padStart(2, \"0\")}`;\n            // 下周同一时间\n            nextCheckinTime = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\n        } else {\n            checkinPeriod = now.toISOString().split(\"T\")[0];\n            // 明天同一时间\n            nextCheckinTime = new Date(now.getTime() + 24 * 60 * 60 * 1000);\n        }\n        try {\n            const existingCheckin = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: \"SELECT id FROM user_checkins WHERE user_id = ? AND checkin_period = ?\",\n                args: [\n                    userId,\n                    checkinPeriod\n                ]\n            });\n            return {\n                canCheckin: existingCheckin.rows.length === 0,\n                nextCheckinTime: existingCheckin.rows.length > 0 ? nextCheckinTime : undefined,\n                checkinType\n            };\n        } catch (error) {\n            console.error(\"检查签到状态失败:\", error);\n            return {\n                canCheckin: false,\n                checkinType\n            };\n        }\n    }\n    // 获取用户签到历史\n    static async getUserCheckinHistory(userId, limit = 30) {\n        try {\n            const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: \"SELECT * FROM user_checkins WHERE user_id = ? ORDER BY created_at DESC LIMIT ?\",\n                args: [\n                    userId,\n                    limit\n                ]\n            });\n            return result.rows.map((row)=>({\n                    id: row.id,\n                    user_id: row.user_id,\n                    checkin_type: row.checkin_type,\n                    checkin_period: row.checkin_period,\n                    credits_awarded: row.credits_awarded,\n                    created_at: new Date(row.created_at)\n                }));\n        } catch (error) {\n            console.error(\"获取签到历史失败:\", error);\n            return [];\n        }\n    }\n    // 积分充值（线下交易）\n    static async purchaseCredits(userId, packageName, adminNote) {\n        const packageInfo = this.CREDIT_PACKAGES.find((pkg)=>pkg.name === packageName);\n        if (!packageInfo) {\n            return {\n                success: false,\n                message: \"积分包不存在\"\n            };\n        }\n        try {\n            // 开始事务：增加积分 + 升级用户等级 + 记录交易\n            await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.batch([\n                // 增加用户积分\n                {\n                    sql: \"UPDATE users SET credits = credits + ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\",\n                    args: [\n                        packageInfo.totalCredits,\n                        userId\n                    ]\n                },\n                // 升级用户等级为Pro\n                {\n                    sql: \"UPDATE users SET user_level = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\",\n                    args: [\n                        \"pro\",\n                        userId\n                    ]\n                },\n                // 记录充值交易\n                {\n                    sql: `INSERT INTO credit_purchases \n                (user_id, package_name, package_price, base_credits, bonus_credits, total_credits, admin_note) \n                VALUES (?, ?, ?, ?, ?, ?, ?)`,\n                    args: [\n                        userId,\n                        packageInfo.name,\n                        packageInfo.price,\n                        packageInfo.baseCredits,\n                        packageInfo.bonusCredits,\n                        packageInfo.totalCredits,\n                        adminNote || \"\"\n                    ]\n                }\n            ]);\n            return {\n                success: true,\n                message: `充值成功！获得${packageInfo.totalCredits}积分，已升级为Pro用户`,\n                creditsAdded: packageInfo.totalCredits,\n                newUserLevel: \"pro\"\n            };\n        } catch (error) {\n            console.error(\"积分充值失败:\", error);\n            return {\n                success: false,\n                message: \"充值失败，请联系管理员\"\n            };\n        }\n    }\n    // 获取积分包列表\n    static getCreditPackages() {\n        return this.CREDIT_PACKAGES;\n    }\n    // 获取用户充值历史\n    static async getUserPurchaseHistory(userId, limit = 20) {\n        try {\n            const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: \"SELECT * FROM credit_purchases WHERE user_id = ? ORDER BY created_at DESC LIMIT ?\",\n                args: [\n                    userId,\n                    limit\n                ]\n            });\n            return result.rows.map((row)=>({\n                    id: row.id,\n                    user_id: row.user_id,\n                    package_name: row.package_name,\n                    package_price: row.package_price,\n                    base_credits: row.base_credits,\n                    bonus_credits: row.bonus_credits,\n                    total_credits: row.total_credits,\n                    payment_method: row.payment_method,\n                    transaction_status: row.transaction_status,\n                    admin_note: row.admin_note,\n                    created_at: new Date(row.created_at)\n                }));\n        } catch (error) {\n            console.error(\"获取充值历史失败:\", error);\n            return [];\n        }\n    }\n    // 创建生成历史记录\n    static async createGenerationHistory(userId, creditsUsed, clothingCount = 1, generationType = \"single\") {\n        try {\n            const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: `INSERT INTO generation_history (user_id, credits_used, clothing_count, generation_type, status) \n              VALUES (?, ?, ?, ?, 'pending') RETURNING *`,\n                args: [\n                    userId,\n                    creditsUsed,\n                    clothingCount,\n                    generationType\n                ]\n            });\n            const record = result.rows[0];\n            return {\n                id: record.id,\n                user_id: record.user_id,\n                credits_used: record.credits_used,\n                clothing_count: record.clothing_count,\n                generation_type: record.generation_type,\n                status: record.status,\n                created_at: new Date(record.created_at)\n            };\n        } catch (error) {\n            console.error(\"创建生成历史记录失败:\", error);\n            throw error;\n        }\n    }\n    // 更新生成历史状态\n    static async updateGenerationStatus(historyId, status, errorMessage, processingTime) {\n        try {\n            const updateFields = [\n                \"status = ?\"\n            ];\n            const updateValues = [\n                status\n            ];\n            if (status === \"completed\" || status === \"failed\") {\n                updateFields.push(\"completed_at = CURRENT_TIMESTAMP\");\n            }\n            if (errorMessage) {\n                updateFields.push(\"error_message = ?\");\n                updateValues.push(errorMessage);\n            }\n            if (processingTime !== undefined) {\n                updateFields.push(\"processing_time = ?\");\n                updateValues.push(processingTime);\n            }\n            updateValues.push(historyId);\n            const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: `UPDATE generation_history SET ${updateFields.join(\", \")} WHERE id = ? RETURNING *`,\n                args: updateValues\n            });\n            if (result.rows.length === 0) {\n                throw new Error(\"生成历史记录不存在\");\n            }\n            const record = result.rows[0];\n            return {\n                id: record.id,\n                user_id: record.user_id,\n                credits_used: record.credits_used,\n                clothing_count: record.clothing_count,\n                generation_type: record.generation_type,\n                status: record.status,\n                error_message: record.error_message,\n                processing_time: record.processing_time,\n                created_at: new Date(record.created_at),\n                completed_at: record.completed_at ? new Date(record.completed_at) : undefined\n            };\n        } catch (error) {\n            console.error(\"更新生成历史状态失败:\", error);\n            throw error;\n        }\n    }\n    // 获取用户生成历史\n    static async getUserGenerationHistory(userId, limit = 50) {\n        try {\n            const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: \"SELECT * FROM generation_history WHERE user_id = ? ORDER BY created_at DESC LIMIT ?\",\n                args: [\n                    userId,\n                    limit\n                ]\n            });\n            return result.rows.map((row)=>({\n                    id: row.id,\n                    user_id: row.user_id,\n                    credits_used: row.credits_used,\n                    clothing_count: row.clothing_count,\n                    generation_type: row.generation_type,\n                    status: row.status,\n                    error_message: row.error_message,\n                    processing_time: row.processing_time,\n                    created_at: new Date(row.created_at),\n                    completed_at: row.completed_at ? new Date(row.completed_at) : undefined\n                }));\n        } catch (error) {\n            console.error(\"获取生成历史失败:\", error);\n            return [];\n        }\n    }\n    // 获取用户积分统计\n    static async getUserCreditStats(userId) {\n        try {\n            const [generationResult, checkinResult, purchaseResult] = await Promise.all([\n                // 查询生成统计\n                _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                    sql: `SELECT \n                  COUNT(*) as total_generations,\n                  COUNT(CASE WHEN status = 'completed' THEN 1 END) as successful_generations,\n                  COUNT(CASE WHEN status = 'failed' THEN 1 END) as failed_generations,\n                  SUM(credits_used) as total_credits_used\n                FROM generation_history \n                WHERE user_id = ?`,\n                    args: [\n                        userId\n                    ]\n                }),\n                // 查询签到统计\n                _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                    sql: `SELECT \n                  COUNT(*) as total_checkins,\n                  SUM(credits_awarded) as total_checkin_credits\n                FROM user_checkins \n                WHERE user_id = ?`,\n                    args: [\n                        userId\n                    ]\n                }),\n                // 查询充值统计\n                _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                    sql: `SELECT \n                  COUNT(*) as total_purchases,\n                  SUM(total_credits) as total_purchased_credits\n                FROM credit_purchases \n                WHERE user_id = ?`,\n                    args: [\n                        userId\n                    ]\n                })\n            ]);\n            const genStats = generationResult.rows[0];\n            const checkinStats = checkinResult.rows[0];\n            const purchaseStats = purchaseResult.rows[0];\n            return {\n                // 生成统计\n                total_generations: genStats.total_generations || 0,\n                successful_generations: genStats.successful_generations || 0,\n                failed_generations: genStats.failed_generations || 0,\n                total_credits_used: genStats.total_credits_used || 0,\n                // 签到统计\n                total_checkins: checkinStats.total_checkins || 0,\n                total_checkin_credits: checkinStats.total_checkin_credits || 0,\n                // 充值统计\n                total_purchases: purchaseStats.total_purchases || 0,\n                total_purchased_credits: purchaseStats.total_purchased_credits || 0\n            };\n        } catch (error) {\n            console.error(\"获取用户积分统计失败:\", error);\n            return {\n                total_generations: 0,\n                successful_generations: 0,\n                failed_generations: 0,\n                total_credits_used: 0,\n                total_checkins: 0,\n                total_checkin_credits: 0,\n                total_purchases: 0,\n                total_purchased_credits: 0\n            };\n        }\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LHlCQUF5QjtZQUMzQjtRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25hYmFiYS1kcmVzcy8uL3NyYy9saWIvZGFvL2NyZWRpdHMtZGFvLnRzPzRmYjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGJDbGllbnQgfSBmcm9tICcuLi9kYic7XG5cbi8vIOeUqOaIt+etvuWIsOiusOW9lVxuZXhwb3J0IGludGVyZmFjZSBVc2VyQ2hlY2tpbiB7XG4gIGlkOiBudW1iZXI7XG4gIHVzZXJfaWQ6IG51bWJlcjtcbiAgY2hlY2tpbl90eXBlOiAnZGFpbHknIHwgJ3dlZWtseSc7XG4gIGNoZWNraW5fcGVyaW9kOiBzdHJpbmc7IC8vIFlZWVktTU0tRETvvIjml6XvvInmiJYgWVlZWS1XIyPvvIjlkajvvIlcbiAgY3JlZGl0c19hd2FyZGVkOiBudW1iZXI7XG4gIGNyZWF0ZWRfYXQ6IERhdGU7XG59XG5cbi8vIOenr+WIhuWFheWAvOiusOW9lVxuZXhwb3J0IGludGVyZmFjZSBDcmVkaXRQdXJjaGFzZSB7XG4gIGlkOiBudW1iZXI7XG4gIHVzZXJfaWQ6IG51bWJlcjtcbiAgcGFja2FnZV9uYW1lOiBzdHJpbmc7XG4gIHBhY2thZ2VfcHJpY2U6IG51bWJlcjtcbiAgYmFzZV9jcmVkaXRzOiBudW1iZXI7XG4gIGJvbnVzX2NyZWRpdHM6IG51bWJlcjtcbiAgdG90YWxfY3JlZGl0czogbnVtYmVyO1xuICBwYXltZW50X21ldGhvZDogc3RyaW5nO1xuICB0cmFuc2FjdGlvbl9zdGF0dXM6IHN0cmluZztcbiAgYWRtaW5fbm90ZT86IHN0cmluZztcbiAgY3JlYXRlZF9hdDogRGF0ZTtcbn1cblxuLy8g55Sf5oiQ5Y6G5Y+y6K6w5b2VXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyYXRpb25IaXN0b3J5IHtcbiAgaWQ6IG51bWJlcjtcbiAgdXNlcl9pZDogbnVtYmVyO1xuICBjcmVkaXRzX3VzZWQ6IG51bWJlcjtcbiAgY2xvdGhpbmdfY291bnQ6IG51bWJlcjtcbiAgZ2VuZXJhdGlvbl90eXBlOiAnc2luZ2xlJyB8ICdiYXRjaCc7XG4gIHN0YXR1czogJ3BlbmRpbmcnIHwgJ3Byb2Nlc3NpbmcnIHwgJ2NvbXBsZXRlZCcgfCAnZmFpbGVkJztcbiAgZXJyb3JfbWVzc2FnZT86IHN0cmluZztcbiAgcHJvY2Vzc2luZ190aW1lPzogbnVtYmVyO1xuICBjcmVhdGVkX2F0OiBEYXRlO1xuICBjb21wbGV0ZWRfYXQ/OiBEYXRlO1xufVxuXG4vLyDnp6/liIbljIXphY3nva5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlZGl0UGFja2FnZSB7XG4gIG5hbWU6IHN0cmluZztcbiAgcHJpY2U6IG51bWJlcjtcbiAgYmFzZUNyZWRpdHM6IG51bWJlcjtcbiAgYm9udXNDcmVkaXRzOiBudW1iZXI7XG4gIHRvdGFsQ3JlZGl0czogbnVtYmVyO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQ3JlZGl0c0RBTyB7XG4gIFxuICAvLyDnp6/liIbljIXphY3nva5cbiAgc3RhdGljIHJlYWRvbmx5IENSRURJVF9QQUNLQUdFUzogQ3JlZGl0UGFja2FnZVtdID0gW1xuICAgIHsgbmFtZTogJ+WFpemXqOS9k+mqjOWMhScsIHByaWNlOiA2LCBiYXNlQ3JlZGl0czogMTAsIGJvbnVzQ3JlZGl0czogMiwgdG90YWxDcmVkaXRzOiAxMiwgZGVzY3JpcHRpb246ICfmlrDnlKjmiLfor5XnlKgnIH0sXG4gICAgeyBuYW1lOiAn5Z+656GA5L2/55So5YyFJywgcHJpY2U6IDMwLCBiYXNlQ3JlZGl0czogNTAsIGJvbnVzQ3JlZGl0czogMTUsIHRvdGFsQ3JlZGl0czogNjUsIGRlc2NyaXB0aW9uOiAn6L275bqm55So5oi3JyB9LFxuICAgIHsgbmFtZTogJ+eDremXqOaOqOiNkOWMhScsIHByaWNlOiA5OCwgYmFzZUNyZWRpdHM6IDE3MCwgYm9udXNDcmVkaXRzOiA1MCwgdG90YWxDcmVkaXRzOiAyMjAsIGRlc2NyaXB0aW9uOiAn5Lit5bqm55So5oi3JyB9LFxuICAgIHsgbmFtZTogJ+S4k+S4mueUqOaIt+WMhScsIHByaWNlOiAxOTgsIGJhc2VDcmVkaXRzOiAzNTAsIGJvbnVzQ3JlZGl0czogMTAwLCB0b3RhbENyZWRpdHM6IDQ1MCwgZGVzY3JpcHRpb246ICfph43luqbnlKjmiLcnIH0sXG4gICAgeyBuYW1lOiAn5ZWG5Lia55So5oi35YyFJywgcHJpY2U6IDMyOCwgYmFzZUNyZWRpdHM6IDYwMCwgYm9udXNDcmVkaXRzOiAxODAsIHRvdGFsQ3JlZGl0czogNzgwLCBkZXNjcmlwdGlvbjogJ+WVhuS4mueUqOaItycgfSxcbiAgICB7IG5hbWU6ICfkvIHkuJrlrprliLbljIUnLCBwcmljZTogNjQ4LCBiYXNlQ3JlZGl0czogMTMwMCwgYm9udXNDcmVkaXRzOiA0MDAsIHRvdGFsQ3JlZGl0czogMTcwMCwgZGVzY3JpcHRpb246ICfkvIHkuJrnlKjmiLcnIH1cbiAgXTtcblxuICAvLyDojrflj5blkajmlbBcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0V2Vla051bWJlcihkYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgICBjb25zdCBmaXJzdERheU9mWWVhciA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgMSk7XG4gICAgY29uc3QgcGFzdERheXNPZlllYXIgPSAoZGF0ZS5nZXRUaW1lKCkgLSBmaXJzdERheU9mWWVhci5nZXRUaW1lKCkpIC8gODY0MDAwMDA7XG4gICAgcmV0dXJuIE1hdGguY2VpbCgocGFzdERheXNPZlllYXIgKyBmaXJzdERheU9mWWVhci5nZXREYXkoKSArIDEpIC8gNyk7XG4gIH1cblxuICAvLyDnlKjmiLfnrb7liLBcbiAgc3RhdGljIGFzeW5jIHVzZXJDaGVja2luKHVzZXJJZDogbnVtYmVyLCB1c2VyTGV2ZWw6ICdmcmVlJyB8ICdwbHVzJyB8ICdwcm8nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZzsgY3JlZGl0c0F3YXJkZWQ/OiBudW1iZXI7IGNoZWNraW5UeXBlPzogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIFxuICAgIC8vIOagueaNrueUqOaIt+etiee6p+ehruWumuetvuWIsOexu+Wei+WSjOWRqOacn1xuICAgIGNvbnN0IGlzV2Vla2x5VXNlciA9IHVzZXJMZXZlbCA9PT0gJ2ZyZWUnO1xuICAgIGNvbnN0IGNoZWNraW5UeXBlID0gaXNXZWVrbHlVc2VyID8gJ3dlZWtseScgOiAnZGFpbHknO1xuICAgIFxuICAgIC8vIOeUn+aIkOetvuWIsOWRqOacn+agh+ivhlxuICAgIGxldCBjaGVja2luUGVyaW9kOiBzdHJpbmc7XG4gICAgaWYgKGlzV2Vla2x5VXNlcikge1xuICAgICAgY29uc3QgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xuICAgICAgY29uc3Qgd2VlayA9IHRoaXMuZ2V0V2Vla051bWJlcihub3cpO1xuICAgICAgY2hlY2tpblBlcmlvZCA9IGAke3llYXJ9LVcke3dlZWsudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNoZWNraW5QZXJpb2QgPSBub3cudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOyAvLyBZWVlZLU1NLUREXG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyDmo4Dmn6XmmK/lkKblt7Lnrb7liLBcbiAgICAgIGNvbnN0IGV4aXN0aW5nQ2hlY2tpbiA9IGF3YWl0IGRiQ2xpZW50LmV4ZWN1dGUoe1xuICAgICAgICBzcWw6ICdTRUxFQ1QgaWQgRlJPTSB1c2VyX2NoZWNraW5zIFdIRVJFIHVzZXJfaWQgPSA/IEFORCBjaGVja2luX3BlcmlvZCA9ID8nLFxuICAgICAgICBhcmdzOiBbdXNlcklkLCBjaGVja2luUGVyaW9kXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChleGlzdGluZ0NoZWNraW4ucm93cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHBlcmlvZERlc2MgPSBpc1dlZWtseVVzZXIgPyAn5pys5ZGoJyA6ICfku4rml6UnO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogYCR7cGVyaW9kRGVzY33lt7Lnrb7liLBgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIOW8gOWni+S6i+WKoe+8muWPkeaUvuenr+WIhuW5tuiusOW9leetvuWIsFxuICAgICAgY29uc3QgY3JlZGl0c0F3YXJkZWQgPSA2O1xuICAgICAgYXdhaXQgZGJDbGllbnQuYmF0Y2goW1xuICAgICAgICAvLyDlop7liqDnlKjmiLfnp6/liIZcbiAgICAgICAge1xuICAgICAgICAgIHNxbDogJ1VQREFURSB1c2VycyBTRVQgY3JlZGl0cyA9IGNyZWRpdHMgKyA/LCB1cGRhdGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgaWQgPSA/JyxcbiAgICAgICAgICBhcmdzOiBbY3JlZGl0c0F3YXJkZWQsIHVzZXJJZF1cbiAgICAgICAgfSxcbiAgICAgICAgLy8g6K6w5b2V562+5YiwXG4gICAgICAgIHtcbiAgICAgICAgICBzcWw6ICdJTlNFUlQgSU5UTyB1c2VyX2NoZWNraW5zICh1c2VyX2lkLCBjaGVja2luX3R5cGUsIGNoZWNraW5fcGVyaW9kLCBjcmVkaXRzX2F3YXJkZWQpIFZBTFVFUyAoPywgPywgPywgPyknLFxuICAgICAgICAgIGFyZ3M6IFt1c2VySWQsIGNoZWNraW5UeXBlLCBjaGVja2luUGVyaW9kLCBjcmVkaXRzQXdhcmRlZF1cbiAgICAgICAgfVxuICAgICAgXSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IGDnrb7liLDmiJDlip/vvIzojrflvpcke2NyZWRpdHNBd2FyZGVkfeenr+WIhmAsXG4gICAgICAgIGNyZWRpdHNBd2FyZGVkLFxuICAgICAgICBjaGVja2luVHlwZVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign55So5oi3562+5Yiw5aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAn562+5Yiw5aSx6LSl77yM6K+356iN5ZCO6YeN6K+VJyB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIOajgOafpeetvuWIsOeKtuaAgVxuICBzdGF0aWMgYXN5bmMgZ2V0Q2hlY2tpblN0YXR1cyh1c2VySWQ6IG51bWJlciwgdXNlckxldmVsOiAnZnJlZScgfCAncGx1cycgfCAncHJvJyk6IFByb21pc2U8eyBjYW5DaGVja2luOiBib29sZWFuOyBuZXh0Q2hlY2tpblRpbWU/OiBEYXRlOyBjaGVja2luVHlwZTogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGlzV2Vla2x5VXNlciA9IHVzZXJMZXZlbCA9PT0gJ2ZyZWUnO1xuICAgIGNvbnN0IGNoZWNraW5UeXBlID0gaXNXZWVrbHlVc2VyID8gJ3dlZWtseScgOiAnZGFpbHknO1xuICAgIFxuICAgIGxldCBjaGVja2luUGVyaW9kOiBzdHJpbmc7XG4gICAgbGV0IG5leHRDaGVja2luVGltZTogRGF0ZTtcbiAgICBcbiAgICBpZiAoaXNXZWVrbHlVc2VyKSB7XG4gICAgICBjb25zdCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG4gICAgICBjb25zdCB3ZWVrID0gdGhpcy5nZXRXZWVrTnVtYmVyKG5vdyk7XG4gICAgICBjaGVja2luUGVyaW9kID0gYCR7eWVhcn0tVyR7d2Vlay50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDtcbiAgICAgIC8vIOS4i+WRqOWQjOS4gOaXtumXtFxuICAgICAgbmV4dENoZWNraW5UaW1lID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hlY2tpblBlcmlvZCA9IG5vdy50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICAvLyDmmI7lpKnlkIzkuIDml7bpl7RcbiAgICAgIG5leHRDaGVja2luVGltZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nQ2hlY2tpbiA9IGF3YWl0IGRiQ2xpZW50LmV4ZWN1dGUoe1xuICAgICAgICBzcWw6ICdTRUxFQ1QgaWQgRlJPTSB1c2VyX2NoZWNraW5zIFdIRVJFIHVzZXJfaWQgPSA/IEFORCBjaGVja2luX3BlcmlvZCA9ID8nLFxuICAgICAgICBhcmdzOiBbdXNlcklkLCBjaGVja2luUGVyaW9kXVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbkNoZWNraW46IGV4aXN0aW5nQ2hlY2tpbi5yb3dzLmxlbmd0aCA9PT0gMCxcbiAgICAgICAgbmV4dENoZWNraW5UaW1lOiBleGlzdGluZ0NoZWNraW4ucm93cy5sZW5ndGggPiAwID8gbmV4dENoZWNraW5UaW1lIDogdW5kZWZpbmVkLFxuICAgICAgICBjaGVja2luVHlwZVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5qOA5p+l562+5Yiw54q25oCB5aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IGNhbkNoZWNraW46IGZhbHNlLCBjaGVja2luVHlwZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIOiOt+WPlueUqOaIt+etvuWIsOWOhuWPslxuICBzdGF0aWMgYXN5bmMgZ2V0VXNlckNoZWNraW5IaXN0b3J5KHVzZXJJZDogbnVtYmVyLCBsaW1pdDogbnVtYmVyID0gMzApOiBQcm9taXNlPFVzZXJDaGVja2luW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJDbGllbnQuZXhlY3V0ZSh7XG4gICAgICAgIHNxbDogJ1NFTEVDVCAqIEZST00gdXNlcl9jaGVja2lucyBXSEVSRSB1c2VyX2lkID0gPyBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0MgTElNSVQgPycsXG4gICAgICAgIGFyZ3M6IFt1c2VySWQsIGxpbWl0XVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQucm93cy5tYXAocm93ID0+ICh7XG4gICAgICAgIGlkOiByb3cuaWQgYXMgbnVtYmVyLFxuICAgICAgICB1c2VyX2lkOiByb3cudXNlcl9pZCBhcyBudW1iZXIsXG4gICAgICAgIGNoZWNraW5fdHlwZTogcm93LmNoZWNraW5fdHlwZSBhcyAnZGFpbHknIHwgJ3dlZWtseScsXG4gICAgICAgIGNoZWNraW5fcGVyaW9kOiByb3cuY2hlY2tpbl9wZXJpb2QgYXMgc3RyaW5nLFxuICAgICAgICBjcmVkaXRzX2F3YXJkZWQ6IHJvdy5jcmVkaXRzX2F3YXJkZWQgYXMgbnVtYmVyLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZShyb3cuY3JlYXRlZF9hdCBhcyBzdHJpbmcpXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluetvuWIsOWOhuWPsuWksei0pTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLy8g56ev5YiG5YWF5YC877yI57q/5LiL5Lqk5piT77yJXG4gIHN0YXRpYyBhc3luYyBwdXJjaGFzZUNyZWRpdHMoXG4gICAgdXNlcklkOiBudW1iZXIsXG4gICAgcGFja2FnZU5hbWU6IHN0cmluZyxcbiAgICBhZG1pbk5vdGU/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZzsgY3JlZGl0c0FkZGVkPzogbnVtYmVyOyBuZXdVc2VyTGV2ZWw/OiBzdHJpbmcgfT4ge1xuICAgIGNvbnN0IHBhY2thZ2VJbmZvID0gdGhpcy5DUkVESVRfUEFDS0FHRVMuZmluZChwa2cgPT4gcGtnLm5hbWUgPT09IHBhY2thZ2VOYW1lKTtcbiAgICBpZiAoIXBhY2thZ2VJbmZvKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ+enr+WIhuWMheS4jeWtmOWcqCcgfTtcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIOW8gOWni+S6i+WKoe+8muWinuWKoOenr+WIhiArIOWNh+e6p+eUqOaIt+etiee6pyArIOiusOW9leS6pOaYk1xuICAgICAgYXdhaXQgZGJDbGllbnQuYmF0Y2goW1xuICAgICAgICAvLyDlop7liqDnlKjmiLfnp6/liIZcbiAgICAgICAge1xuICAgICAgICAgIHNxbDogJ1VQREFURSB1c2VycyBTRVQgY3JlZGl0cyA9IGNyZWRpdHMgKyA/LCB1cGRhdGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAgV0hFUkUgaWQgPSA/JyxcbiAgICAgICAgICBhcmdzOiBbcGFja2FnZUluZm8udG90YWxDcmVkaXRzLCB1c2VySWRdXG4gICAgICAgIH0sXG4gICAgICAgIC8vIOWNh+e6p+eUqOaIt+etiee6p+S4ulByb1xuICAgICAgICB7XG4gICAgICAgICAgc3FsOiAnVVBEQVRFIHVzZXJzIFNFVCB1c2VyX2xldmVsID0gPywgdXBkYXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QIFdIRVJFIGlkID0gPycsXG4gICAgICAgICAgYXJnczogWydwcm8nLCB1c2VySWRdXG4gICAgICAgIH0sXG4gICAgICAgIC8vIOiusOW9leWFheWAvOS6pOaYk1xuICAgICAgICB7XG4gICAgICAgICAgc3FsOiBgSU5TRVJUIElOVE8gY3JlZGl0X3B1cmNoYXNlcyBcbiAgICAgICAgICAgICAgICAodXNlcl9pZCwgcGFja2FnZV9uYW1lLCBwYWNrYWdlX3ByaWNlLCBiYXNlX2NyZWRpdHMsIGJvbnVzX2NyZWRpdHMsIHRvdGFsX2NyZWRpdHMsIGFkbWluX25vdGUpIFxuICAgICAgICAgICAgICAgIFZBTFVFUyAoPywgPywgPywgPywgPywgPywgPylgLFxuICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgIHVzZXJJZCwgXG4gICAgICAgICAgICBwYWNrYWdlSW5mby5uYW1lLCBcbiAgICAgICAgICAgIHBhY2thZ2VJbmZvLnByaWNlLCBcbiAgICAgICAgICAgIHBhY2thZ2VJbmZvLmJhc2VDcmVkaXRzLCBcbiAgICAgICAgICAgIHBhY2thZ2VJbmZvLmJvbnVzQ3JlZGl0cywgXG4gICAgICAgICAgICBwYWNrYWdlSW5mby50b3RhbENyZWRpdHMsIFxuICAgICAgICAgICAgYWRtaW5Ob3RlIHx8ICcnXG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICBdKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYOWFheWAvOaIkOWKn++8geiOt+W+lyR7cGFja2FnZUluZm8udG90YWxDcmVkaXRzfeenr+WIhu+8jOW3suWNh+e6p+S4ulByb+eUqOaIt2AsXG4gICAgICAgIGNyZWRpdHNBZGRlZDogcGFja2FnZUluZm8udG90YWxDcmVkaXRzLFxuICAgICAgICBuZXdVc2VyTGV2ZWw6ICdwcm8nXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfnp6/liIblhYXlgLzlpLHotKU6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICflhYXlgLzlpLHotKXvvIzor7fogZTns7vnrqHnkIblkZgnIH07XG4gICAgfVxuICB9XG5cbiAgLy8g6I635Y+W56ev5YiG5YyF5YiX6KGoXG4gIHN0YXRpYyBnZXRDcmVkaXRQYWNrYWdlcygpOiBDcmVkaXRQYWNrYWdlW10ge1xuICAgIHJldHVybiB0aGlzLkNSRURJVF9QQUNLQUdFUztcbiAgfVxuXG4gIC8vIOiOt+WPlueUqOaIt+WFheWAvOWOhuWPslxuICBzdGF0aWMgYXN5bmMgZ2V0VXNlclB1cmNoYXNlSGlzdG9yeSh1c2VySWQ6IG51bWJlciwgbGltaXQ6IG51bWJlciA9IDIwKTogUHJvbWlzZTxDcmVkaXRQdXJjaGFzZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiQ2xpZW50LmV4ZWN1dGUoe1xuICAgICAgICBzcWw6ICdTRUxFQ1QgKiBGUk9NIGNyZWRpdF9wdXJjaGFzZXMgV0hFUkUgdXNlcl9pZCA9ID8gT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDIExJTUlUID8nLFxuICAgICAgICBhcmdzOiBbdXNlcklkLCBsaW1pdF1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzdWx0LnJvd3MubWFwKHJvdyA9PiAoe1xuICAgICAgICBpZDogcm93LmlkIGFzIG51bWJlcixcbiAgICAgICAgdXNlcl9pZDogcm93LnVzZXJfaWQgYXMgbnVtYmVyLFxuICAgICAgICBwYWNrYWdlX25hbWU6IHJvdy5wYWNrYWdlX25hbWUgYXMgc3RyaW5nLFxuICAgICAgICBwYWNrYWdlX3ByaWNlOiByb3cucGFja2FnZV9wcmljZSBhcyBudW1iZXIsXG4gICAgICAgIGJhc2VfY3JlZGl0czogcm93LmJhc2VfY3JlZGl0cyBhcyBudW1iZXIsXG4gICAgICAgIGJvbnVzX2NyZWRpdHM6IHJvdy5ib251c19jcmVkaXRzIGFzIG51bWJlcixcbiAgICAgICAgdG90YWxfY3JlZGl0czogcm93LnRvdGFsX2NyZWRpdHMgYXMgbnVtYmVyLFxuICAgICAgICBwYXltZW50X21ldGhvZDogcm93LnBheW1lbnRfbWV0aG9kIGFzIHN0cmluZyxcbiAgICAgICAgdHJhbnNhY3Rpb25fc3RhdHVzOiByb3cudHJhbnNhY3Rpb25fc3RhdHVzIGFzIHN0cmluZyxcbiAgICAgICAgYWRtaW5fbm90ZTogcm93LmFkbWluX25vdGUgYXMgc3RyaW5nLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZShyb3cuY3JlYXRlZF9hdCBhcyBzdHJpbmcpXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluWFheWAvOWOhuWPsuWksei0pTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLy8g5Yib5bu655Sf5oiQ5Y6G5Y+y6K6w5b2VXG4gIHN0YXRpYyBhc3luYyBjcmVhdGVHZW5lcmF0aW9uSGlzdG9yeShcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICBjcmVkaXRzVXNlZDogbnVtYmVyLFxuICAgIGNsb3RoaW5nQ291bnQ6IG51bWJlciA9IDEsXG4gICAgZ2VuZXJhdGlvblR5cGU6ICdzaW5nbGUnIHwgJ2JhdGNoJyA9ICdzaW5nbGUnXG4gICk6IFByb21pc2U8R2VuZXJhdGlvbkhpc3Rvcnk+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJDbGllbnQuZXhlY3V0ZSh7XG4gICAgICAgIHNxbDogYElOU0VSVCBJTlRPIGdlbmVyYXRpb25faGlzdG9yeSAodXNlcl9pZCwgY3JlZGl0c191c2VkLCBjbG90aGluZ19jb3VudCwgZ2VuZXJhdGlvbl90eXBlLCBzdGF0dXMpIFxuICAgICAgICAgICAgICBWQUxVRVMgKD8sID8sID8sID8sICdwZW5kaW5nJykgUkVUVVJOSU5HICpgLFxuICAgICAgICBhcmdzOiBbdXNlcklkLCBjcmVkaXRzVXNlZCwgY2xvdGhpbmdDb3VudCwgZ2VuZXJhdGlvblR5cGVdXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVjb3JkID0gcmVzdWx0LnJvd3NbMF0gYXMgYW55O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IHJlY29yZC5pZCxcbiAgICAgICAgdXNlcl9pZDogcmVjb3JkLnVzZXJfaWQsXG4gICAgICAgIGNyZWRpdHNfdXNlZDogcmVjb3JkLmNyZWRpdHNfdXNlZCxcbiAgICAgICAgY2xvdGhpbmdfY291bnQ6IHJlY29yZC5jbG90aGluZ19jb3VudCxcbiAgICAgICAgZ2VuZXJhdGlvbl90eXBlOiByZWNvcmQuZ2VuZXJhdGlvbl90eXBlLFxuICAgICAgICBzdGF0dXM6IHJlY29yZC5zdGF0dXMsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKHJlY29yZC5jcmVhdGVkX2F0KVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5Yib5bu655Sf5oiQ5Y6G5Y+y6K6w5b2V5aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIOabtOaWsOeUn+aIkOWOhuWPsueKtuaAgVxuICBzdGF0aWMgYXN5bmMgdXBkYXRlR2VuZXJhdGlvblN0YXR1cyhcbiAgICBoaXN0b3J5SWQ6IG51bWJlcixcbiAgICBzdGF0dXM6ICdwcm9jZXNzaW5nJyB8ICdjb21wbGV0ZWQnIHwgJ2ZhaWxlZCcsXG4gICAgZXJyb3JNZXNzYWdlPzogc3RyaW5nLFxuICAgIHByb2Nlc3NpbmdUaW1lPzogbnVtYmVyXG4gICk6IFByb21pc2U8R2VuZXJhdGlvbkhpc3Rvcnk+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXBkYXRlRmllbGRzOiBzdHJpbmdbXSA9IFsnc3RhdHVzID0gPyddO1xuICAgICAgY29uc3QgdXBkYXRlVmFsdWVzOiBhbnlbXSA9IFtzdGF0dXNdO1xuICAgICAgXG4gICAgICBpZiAoc3RhdHVzID09PSAnY29tcGxldGVkJyB8fCBzdGF0dXMgPT09ICdmYWlsZWQnKSB7XG4gICAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKCdjb21wbGV0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUCcpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKCdlcnJvcl9tZXNzYWdlID0gPycpO1xuICAgICAgICB1cGRhdGVWYWx1ZXMucHVzaChlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocHJvY2Vzc2luZ1RpbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1cGRhdGVGaWVsZHMucHVzaCgncHJvY2Vzc2luZ190aW1lID0gPycpO1xuICAgICAgICB1cGRhdGVWYWx1ZXMucHVzaChwcm9jZXNzaW5nVGltZSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHVwZGF0ZVZhbHVlcy5wdXNoKGhpc3RvcnlJZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiQ2xpZW50LmV4ZWN1dGUoe1xuICAgICAgICBzcWw6IGBVUERBVEUgZ2VuZXJhdGlvbl9oaXN0b3J5IFNFVCAke3VwZGF0ZUZpZWxkcy5qb2luKCcsICcpfSBXSEVSRSBpZCA9ID8gUkVUVVJOSU5HICpgLFxuICAgICAgICBhcmdzOiB1cGRhdGVWYWx1ZXNcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcign55Sf5oiQ5Y6G5Y+y6K6w5b2V5LiN5a2Y5ZyoJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHJlY29yZCA9IHJlc3VsdC5yb3dzWzBdIGFzIGFueTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiByZWNvcmQuaWQsXG4gICAgICAgIHVzZXJfaWQ6IHJlY29yZC51c2VyX2lkLFxuICAgICAgICBjcmVkaXRzX3VzZWQ6IHJlY29yZC5jcmVkaXRzX3VzZWQsXG4gICAgICAgIGNsb3RoaW5nX2NvdW50OiByZWNvcmQuY2xvdGhpbmdfY291bnQsXG4gICAgICAgIGdlbmVyYXRpb25fdHlwZTogcmVjb3JkLmdlbmVyYXRpb25fdHlwZSxcbiAgICAgICAgc3RhdHVzOiByZWNvcmQuc3RhdHVzLFxuICAgICAgICBlcnJvcl9tZXNzYWdlOiByZWNvcmQuZXJyb3JfbWVzc2FnZSxcbiAgICAgICAgcHJvY2Vzc2luZ190aW1lOiByZWNvcmQucHJvY2Vzc2luZ190aW1lLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZShyZWNvcmQuY3JlYXRlZF9hdCksXG4gICAgICAgIGNvbXBsZXRlZF9hdDogcmVjb3JkLmNvbXBsZXRlZF9hdCA/IG5ldyBEYXRlKHJlY29yZC5jb21wbGV0ZWRfYXQpIDogdW5kZWZpbmVkXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfmm7TmlrDnlJ/miJDljoblj7LnirbmgIHlpLHotKU6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8g6I635Y+W55So5oi355Sf5oiQ5Y6G5Y+yXG4gIHN0YXRpYyBhc3luYyBnZXRVc2VyR2VuZXJhdGlvbkhpc3RvcnkodXNlcklkOiBudW1iZXIsIGxpbWl0OiBudW1iZXIgPSA1MCk6IFByb21pc2U8R2VuZXJhdGlvbkhpc3RvcnlbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYkNsaWVudC5leGVjdXRlKHtcbiAgICAgICAgc3FsOiAnU0VMRUNUICogRlJPTSBnZW5lcmF0aW9uX2hpc3RvcnkgV0hFUkUgdXNlcl9pZCA9ID8gT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDIExJTUlUID8nLFxuICAgICAgICBhcmdzOiBbdXNlcklkLCBsaW1pdF1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzdWx0LnJvd3MubWFwKHJvdyA9PiAoe1xuICAgICAgICBpZDogcm93LmlkIGFzIG51bWJlcixcbiAgICAgICAgdXNlcl9pZDogcm93LnVzZXJfaWQgYXMgbnVtYmVyLFxuICAgICAgICBjcmVkaXRzX3VzZWQ6IHJvdy5jcmVkaXRzX3VzZWQgYXMgbnVtYmVyLFxuICAgICAgICBjbG90aGluZ19jb3VudDogcm93LmNsb3RoaW5nX2NvdW50IGFzIG51bWJlcixcbiAgICAgICAgZ2VuZXJhdGlvbl90eXBlOiByb3cuZ2VuZXJhdGlvbl90eXBlIGFzIGFueSxcbiAgICAgICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIGFueSxcbiAgICAgICAgZXJyb3JfbWVzc2FnZTogcm93LmVycm9yX21lc3NhZ2UgYXMgc3RyaW5nLFxuICAgICAgICBwcm9jZXNzaW5nX3RpbWU6IHJvdy5wcm9jZXNzaW5nX3RpbWUgYXMgbnVtYmVyLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZShyb3cuY3JlYXRlZF9hdCBhcyBzdHJpbmcpLFxuICAgICAgICBjb21wbGV0ZWRfYXQ6IHJvdy5jb21wbGV0ZWRfYXQgPyBuZXcgRGF0ZShyb3cuY29tcGxldGVkX2F0IGFzIHN0cmluZykgOiB1bmRlZmluZWRcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign6I635Y+W55Sf5oiQ5Y6G5Y+y5aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvLyDojrflj5bnlKjmiLfnp6/liIbnu5/orqFcbiAgc3RhdGljIGFzeW5jIGdldFVzZXJDcmVkaXRTdGF0cyh1c2VySWQ6IG51bWJlcikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbZ2VuZXJhdGlvblJlc3VsdCwgY2hlY2tpblJlc3VsdCwgcHVyY2hhc2VSZXN1bHRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAvLyDmn6Xor6LnlJ/miJDnu5/orqFcbiAgICAgICAgZGJDbGllbnQuZXhlY3V0ZSh7XG4gICAgICAgICAgc3FsOiBgU0VMRUNUIFxuICAgICAgICAgICAgICAgICAgQ09VTlQoKikgYXMgdG90YWxfZ2VuZXJhdGlvbnMsXG4gICAgICAgICAgICAgICAgICBDT1VOVChDQVNFIFdIRU4gc3RhdHVzID0gJ2NvbXBsZXRlZCcgVEhFTiAxIEVORCkgYXMgc3VjY2Vzc2Z1bF9nZW5lcmF0aW9ucyxcbiAgICAgICAgICAgICAgICAgIENPVU5UKENBU0UgV0hFTiBzdGF0dXMgPSAnZmFpbGVkJyBUSEVOIDEgRU5EKSBhcyBmYWlsZWRfZ2VuZXJhdGlvbnMsXG4gICAgICAgICAgICAgICAgICBTVU0oY3JlZGl0c191c2VkKSBhcyB0b3RhbF9jcmVkaXRzX3VzZWRcbiAgICAgICAgICAgICAgICBGUk9NIGdlbmVyYXRpb25faGlzdG9yeSBcbiAgICAgICAgICAgICAgICBXSEVSRSB1c2VyX2lkID0gP2AsXG4gICAgICAgICAgYXJnczogW3VzZXJJZF1cbiAgICAgICAgfSksXG4gICAgICAgIC8vIOafpeivouetvuWIsOe7n+iuoVxuICAgICAgICBkYkNsaWVudC5leGVjdXRlKHtcbiAgICAgICAgICBzcWw6IGBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgICBDT1VOVCgqKSBhcyB0b3RhbF9jaGVja2lucyxcbiAgICAgICAgICAgICAgICAgIFNVTShjcmVkaXRzX2F3YXJkZWQpIGFzIHRvdGFsX2NoZWNraW5fY3JlZGl0c1xuICAgICAgICAgICAgICAgIEZST00gdXNlcl9jaGVja2lucyBcbiAgICAgICAgICAgICAgICBXSEVSRSB1c2VyX2lkID0gP2AsXG4gICAgICAgICAgYXJnczogW3VzZXJJZF1cbiAgICAgICAgfSksXG4gICAgICAgIC8vIOafpeivouWFheWAvOe7n+iuoVxuICAgICAgICBkYkNsaWVudC5leGVjdXRlKHtcbiAgICAgICAgICBzcWw6IGBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgICBDT1VOVCgqKSBhcyB0b3RhbF9wdXJjaGFzZXMsXG4gICAgICAgICAgICAgICAgICBTVU0odG90YWxfY3JlZGl0cykgYXMgdG90YWxfcHVyY2hhc2VkX2NyZWRpdHNcbiAgICAgICAgICAgICAgICBGUk9NIGNyZWRpdF9wdXJjaGFzZXMgXG4gICAgICAgICAgICAgICAgV0hFUkUgdXNlcl9pZCA9ID9gLFxuICAgICAgICAgIGFyZ3M6IFt1c2VySWRdXG4gICAgICAgIH0pXG4gICAgICBdKTtcbiAgICAgIFxuICAgICAgY29uc3QgZ2VuU3RhdHMgPSBnZW5lcmF0aW9uUmVzdWx0LnJvd3NbMF0gYXMgYW55O1xuICAgICAgY29uc3QgY2hlY2tpblN0YXRzID0gY2hlY2tpblJlc3VsdC5yb3dzWzBdIGFzIGFueTtcbiAgICAgIGNvbnN0IHB1cmNoYXNlU3RhdHMgPSBwdXJjaGFzZVJlc3VsdC5yb3dzWzBdIGFzIGFueTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLy8g55Sf5oiQ57uf6K6hXG4gICAgICAgIHRvdGFsX2dlbmVyYXRpb25zOiBnZW5TdGF0cy50b3RhbF9nZW5lcmF0aW9ucyB8fCAwLFxuICAgICAgICBzdWNjZXNzZnVsX2dlbmVyYXRpb25zOiBnZW5TdGF0cy5zdWNjZXNzZnVsX2dlbmVyYXRpb25zIHx8IDAsXG4gICAgICAgIGZhaWxlZF9nZW5lcmF0aW9uczogZ2VuU3RhdHMuZmFpbGVkX2dlbmVyYXRpb25zIHx8IDAsXG4gICAgICAgIHRvdGFsX2NyZWRpdHNfdXNlZDogZ2VuU3RhdHMudG90YWxfY3JlZGl0c191c2VkIHx8IDAsXG4gICAgICAgIFxuICAgICAgICAvLyDnrb7liLDnu5/orqFcbiAgICAgICAgdG90YWxfY2hlY2tpbnM6IGNoZWNraW5TdGF0cy50b3RhbF9jaGVja2lucyB8fCAwLFxuICAgICAgICB0b3RhbF9jaGVja2luX2NyZWRpdHM6IGNoZWNraW5TdGF0cy50b3RhbF9jaGVja2luX2NyZWRpdHMgfHwgMCxcbiAgICAgICAgXG4gICAgICAgIC8vIOWFheWAvOe7n+iuoVxuICAgICAgICB0b3RhbF9wdXJjaGFzZXM6IHB1cmNoYXNlU3RhdHMudG90YWxfcHVyY2hhc2VzIHx8IDAsXG4gICAgICAgIHRvdGFsX3B1cmNoYXNlZF9jcmVkaXRzOiBwdXJjaGFzZVN0YXRzLnRvdGFsX3B1cmNoYXNlZF9jcmVkaXRzIHx8IDBcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPlueUqOaIt+enr+WIhue7n+iuoeWksei0pTonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbF9nZW5lcmF0aW9uczogMCxcbiAgICAgICAgc3VjY2Vzc2Z1bF9nZW5lcmF0aW9uczogMCxcbiAgICAgICAgZmFpbGVkX2dlbmVyYXRpb25zOiAwLFxuICAgICAgICB0b3RhbF9jcmVkaXRzX3VzZWQ6IDAsXG4gICAgICAgIHRvdGFsX2NoZWNraW5zOiAwLFxuICAgICAgICB0b3RhbF9jaGVja2luX2NyZWRpdHM6IDAsXG4gICAgICAgIHRvdGFsX3B1cmNoYXNlczogMCxcbiAgICAgICAgdG90YWxfcHVyY2hhc2VkX2NyZWRpdHM6IDBcbiAgICAgIH07XG4gICAgfVxuICB9XG59Il0sIm5hbWVzIjpbImRiQ2xpZW50IiwiQ3JlZGl0c0RBTyIsIkNSRURJVF9QQUNLQUdFUyIsIm5hbWUiLCJwcmljZSIsImJhc2VDcmVkaXRzIiwiYm9udXNDcmVkaXRzIiwidG90YWxDcmVkaXRzIiwiZGVzY3JpcHRpb24iLCJnZXRXZWVrTnVtYmVyIiwiZGF0ZSIsImZpcnN0RGF5T2ZZZWFyIiwiRGF0ZSIsImdldEZ1bGxZZWFyIiwicGFzdERheXNPZlllYXIiLCJnZXRUaW1lIiwiTWF0aCIsImNlaWwiLCJnZXREYXkiLCJ1c2VyQ2hlY2tpbiIsInVzZXJJZCIsInVzZXJMZXZlbCIsIm5vdyIsImlzV2Vla2x5VXNlciIsImNoZWNraW5UeXBlIiwiY2hlY2tpblBlcmlvZCIsInllYXIiLCJ3ZWVrIiwidG9TdHJpbmciLCJwYWRTdGFydCIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJleGlzdGluZ0NoZWNraW4iLCJleGVjdXRlIiwic3FsIiwiYXJncyIsInJvd3MiLCJsZW5ndGgiLCJwZXJpb2REZXNjIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJjcmVkaXRzQXdhcmRlZCIsImJhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwiZ2V0Q2hlY2tpblN0YXR1cyIsIm5leHRDaGVja2luVGltZSIsImNhbkNoZWNraW4iLCJ1bmRlZmluZWQiLCJnZXRVc2VyQ2hlY2tpbkhpc3RvcnkiLCJsaW1pdCIsInJlc3VsdCIsIm1hcCIsInJvdyIsImlkIiwidXNlcl9pZCIsImNoZWNraW5fdHlwZSIsImNoZWNraW5fcGVyaW9kIiwiY3JlZGl0c19hd2FyZGVkIiwiY3JlYXRlZF9hdCIsInB1cmNoYXNlQ3JlZGl0cyIsInBhY2thZ2VOYW1lIiwiYWRtaW5Ob3RlIiwicGFja2FnZUluZm8iLCJmaW5kIiwicGtnIiwiY3JlZGl0c0FkZGVkIiwibmV3VXNlckxldmVsIiwiZ2V0Q3JlZGl0UGFja2FnZXMiLCJnZXRVc2VyUHVyY2hhc2VIaXN0b3J5IiwicGFja2FnZV9uYW1lIiwicGFja2FnZV9wcmljZSIsImJhc2VfY3JlZGl0cyIsImJvbnVzX2NyZWRpdHMiLCJ0b3RhbF9jcmVkaXRzIiwicGF5bWVudF9tZXRob2QiLCJ0cmFuc2FjdGlvbl9zdGF0dXMiLCJhZG1pbl9ub3RlIiwiY3JlYXRlR2VuZXJhdGlvbkhpc3RvcnkiLCJjcmVkaXRzVXNlZCIsImNsb3RoaW5nQ291bnQiLCJnZW5lcmF0aW9uVHlwZSIsInJlY29yZCIsImNyZWRpdHNfdXNlZCIsImNsb3RoaW5nX2NvdW50IiwiZ2VuZXJhdGlvbl90eXBlIiwic3RhdHVzIiwidXBkYXRlR2VuZXJhdGlvblN0YXR1cyIsImhpc3RvcnlJZCIsImVycm9yTWVzc2FnZSIsInByb2Nlc3NpbmdUaW1lIiwidXBkYXRlRmllbGRzIiwidXBkYXRlVmFsdWVzIiwicHVzaCIsImpvaW4iLCJFcnJvciIsImVycm9yX21lc3NhZ2UiLCJwcm9jZXNzaW5nX3RpbWUiLCJjb21wbGV0ZWRfYXQiLCJnZXRVc2VyR2VuZXJhdGlvbkhpc3RvcnkiLCJnZXRVc2VyQ3JlZGl0U3RhdHMiLCJnZW5lcmF0aW9uUmVzdWx0IiwiY2hlY2tpblJlc3VsdCIsInB1cmNoYXNlUmVzdWx0IiwiUHJvbWlzZSIsImFsbCIsImdlblN0YXRzIiwiY2hlY2tpblN0YXRzIiwicHVyY2hhc2VTdGF0cyIsInRvdGFsX2dlbmVyYXRpb25zIiwic3VjY2Vzc2Z1bF9nZW5lcmF0aW9ucyIsImZhaWxlZF9nZW5lcmF0aW9ucyIsInRvdGFsX2NyZWRpdHNfdXNlZCIsInRvdGFsX2NoZWNraW5zIiwidG90YWxfY2hlY2tpbl9jcmVkaXRzIiwidG90YWxfcHVyY2hhc2VzIiwidG90YWxfcHVyY2hhc2VkX2NyZWRpdHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/dao/credits-dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/dao/user-dao.ts":
/*!*********************************!*\
  !*** ./src/lib/dao/user-dao.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserDAO: () => (/* binding */ UserDAO)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./src/lib/db.ts\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcrypt */ \"bcrypt\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcrypt__WEBPACK_IMPORTED_MODULE_1__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nclass UserDAO {\n    // 创建新用户\n    static async createUser(input) {\n        const { email, password } = input;\n        // 检查邮箱是否已存在\n        const existingUser = await this.findUserByEmail(email);\n        if (existingUser) {\n            throw new Error(\"邮箱已被注册\");\n        }\n        // 加密密码\n        const password_hash = await bcrypt__WEBPACK_IMPORTED_MODULE_1___default().hash(password, 12);\n        const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n            sql: `INSERT INTO users (email, password_hash, user_level, credits) \n            VALUES (?, ?, ?, ?) RETURNING *`,\n            args: [\n                email,\n                password_hash,\n                \"free\",\n                6\n            ]\n        });\n        const user = result.rows[0];\n        return {\n            id: user.id,\n            email: user.email,\n            password_hash: user.password_hash,\n            user_level: user.user_level,\n            credits: user.credits,\n            wechat_upgraded: Boolean(user.wechat_upgraded),\n            created_at: new Date(user.created_at),\n            updated_at: new Date(user.updated_at)\n        };\n    }\n    // 根据邮箱查找用户\n    static async findUserByEmail(email) {\n        const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n            sql: \"SELECT * FROM users WHERE email = ?\",\n            args: [\n                email\n            ]\n        });\n        if (result.rows.length === 0) {\n            return null;\n        }\n        const user = result.rows[0];\n        return {\n            id: user.id,\n            email: user.email,\n            password_hash: user.password_hash,\n            user_level: user.user_level,\n            credits: user.credits,\n            wechat_upgraded: Boolean(user.wechat_upgraded),\n            created_at: new Date(user.created_at),\n            updated_at: new Date(user.updated_at)\n        };\n    }\n    // 根据ID查找用户\n    static async findUserById(id) {\n        const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n            sql: \"SELECT * FROM users WHERE id = ?\",\n            args: [\n                id\n            ]\n        });\n        if (result.rows.length === 0) {\n            return null;\n        }\n        const user = result.rows[0];\n        return {\n            id: user.id,\n            email: user.email,\n            password_hash: user.password_hash,\n            user_level: user.user_level,\n            credits: user.credits,\n            wechat_upgraded: Boolean(user.wechat_upgraded),\n            created_at: new Date(user.created_at),\n            updated_at: new Date(user.updated_at)\n        };\n    }\n    // 验证密码\n    static async verifyPassword(plainPassword, hashedPassword) {\n        return await bcrypt__WEBPACK_IMPORTED_MODULE_1___default().compare(plainPassword, hashedPassword);\n    }\n    // 更新用户信息\n    static async updateUser(userId, input) {\n        const updateFields = [];\n        const updateValues = [];\n        if (input.user_level !== undefined) {\n            updateFields.push(\"user_level = ?\");\n            updateValues.push(input.user_level);\n        }\n        if (input.credits !== undefined) {\n            updateFields.push(\"credits = ?\");\n            updateValues.push(input.credits);\n        }\n        if (input.wechat_upgraded !== undefined) {\n            updateFields.push(\"wechat_upgraded = ?\");\n            updateValues.push(input.wechat_upgraded);\n        }\n        updateFields.push(\"updated_at = CURRENT_TIMESTAMP\");\n        updateValues.push(userId);\n        const sql = `UPDATE users SET ${updateFields.join(\", \")} WHERE id = ? RETURNING *`;\n        const result = await _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n            sql,\n            args: updateValues\n        });\n        if (result.rows.length === 0) {\n            throw new Error(\"用户不存在\");\n        }\n        const user = result.rows[0];\n        return {\n            id: user.id,\n            email: user.email,\n            password_hash: user.password_hash,\n            user_level: user.user_level,\n            credits: user.credits,\n            wechat_upgraded: Boolean(user.wechat_upgraded),\n            created_at: new Date(user.created_at),\n            updated_at: new Date(user.updated_at)\n        };\n    }\n    // 扣除用户积分\n    static async deductCredits(userId, creditsToDeduct) {\n        // 先查询当前积分\n        const user = await this.findUserById(userId);\n        if (!user) {\n            throw new Error(\"用户不存在\");\n        }\n        if (user.credits < creditsToDeduct) {\n            throw new Error(\"积分不足\");\n        }\n        return await this.updateUser(userId, {\n            credits: user.credits - creditsToDeduct\n        });\n    }\n    // 增加用户积分\n    static async addCredits(userId, creditsToAdd) {\n        const user = await this.findUserById(userId);\n        if (!user) {\n            throw new Error(\"用户不存在\");\n        }\n        return await this.updateUser(userId, {\n            credits: user.credits + creditsToAdd\n        });\n    }\n    // 更新用户积分（可正可负）\n    static async updateUserCredits(userId, creditsDelta) {\n        const user = await this.findUserById(userId);\n        if (!user) {\n            throw new Error(\"用户不存在\");\n        }\n        const newCredits = user.credits + creditsDelta;\n        if (newCredits < 0) {\n            throw new Error(\"积分不足\");\n        }\n        return await this.updateUser(userId, {\n            credits: newCredits\n        });\n    }\n    // 检查用户等级\n    static async getUserLevel(userId) {\n        const user = await this.findUserById(userId);\n        return user ? user.user_level : null;\n    }\n    // 检查用户是否为Plus或Pro用户\n    static async isPremiumUser(userId) {\n        const user = await this.findUserById(userId);\n        return user ? user.user_level === \"plus\" || user.user_level === \"pro\" : false;\n    }\n    // 检查用户是否为Pro用户\n    static async isProUser(userId) {\n        const user = await this.findUserById(userId);\n        return user ? user.user_level === \"pro\" : false;\n    }\n    // 微信升级用户为Plus\n    static async upgradeToPlusUser(userId) {\n        return await this.updateUser(userId, {\n            user_level: \"plus\",\n            wechat_upgraded: true\n        });\n    }\n    // 购买积分包升级用户为Pro\n    static async upgradeToProUser(userId) {\n        return await this.updateUser(userId, {\n            user_level: \"pro\"\n        });\n    }\n    // 获取用户统计信息\n    static async getUserStats(userId) {\n        const [generationResult, creditsResult] = await Promise.all([\n            // 查询生成历史统计\n            _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: `SELECT \n                COUNT(*) as total_generations,\n                COUNT(CASE WHEN status = 'completed' THEN 1 END) as successful_generations,\n                COUNT(CASE WHEN status = 'failed' THEN 1 END) as failed_generations,\n                SUM(credits_used) as total_credits_used\n              FROM generation_history \n              WHERE user_id = ?`,\n                args: [\n                    userId\n                ]\n            }),\n            // 查询当前积分\n            _db__WEBPACK_IMPORTED_MODULE_0__.dbClient.execute({\n                sql: \"SELECT credits FROM users WHERE id = ?\",\n                args: [\n                    userId\n                ]\n            })\n        ]);\n        const stats = generationResult.rows[0];\n        const credits = creditsResult.rows[0];\n        return {\n            total_generations: stats.total_generations || 0,\n            successful_generations: stats.successful_generations || 0,\n            failed_generations: stats.failed_generations || 0,\n            total_credits_used: stats.total_credits_used || 0,\n            current_credits: credits?.credits || 0\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSSxDQUFDLEVBQUU7UUFDdEMsTUFBTUcsVUFBVWlDLGNBQWNwQyxJQUFJLENBQUMsRUFBRTtRQUVyQyxPQUFPO1lBQ0x3QyxtQkFBbUJELE1BQU1DLGlCQUFpQixJQUFJO1lBQzlDQyx3QkFBd0JGLE1BQU1FLHNCQUFzQixJQUFJO1lBQ3hEQyxvQkFBb0JILE1BQU1HLGtCQUFrQixJQUFJO1lBQ2hEQyxvQkFBb0JKLE1BQU1JLGtCQUFrQixJQUFJO1lBQ2hEQyxpQkFBaUJ6QyxTQUFTQSxXQUFXO1FBQ3ZDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25hYmFiYS1kcmVzcy8uL3NyYy9saWIvZGFvL3VzZXItZGFvLnRzPzYxYTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGJDbGllbnQgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlciB7XG4gIGlkOiBudW1iZXI7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBhc3N3b3JkX2hhc2g6IHN0cmluZztcbiAgdXNlcl9sZXZlbDogJ2ZyZWUnIHwgJ3BsdXMnIHwgJ3Bybyc7XG4gIGNyZWRpdHM6IG51bWJlcjtcbiAgd2VjaGF0X3VwZ3JhZGVkOiBib29sZWFuO1xuICBjcmVhdGVkX2F0OiBEYXRlO1xuICB1cGRhdGVkX2F0OiBEYXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVVzZXJJbnB1dCB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlVXNlcklucHV0IHtcbiAgdXNlcl9sZXZlbD86ICdmcmVlJyB8ICdwbHVzJyB8ICdwcm8nO1xuICBjcmVkaXRzPzogbnVtYmVyO1xuICB3ZWNoYXRfdXBncmFkZWQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgVXNlckRBTyB7XG4gIFxuICAvLyDliJvlu7rmlrDnlKjmiLdcbiAgc3RhdGljIGFzeW5jIGNyZWF0ZVVzZXIoaW5wdXQ6IENyZWF0ZVVzZXJJbnB1dCk6IFByb21pc2U8VXNlcj4ge1xuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSBpbnB1dDtcbiAgICBcbiAgICAvLyDmo4Dmn6Xpgq7nrrHmmK/lkKblt7LlrZjlnKhcbiAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCB0aGlzLmZpbmRVc2VyQnlFbWFpbChlbWFpbCk7XG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfpgq7nrrHlt7Looqvms6jlhownKTtcbiAgICB9XG4gICAgXG4gICAgLy8g5Yqg5a+G5a+G56CBXG4gICAgY29uc3QgcGFzc3dvcmRfaGFzaCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMik7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJDbGllbnQuZXhlY3V0ZSh7XG4gICAgICBzcWw6IGBJTlNFUlQgSU5UTyB1c2VycyAoZW1haWwsIHBhc3N3b3JkX2hhc2gsIHVzZXJfbGV2ZWwsIGNyZWRpdHMpIFxuICAgICAgICAgICAgVkFMVUVTICg/LCA/LCA/LCA/KSBSRVRVUk5JTkcgKmAsXG4gICAgICBhcmdzOiBbZW1haWwsIHBhc3N3b3JkX2hhc2gsICdmcmVlJywgNl1cbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCB1c2VyID0gcmVzdWx0LnJvd3NbMF0gYXMgYW55O1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdXNlci5pZCxcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgcGFzc3dvcmRfaGFzaDogdXNlci5wYXNzd29yZF9oYXNoLFxuICAgICAgdXNlcl9sZXZlbDogdXNlci51c2VyX2xldmVsLFxuICAgICAgY3JlZGl0czogdXNlci5jcmVkaXRzLFxuICAgICAgd2VjaGF0X3VwZ3JhZGVkOiBCb29sZWFuKHVzZXIud2VjaGF0X3VwZ3JhZGVkKSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKHVzZXIuY3JlYXRlZF9hdCksXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSh1c2VyLnVwZGF0ZWRfYXQpXG4gICAgfTtcbiAgfVxuICBcbiAgLy8g5qC55o2u6YKu566x5p+l5om+55So5oi3XG4gIHN0YXRpYyBhc3luYyBmaW5kVXNlckJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYkNsaWVudC5leGVjdXRlKHtcbiAgICAgIHNxbDogJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgZW1haWwgPSA/JyxcbiAgICAgIGFyZ3M6IFtlbWFpbF1cbiAgICB9KTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdXNlciA9IHJlc3VsdC5yb3dzWzBdIGFzIGFueTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHBhc3N3b3JkX2hhc2g6IHVzZXIucGFzc3dvcmRfaGFzaCxcbiAgICAgIHVzZXJfbGV2ZWw6IHVzZXIudXNlcl9sZXZlbCxcbiAgICAgIGNyZWRpdHM6IHVzZXIuY3JlZGl0cyxcbiAgICAgIHdlY2hhdF91cGdyYWRlZDogQm9vbGVhbih1c2VyLndlY2hhdF91cGdyYWRlZCksXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSh1c2VyLmNyZWF0ZWRfYXQpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUodXNlci51cGRhdGVkX2F0KVxuICAgIH07XG4gIH1cbiAgXG4gIC8vIOagueaNrklE5p+l5om+55So5oi3XG4gIHN0YXRpYyBhc3luYyBmaW5kVXNlckJ5SWQoaWQ6IG51bWJlcik6IFByb21pc2U8VXNlciB8IG51bGw+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYkNsaWVudC5leGVjdXRlKHtcbiAgICAgIHNxbDogJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgaWQgPSA/JyxcbiAgICAgIGFyZ3M6IFtpZF1cbiAgICB9KTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdXNlciA9IHJlc3VsdC5yb3dzWzBdIGFzIGFueTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHBhc3N3b3JkX2hhc2g6IHVzZXIucGFzc3dvcmRfaGFzaCxcbiAgICAgIHVzZXJfbGV2ZWw6IHVzZXIudXNlcl9sZXZlbCxcbiAgICAgIGNyZWRpdHM6IHVzZXIuY3JlZGl0cyxcbiAgICAgIHdlY2hhdF91cGdyYWRlZDogQm9vbGVhbih1c2VyLndlY2hhdF91cGdyYWRlZCksXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSh1c2VyLmNyZWF0ZWRfYXQpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUodXNlci51cGRhdGVkX2F0KVxuICAgIH07XG4gIH1cbiAgXG4gIC8vIOmqjOivgeWvhueggVxuICBzdGF0aWMgYXN5bmMgdmVyaWZ5UGFzc3dvcmQocGxhaW5QYXNzd29yZDogc3RyaW5nLCBoYXNoZWRQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIGF3YWl0IGJjcnlwdC5jb21wYXJlKHBsYWluUGFzc3dvcmQsIGhhc2hlZFBhc3N3b3JkKTtcbiAgfVxuICBcbiAgLy8g5pu05paw55So5oi35L+h5oGvXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVVc2VyKHVzZXJJZDogbnVtYmVyLCBpbnB1dDogVXBkYXRlVXNlcklucHV0KTogUHJvbWlzZTxVc2VyPiB7XG4gICAgY29uc3QgdXBkYXRlRmllbGRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHVwZGF0ZVZhbHVlczogYW55W10gPSBbXTtcbiAgICBcbiAgICBpZiAoaW5wdXQudXNlcl9sZXZlbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB1cGRhdGVGaWVsZHMucHVzaCgndXNlcl9sZXZlbCA9ID8nKTtcbiAgICAgIHVwZGF0ZVZhbHVlcy5wdXNoKGlucHV0LnVzZXJfbGV2ZWwpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoaW5wdXQuY3JlZGl0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB1cGRhdGVGaWVsZHMucHVzaCgnY3JlZGl0cyA9ID8nKTtcbiAgICAgIHVwZGF0ZVZhbHVlcy5wdXNoKGlucHV0LmNyZWRpdHMpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoaW5wdXQud2VjaGF0X3VwZ3JhZGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKCd3ZWNoYXRfdXBncmFkZWQgPSA/Jyk7XG4gICAgICB1cGRhdGVWYWx1ZXMucHVzaChpbnB1dC53ZWNoYXRfdXBncmFkZWQpO1xuICAgIH1cbiAgICBcbiAgICB1cGRhdGVGaWVsZHMucHVzaCgndXBkYXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QJyk7XG4gICAgdXBkYXRlVmFsdWVzLnB1c2godXNlcklkKTtcbiAgICBcbiAgICBjb25zdCBzcWwgPSBgVVBEQVRFIHVzZXJzIFNFVCAke3VwZGF0ZUZpZWxkcy5qb2luKCcsICcpfSBXSEVSRSBpZCA9ID8gUkVUVVJOSU5HICpgO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiQ2xpZW50LmV4ZWN1dGUoe1xuICAgICAgc3FsLFxuICAgICAgYXJnczogdXBkYXRlVmFsdWVzXG4gICAgfSk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfnlKjmiLfkuI3lrZjlnKgnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdXNlciA9IHJlc3VsdC5yb3dzWzBdIGFzIGFueTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHBhc3N3b3JkX2hhc2g6IHVzZXIucGFzc3dvcmRfaGFzaCxcbiAgICAgIHVzZXJfbGV2ZWw6IHVzZXIudXNlcl9sZXZlbCxcbiAgICAgIGNyZWRpdHM6IHVzZXIuY3JlZGl0cyxcbiAgICAgIHdlY2hhdF91cGdyYWRlZDogQm9vbGVhbih1c2VyLndlY2hhdF91cGdyYWRlZCksXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSh1c2VyLmNyZWF0ZWRfYXQpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUodXNlci51cGRhdGVkX2F0KVxuICAgIH07XG4gIH1cbiAgXG4gIC8vIOaJo+mZpOeUqOaIt+enr+WIhlxuICBzdGF0aWMgYXN5bmMgZGVkdWN0Q3JlZGl0cyh1c2VySWQ6IG51bWJlciwgY3JlZGl0c1RvRGVkdWN0OiBudW1iZXIpOiBQcm9taXNlPFVzZXI+IHtcbiAgICAvLyDlhYjmn6Xor6LlvZPliY3np6/liIZcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5maW5kVXNlckJ5SWQodXNlcklkKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign55So5oi35LiN5a2Y5ZyoJyk7XG4gICAgfVxuICAgIFxuICAgIGlmICh1c2VyLmNyZWRpdHMgPCBjcmVkaXRzVG9EZWR1Y3QpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign56ev5YiG5LiN6LazJyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVVzZXIodXNlcklkLCB7XG4gICAgICBjcmVkaXRzOiB1c2VyLmNyZWRpdHMgLSBjcmVkaXRzVG9EZWR1Y3RcbiAgICB9KTtcbiAgfVxuICBcbiAgLy8g5aKe5Yqg55So5oi356ev5YiGXG4gIHN0YXRpYyBhc3luYyBhZGRDcmVkaXRzKHVzZXJJZDogbnVtYmVyLCBjcmVkaXRzVG9BZGQ6IG51bWJlcik6IFByb21pc2U8VXNlcj4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmZpbmRVc2VyQnlJZCh1c2VySWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfnlKjmiLfkuI3lrZjlnKgnKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudXBkYXRlVXNlcih1c2VySWQsIHtcbiAgICAgIGNyZWRpdHM6IHVzZXIuY3JlZGl0cyArIGNyZWRpdHNUb0FkZFxuICAgIH0pO1xuICB9XG4gIFxuICAvLyDmm7TmlrDnlKjmiLfnp6/liIbvvIjlj6/mraPlj6/otJ/vvIlcbiAgc3RhdGljIGFzeW5jIHVwZGF0ZVVzZXJDcmVkaXRzKHVzZXJJZDogbnVtYmVyLCBjcmVkaXRzRGVsdGE6IG51bWJlcik6IFByb21pc2U8VXNlcj4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmZpbmRVc2VyQnlJZCh1c2VySWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfnlKjmiLfkuI3lrZjlnKgnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgbmV3Q3JlZGl0cyA9IHVzZXIuY3JlZGl0cyArIGNyZWRpdHNEZWx0YTtcbiAgICBpZiAobmV3Q3JlZGl0cyA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign56ev5YiG5LiN6LazJyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVVzZXIodXNlcklkLCB7XG4gICAgICBjcmVkaXRzOiBuZXdDcmVkaXRzXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIOajgOafpeeUqOaIt+etiee6p1xuICBzdGF0aWMgYXN5bmMgZ2V0VXNlckxldmVsKHVzZXJJZDogbnVtYmVyKTogUHJvbWlzZTwnZnJlZScgfCAncGx1cycgfCAncHJvJyB8IG51bGw+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5maW5kVXNlckJ5SWQodXNlcklkKTtcbiAgICByZXR1cm4gdXNlciA/IHVzZXIudXNlcl9sZXZlbCA6IG51bGw7XG4gIH1cbiAgXG4gIC8vIOajgOafpeeUqOaIt+aYr+WQpuS4ulBsdXPmiJZQcm/nlKjmiLdcbiAgc3RhdGljIGFzeW5jIGlzUHJlbWl1bVVzZXIodXNlcklkOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5maW5kVXNlckJ5SWQodXNlcklkKTtcbiAgICByZXR1cm4gdXNlciA/ICh1c2VyLnVzZXJfbGV2ZWwgPT09ICdwbHVzJyB8fCB1c2VyLnVzZXJfbGV2ZWwgPT09ICdwcm8nKSA6IGZhbHNlO1xuICB9XG4gIFxuICAvLyDmo4Dmn6XnlKjmiLfmmK/lkKbkuLpQcm/nlKjmiLdcbiAgc3RhdGljIGFzeW5jIGlzUHJvVXNlcih1c2VySWQ6IG51bWJlcik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmZpbmRVc2VyQnlJZCh1c2VySWQpO1xuICAgIHJldHVybiB1c2VyID8gdXNlci51c2VyX2xldmVsID09PSAncHJvJyA6IGZhbHNlO1xuICB9XG4gIFxuICAvLyDlvq7kv6HljYfnuqfnlKjmiLfkuLpQbHVzXG4gIHN0YXRpYyBhc3luYyB1cGdyYWRlVG9QbHVzVXNlcih1c2VySWQ6IG51bWJlcik6IFByb21pc2U8VXNlcj4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVVzZXIodXNlcklkLCB7XG4gICAgICB1c2VyX2xldmVsOiAncGx1cycsXG4gICAgICB3ZWNoYXRfdXBncmFkZWQ6IHRydWVcbiAgICB9KTtcbiAgfVxuICBcbiAgLy8g6LSt5Lmw56ev5YiG5YyF5Y2H57qn55So5oi35Li6UHJvXG4gIHN0YXRpYyBhc3luYyB1cGdyYWRlVG9Qcm9Vc2VyKHVzZXJJZDogbnVtYmVyKTogUHJvbWlzZTxVc2VyPiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudXBkYXRlVXNlcih1c2VySWQsIHtcbiAgICAgIHVzZXJfbGV2ZWw6ICdwcm8nXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIOiOt+WPlueUqOaIt+e7n+iuoeS/oeaBr1xuICBzdGF0aWMgYXN5bmMgZ2V0VXNlclN0YXRzKHVzZXJJZDogbnVtYmVyKSB7XG4gICAgY29uc3QgW2dlbmVyYXRpb25SZXN1bHQsIGNyZWRpdHNSZXN1bHRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgLy8g5p+l6K+i55Sf5oiQ5Y6G5Y+y57uf6K6hXG4gICAgICBkYkNsaWVudC5leGVjdXRlKHtcbiAgICAgICAgc3FsOiBgU0VMRUNUIFxuICAgICAgICAgICAgICAgIENPVU5UKCopIGFzIHRvdGFsX2dlbmVyYXRpb25zLFxuICAgICAgICAgICAgICAgIENPVU5UKENBU0UgV0hFTiBzdGF0dXMgPSAnY29tcGxldGVkJyBUSEVOIDEgRU5EKSBhcyBzdWNjZXNzZnVsX2dlbmVyYXRpb25zLFxuICAgICAgICAgICAgICAgIENPVU5UKENBU0UgV0hFTiBzdGF0dXMgPSAnZmFpbGVkJyBUSEVOIDEgRU5EKSBhcyBmYWlsZWRfZ2VuZXJhdGlvbnMsXG4gICAgICAgICAgICAgICAgU1VNKGNyZWRpdHNfdXNlZCkgYXMgdG90YWxfY3JlZGl0c191c2VkXG4gICAgICAgICAgICAgIEZST00gZ2VuZXJhdGlvbl9oaXN0b3J5IFxuICAgICAgICAgICAgICBXSEVSRSB1c2VyX2lkID0gP2AsXG4gICAgICAgIGFyZ3M6IFt1c2VySWRdXG4gICAgICB9KSxcbiAgICAgIC8vIOafpeivouW9k+WJjeenr+WIhlxuICAgICAgZGJDbGllbnQuZXhlY3V0ZSh7XG4gICAgICAgIHNxbDogJ1NFTEVDVCBjcmVkaXRzIEZST00gdXNlcnMgV0hFUkUgaWQgPSA/JyxcbiAgICAgICAgYXJnczogW3VzZXJJZF1cbiAgICAgIH0pXG4gICAgXSk7XG4gICAgXG4gICAgY29uc3Qgc3RhdHMgPSBnZW5lcmF0aW9uUmVzdWx0LnJvd3NbMF0gYXMgYW55O1xuICAgIGNvbnN0IGNyZWRpdHMgPSBjcmVkaXRzUmVzdWx0LnJvd3NbMF0gYXMgYW55O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbF9nZW5lcmF0aW9uczogc3RhdHMudG90YWxfZ2VuZXJhdGlvbnMgfHwgMCxcbiAgICAgIHN1Y2Nlc3NmdWxfZ2VuZXJhdGlvbnM6IHN0YXRzLnN1Y2Nlc3NmdWxfZ2VuZXJhdGlvbnMgfHwgMCxcbiAgICAgIGZhaWxlZF9nZW5lcmF0aW9uczogc3RhdHMuZmFpbGVkX2dlbmVyYXRpb25zIHx8IDAsXG4gICAgICB0b3RhbF9jcmVkaXRzX3VzZWQ6IHN0YXRzLnRvdGFsX2NyZWRpdHNfdXNlZCB8fCAwLFxuICAgICAgY3VycmVudF9jcmVkaXRzOiBjcmVkaXRzPy5jcmVkaXRzIHx8IDBcbiAgICB9O1xuICB9XG59Il0sIm5hbWVzIjpbImRiQ2xpZW50IiwiYmNyeXB0IiwiVXNlckRBTyIsImNyZWF0ZVVzZXIiLCJpbnB1dCIsImVtYWlsIiwicGFzc3dvcmQiLCJleGlzdGluZ1VzZXIiLCJmaW5kVXNlckJ5RW1haWwiLCJFcnJvciIsInBhc3N3b3JkX2hhc2giLCJoYXNoIiwicmVzdWx0IiwiZXhlY3V0ZSIsInNxbCIsImFyZ3MiLCJ1c2VyIiwicm93cyIsImlkIiwidXNlcl9sZXZlbCIsImNyZWRpdHMiLCJ3ZWNoYXRfdXBncmFkZWQiLCJCb29sZWFuIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ1cGRhdGVkX2F0IiwibGVuZ3RoIiwiZmluZFVzZXJCeUlkIiwidmVyaWZ5UGFzc3dvcmQiLCJwbGFpblBhc3N3b3JkIiwiaGFzaGVkUGFzc3dvcmQiLCJjb21wYXJlIiwidXBkYXRlVXNlciIsInVzZXJJZCIsInVwZGF0ZUZpZWxkcyIsInVwZGF0ZVZhbHVlcyIsInVuZGVmaW5lZCIsInB1c2giLCJqb2luIiwiZGVkdWN0Q3JlZGl0cyIsImNyZWRpdHNUb0RlZHVjdCIsImFkZENyZWRpdHMiLCJjcmVkaXRzVG9BZGQiLCJ1cGRhdGVVc2VyQ3JlZGl0cyIsImNyZWRpdHNEZWx0YSIsIm5ld0NyZWRpdHMiLCJnZXRVc2VyTGV2ZWwiLCJpc1ByZW1pdW1Vc2VyIiwiaXNQcm9Vc2VyIiwidXBncmFkZVRvUGx1c1VzZXIiLCJ1cGdyYWRlVG9Qcm9Vc2VyIiwiZ2V0VXNlclN0YXRzIiwiZ2VuZXJhdGlvblJlc3VsdCIsImNyZWRpdHNSZXN1bHQiLCJQcm9taXNlIiwiYWxsIiwic3RhdHMiLCJ0b3RhbF9nZW5lcmF0aW9ucyIsInN1Y2Nlc3NmdWxfZ2VuZXJhdGlvbnMiLCJmYWlsZWRfZ2VuZXJhdGlvbnMiLCJ0b3RhbF9jcmVkaXRzX3VzZWQiLCJjdXJyZW50X2NyZWRpdHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/dao/user-dao.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dbClient: () => (/* binding */ dbClient)\n/* harmony export */ });\n/* harmony import */ var _libsql_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @libsql/client */ \"@libsql/client\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_libsql_client__WEBPACK_IMPORTED_MODULE_0__]);\n_libsql_client__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst dbClient = (0,_libsql_client__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n    url: process.env.TURSO_DATABASE_URL,\n    authToken: process.env.TURSO_AUTH_TOKEN\n});\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQThDO0FBRTlDLE1BQU1DLFdBQVdELDREQUFZQSxDQUFDO0lBQzVCRSxLQUFLQyxRQUFRQyxHQUFHLENBQUNDLGtCQUFrQjtJQUNuQ0MsV0FBV0gsUUFBUUMsR0FBRyxDQUFDRyxnQkFBZ0I7QUFDekM7QUFFb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uYWJhYmEtZHJlc3MvLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQGxpYnNxbC9jbGllbnQnO1xuXG5jb25zdCBkYkNsaWVudCA9IGNyZWF0ZUNsaWVudCh7XG4gIHVybDogcHJvY2Vzcy5lbnYuVFVSU09fREFUQUJBU0VfVVJMISxcbiAgYXV0aFRva2VuOiBwcm9jZXNzLmVudi5UVVJTT19BVVRIX1RPS0VOISxcbn0pO1xuXG5leHBvcnQgeyBkYkNsaWVudCB9OyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJkYkNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJUVVJTT19EQVRBQkFTRV9VUkwiLCJhdXRoVG9rZW4iLCJUVVJTT19BVVRIX1RPS0VOIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/oauth","vendor-chunks/object-hash","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/lru-cache","vendor-chunks/cookie","vendor-chunks/@panva","vendor-chunks/oidc-token-hash","vendor-chunks/zod"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate%2Froute&page=%2Fapi%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbytedance%2FDesktop%2Fnababa-dress&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();