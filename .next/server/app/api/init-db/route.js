"use strict";(()=>{var e={};e.id=102,e.ids=[102],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84629:e=>{e.exports=import("@libsql/client")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},12600:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>d,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a=r(49303),n=r(88716),o=r(60670),i=r(42100),c=e([i]);i=(c.then?(await c)():c)[0];let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/init-db/route",pathname:"/api/init-db",filename:"route",bundlePath:"app/api/init-db/route"},resolvedPagePath:"/Users/bytedance/Desktop/nababa-dress/src/app/api/init-db/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:h}=u,d="/api/init-db/route";function l(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}s()}catch(e){s(e)}})},42100:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>c,POST:()=>i});var a=r(87070),n=r(87034),o=e([n]);async function i(){try{await (0,n.xq)(),await (0,n.xN)();let e=await (0,n.aI)();return a.NextResponse.json({success:!0,message:"数据库迁移和初始化成功",tables:e})}catch(e){return a.NextResponse.json({success:!1,message:"数据库初始化失败",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(){try{let e=await (0,n.aI)();return a.NextResponse.json({success:!0,message:"数据库表状态检查",tables:e})}catch(e){return a.NextResponse.json({success:!1,message:"检查数据库表失败",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}n=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},75748:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{w:()=>o});var a=r(84629),n=e([a]);a=(n.then?(await n)():n)[0];let o=(0,a.createClient)({url:process.env.TURSO_DATABASE_URL,authToken:process.env.TURSO_AUTH_TOKEN});s()}catch(e){s(e)}})},87034:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{aI:()=>m,xN:()=>u,xq:()=>p});var a=r(75748),n=r(57147),o=r.n(n),i=r(71017),c=r.n(i),l=e([a]);async function u(){try{let e=c().join(process.cwd(),"src","lib","db-schema.sql");for(let t of o().readFileSync(e,"utf8").split(";").map(e=>e.trim()).filter(e=>e.length>0))t.trim()&&(await a.w.execute(t),console.log("执行SQL语句成功:",t.substring(0,50)+"..."));return console.log("数据库表初始化完成"),!0}catch(e){throw console.error("数据库初始化失败:",e),e}}async function p(){try{let e=c().join(process.cwd(),"src","lib","migrate-to-vip.sql");for(let t of o().readFileSync(e,"utf8").split(";").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("--")))t.trim()&&(await a.w.execute(t),console.log("执行迁移语句:",t.substring(0,50)+"..."));return console.log("数据库迁移完成"),!0}catch(e){throw console.error("数据库迁移失败:",e),e}}async function m(){try{let e=await Promise.all(["SELECT name FROM sqlite_master WHERE type='table' AND name='users'","SELECT name FROM sqlite_master WHERE type='table' AND name='user_checkins'","SELECT name FROM sqlite_master WHERE type='table' AND name='credit_purchases'","SELECT name FROM sqlite_master WHERE type='table' AND name='generation_history'","SELECT name FROM sqlite_master WHERE type='table' AND name='sessions'"].map(e=>a.w.execute(e))),t=["users","user_checkins","credit_purchases","generation_history","sessions"],r=e.map((e,r)=>({name:t[r],exists:e.rows.length>0}));return console.log("数据库表状态:",r),r}catch(e){throw console.error("检查数据库表失败:",e),e}}a=(l.then?(await l)():l)[0],s()}catch(e){s(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(12600));module.exports=s})();