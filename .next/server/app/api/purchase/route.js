"use strict";(()=>{var e={};e.id=438,e.ids=[438],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84629:e=>{e.exports=import("@libsql/client")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},82716:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{originalPathname:()=>m,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>l,staticGenerationAsyncStorage:()=>x});var a=t(49303),n=t(88716),o=t(60670),i=t(58517),u=e([i]);i=(u.then?(await u)():u)[0];let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/purchase/route",pathname:"/api/purchase",filename:"route",bundlePath:"app/api/purchase/route"},resolvedPagePath:"/Users/bytedance/Desktop/nababa-dress/src/app/api/purchase/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:x,serverHooks:l}=p,m="/api/purchase/route";function c(){return(0,o.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:x})}r()}catch(e){r(e)}})},58517:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{GET:()=>d,POST:()=>p});var a=t(87070),n=t(45609),o=t(95456),i=t(18289),u=t(17114),c=e([o,i]);[o,i]=c.then?(await c)():c;let x=u.Ry({packageName:u.Z_().min(1,"请选择积分包"),adminNote:u.Z_().optional()});async function p(e){try{let s=await (0,n.getServerSession)(o.L);if(!s?.user?.id)return a.NextResponse.json({success:!1,message:"请先登录"},{status:401});let t=parseInt(s.user.id),r=await e.json(),u=x.safeParse(r);if(!u.success)return a.NextResponse.json({success:!1,message:"输入数据无效",errors:u.error.issues},{status:400});let{packageName:c,adminNote:p}=u.data,d=await i.K.purchaseCredits(t,c,p);if(d.success)return a.NextResponse.json({success:!0,message:d.message,data:{creditsAdded:d.creditsAdded,newUserLevel:d.newUserLevel}});return a.NextResponse.json({success:!1,message:d.message},{status:400})}catch(e){return console.error("积分充值失败:",e),a.NextResponse.json({success:!1,message:"充值失败，请稍后重试"},{status:500})}}async function d(e){try{let e=i.K.getCreditPackages();return a.NextResponse.json({success:!0,data:e})}catch(e){return console.error("获取积分包列表失败:",e),a.NextResponse.json({success:!1,message:"获取积分包列表失败，请稍后重试"},{status:500})}}r()}catch(e){r(e)}})}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,972,857,114,163],()=>t(82716));module.exports=r})();