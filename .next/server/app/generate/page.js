(()=>{var e={};e.id=811,e.ids=[811],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29735:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>o,pages:()=>x,routeModule:()=>m,tree:()=>d}),a(14807),a(44500),a(35866);var l=a(23191),r=a(88716),t=a(37922),n=a.n(t),i=a(95231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);a.d(s,c);let d=["",{children:["generate",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,14807)),"/Users/bytedance/Desktop/nababa-dress/src/app/generate/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,44500)),"/Users/bytedance/Desktop/nababa-dress/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],x=["/Users/bytedance/Desktop/nababa-dress/src/app/generate/page.tsx"],o="/generate/page",h={require:a,loadChunk:()=>Promise.resolve()},m=new l.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/generate/page",pathname:"/generate",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},95766:(e,s,a)=>{Promise.resolve().then(a.bind(a,52108))},52108:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>m});var l=a(10326),r=a(77109),t=a(17577),n=a(35047),i=a(90434),c=a(91664),d=a(29752),x=a(38443),o=a(60660),h=a(41190);function m(){let{data:e,status:s,update:a}=(0,r.useSession)();(0,n.useRouter)();let[m,u]=(0,t.useState)(null),[p,g]=(0,t.useState)(""),[j,b]=(0,t.useState)([]),[f,N]=(0,t.useState)(!1),[v,y]=(0,t.useState)(0),[w,C]=(0,t.useState)(""),[P,z]=(0,t.useState)([]),[D,S]=(0,t.useState)(!1),_=(e=>{switch(e){case"pro":return{maxClothing:10,canBatch:!0,singleCost:2,batchCost:20,title:"Pro用户"};case"plus":return{maxClothing:3,canBatch:!1,singleCost:2,batchCost:2,title:"Plus用户"};default:return{maxClothing:1,canBatch:!1,singleCost:2,batchCost:2,title:"免费用户"}}})(e?.user?.userLevel),k=e?.user?.credits||0,L=e=>new Promise((s,a)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=()=>s(l.result),l.onerror=e=>a(e)}),Z=e=>{b(s=>s.filter(s=>s.id!==e))},A=()=>0===j.length?0:_.canBatch&&j.length>1?_.batchCost:_.singleCost,O=()=>!(!m||0===j.length||k<A()),R=async()=>{if(O()&&m&&0!==j.length){N(!0),y(0),C("正在上传图片..."),S(!1),z([]);try{C("正在处理图片..."),y(20);let e=await L(m),s=await Promise.all(j.map(e=>L(e.file)));C("正在分析照片..."),y(40);let l={userImage:e,clothingImages:s,generationType:j.length>1&&_.canBatch?"batch":"single"};C("正在生成图片..."),y(60);let r=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),t=await r.json();if(y(100),C("生成完成"),t.success&&t.data)z(t.data.images),S(!0),await a(),setTimeout(()=>{N(!1),y(0),C("")},1500);else throw Error(t.message||"生成失败")}catch(e){console.error("生成失败:",e),C("生成失败，积分已退还"),await a(),setTimeout(()=>{N(!1),y(0),C(""),alert(e instanceof Error?e.message:"生成失败，请稍后重试")},2e3)}}};return"loading"===s?l.jsx("main",{className:"container mx-auto px-4 py-8",children:(0,l.jsxs)("div",{className:"animate-pulse space-y-6",children:[l.jsx("div",{className:"h-8 bg-gray-200 rounded w-48"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsx("div",{className:"h-96 bg-gray-200 rounded"}),l.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})]})}):e?.user?(0,l.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"AI虚拟试穿"}),l.jsx("p",{className:"text-gray-600",children:"上传您的照片和服装，AI为您生成逼真的试穿效果"})]}),l.jsx(d.Zb,{className:"mb-8 bg-blue-50",children:l.jsx(d.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[l.jsx(x.C,{variant:"pro"===e.user.userLevel?"default":"plus"===e.user.userLevel?"info":"secondary",children:_.title}),(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:["当前积分: ",l.jsx("span",{className:"font-semibold text-green-600",children:k})]}),(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:["最多 ",_.maxClothing," 件服装"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:["free"===e.user.userLevel&&l.jsx(i.default,{href:"/upgrade",children:l.jsx(c.z,{variant:"outline",size:"sm",children:"升级Plus"})}),("free"===e.user.userLevel||"plus"===e.user.userLevel)&&l.jsx(i.default,{href:"/purchase",children:l.jsx(c.z,{variant:"outline",size:"sm",children:"充值积分"})})]})]})})}),f&&l.jsx(d.Zb,{className:"mb-8 bg-green-50",children:l.jsx(d.aY,{className:"pt-6",children:(0,l.jsxs)("div",{className:"text-center space-y-4",children:[l.jsx("h3",{className:"font-medium text-green-800",children:w}),l.jsx(o.E,{value:v,className:"w-full h-3"}),l.jsx("p",{className:"text-sm text-green-600",children:"请耐心等待，生成时间约30-60秒"})]})})}),D&&P.length>0&&(0,l.jsxs)(d.Zb,{className:"mb-8 bg-blue-50",children:[(0,l.jsxs)(d.Ol,{children:[l.jsx(d.ll,{className:"text-blue-800",children:"\uD83C\uDF89 生成完成！"}),(0,l.jsxs)(d.SZ,{children:["成功生成 ",P.length," 张试穿图片"]})]}),(0,l.jsxs)(d.aY,{children:[l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:P.map((e,s)=>(0,l.jsxs)("div",{className:"relative",children:[l.jsx("img",{src:e,alt:`生成结果 ${s+1}`,className:"w-full h-64 object-cover rounded-lg border"}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 bg-white bg-opacity-90 px-2 py-1 rounded text-xs font-medium",children:[s+1,"/",P.length]})]},s))}),(0,l.jsxs)("div",{className:"space-y-3",children:[l.jsx("div",{className:"flex flex-wrap gap-2",children:P.map((e,s)=>l.jsx("a",{href:e,download:`ai-tryon-result-${s+1}.jpg`,target:"_blank",rel:"noopener noreferrer",className:"flex-1 min-w-0",children:(0,l.jsxs)(c.z,{variant:"outline",size:"sm",className:"w-full",children:["下载图片 ",s+1]})},s))}),l.jsx(c.z,{onClick:()=>S(!1),variant:"outline",className:"w-full",children:"生成更多图片"})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(d.Zb,{children:[(0,l.jsxs)(d.Ol,{children:[(0,l.jsxs)(d.ll,{className:"flex items-center space-x-2",children:[l.jsx("span",{children:"\uD83D\uDCF7"}),l.jsx("span",{children:"上传您的照片"})]}),l.jsx(d.SZ,{children:"建议上传正面清晰的全身照片，效果更佳"})]}),l.jsx(d.aY,{children:l.jsx("div",{className:"space-y-4",children:p?(0,l.jsxs)("div",{className:"relative",children:[l.jsx("img",{src:p,alt:"用户照片预览",className:"w-full h-64 object-cover rounded-lg"}),l.jsx(c.z,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{u(null),g("")},children:"删除"})]}):(0,l.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors",children:[l.jsx("div",{className:"text-4xl mb-4",children:"\uD83D\uDCF7"}),l.jsx("p",{className:"text-gray-600 mb-4",children:"点击或拖拽上传您的照片"}),l.jsx(h.I,{type:"file",accept:"image/*",onChange:e=>{let s=e.target.files?.[0];if(s){u(s);let e=new FileReader;e.onload=e=>{g(e.target?.result)},e.readAsDataURL(s)}},className:"hidden",id:"userPhoto",disabled:f}),l.jsx(c.z,{variant:"outline",asChild:!0,disabled:f,children:l.jsx("label",{htmlFor:"userPhoto",className:"cursor-pointer",children:"选择照片"})})]})})})]}),(0,l.jsxs)(d.Zb,{children:[(0,l.jsxs)(d.Ol,{children:[(0,l.jsxs)(d.ll,{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[l.jsx("span",{children:"\uD83D\uDC57"}),l.jsx("span",{children:"上传服装"})]}),(0,l.jsxs)(x.C,{variant:"outline",className:"text-xs",children:[j.length,"/",_.maxClothing]})]}),(0,l.jsxs)(d.SZ,{children:[_.title,"最多可上传 ",_.maxClothing," 件服装",_.canBatch&&j.length>1&&l.jsx("span",{className:"text-green-600 ml-2",children:"（将进行批量生成）"})]})]}),l.jsx(d.aY,{children:(0,l.jsxs)("div",{className:"space-y-4",children:[j.length>0&&l.jsx("div",{className:"grid grid-cols-2 gap-4 mb-4",children:j.map(e=>(0,l.jsxs)("div",{className:"relative",children:[l.jsx("img",{src:e.preview,alt:"服装预览",className:"w-full h-32 object-cover rounded-lg"}),l.jsx(c.z,{variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>Z(e.id),disabled:f,children:"\xd7"})]},e.id))}),j.length<_.maxClothing&&(0,l.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[l.jsx("div",{className:"text-3xl mb-2",children:"\uD83D\uDC57"}),l.jsx("p",{className:"text-gray-600 mb-3",children:"添加服装图片"}),l.jsx(h.I,{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let s=e.target.files;s&&Array.from(s).forEach(e=>{if(j.length>=_.maxClothing){alert(`${_.title}最多可上传 ${_.maxClothing} 件服装`);return}let s=Math.random().toString(36).substr(2,9),a=new FileReader;a.onload=a=>{let l={id:s,file:e,preview:a.target?.result};b(e=>[...e,l])},a.readAsDataURL(e)})},className:"hidden",id:"clothingUpload",disabled:f}),l.jsx(c.z,{variant:"outline",asChild:!0,disabled:f,children:l.jsx("label",{htmlFor:"clothingUpload",className:"cursor-pointer",children:"选择服装"})})]}),j.length>=_.maxClothing&&(0,l.jsxs)("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[(0,l.jsxs)("p",{className:"text-yellow-800 text-sm",children:["已达到 ",_.title," 的服装上传上限"]}),"pro"!==e.user.userLevel&&l.jsx(i.default,{href:"/purchase",children:l.jsx(c.z,{variant:"outline",size:"sm",className:"mt-2",children:"升级到Pro解锁更多"})})]})]})})]})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(d.Zb,{children:[(0,l.jsxs)(d.Ol,{children:[l.jsx(d.ll,{children:"生成预览"}),l.jsx(d.SZ,{children:"确认信息无误后开始生成"})]}),(0,l.jsxs)(d.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[l.jsx("span",{children:"用户照片:"}),l.jsx("span",{className:m?"text-green-600":"text-gray-400",children:m?"✓ 已上传":"未上传"})]}),(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[l.jsx("span",{children:"服装数量:"}),(0,l.jsxs)("span",{className:j.length>0?"text-green-600":"text-gray-400",children:[j.length," 件"]})]}),(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[l.jsx("span",{children:"生成模式:"}),l.jsx("span",{className:"font-medium",children:_.canBatch&&j.length>1?"批量生成":"单次生成"})]}),(0,l.jsxs)("div",{className:"flex justify-between font-semibold border-t pt-2",children:[l.jsx("span",{children:"消耗积分:"}),l.jsx("span",{className:"text-green-600",children:A()})]}),(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[l.jsx("span",{children:"剩余积分:"}),l.jsx("span",{className:k>=A()?"text-green-600":"text-red-600",children:k-A()})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[!O()&&(0,l.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[!m&&l.jsx("p",{children:"• 请上传您的照片"}),0===j.length&&l.jsx("p",{children:"• 请至少上传一件服装"}),k<A()&&(0,l.jsxs)("p",{className:"text-red-600",children:["• 积分不足，需要 ",A()," 积分"]})]}),l.jsx(c.z,{className:"w-full h-12 text-lg",onClick:R,disabled:!O()||f,children:f?l.jsx("span",{children:w}):(0,l.jsxs)("span",{children:["开始生成 (",A()," 积分)"]})}),k<A()&&l.jsx(i.default,{href:"/purchase",children:l.jsx(c.z,{variant:"outline",className:"w-full",children:"充值积分"})})]})]})]}),(0,l.jsxs)(d.Zb,{className:"bg-blue-50",children:[l.jsx(d.Ol,{children:(0,l.jsxs)(d.ll,{className:"text-blue-800",children:[_.title,"特权"]})}),(0,l.jsxs)(d.aY,{className:"space-y-2 text-sm text-blue-700",children:[(0,l.jsxs)("p",{children:["• 单次生成消耗 ",_.singleCost," 积分"]}),_.canBatch?(0,l.jsxs)("p",{children:["• 批量生成消耗 ",_.batchCost," 积分（多件服装一次生成）"]}):(0,l.jsxs)("p",{children:["• 每件服装单独生成，消耗 ",_.singleCost," 积分"]}),(0,l.jsxs)("p",{children:["• 最多可上传 ",_.maxClothing," 件服装"]}),l.jsx("p",{children:"• 生成失败自动退还积分"}),"free"===e.user.userLevel&&(0,l.jsxs)("div",{className:"pt-2 border-t border-blue-200",children:[l.jsx("p",{className:"font-medium",children:"升级Plus解锁:"}),l.jsx("p",{children:"• 最多3件服装，每日签到"}),l.jsx(i.default,{href:"/upgrade",children:l.jsx(c.z,{variant:"outline",size:"sm",className:"mt-2",children:"免费升级Plus"})})]}),"pro"!==e.user.userLevel&&(0,l.jsxs)("div",{className:"pt-2 border-t border-blue-200",children:[l.jsx("p",{className:"font-medium",children:"升级Pro解锁:"}),l.jsx("p",{children:"• 最多10件服装，批量生成，专属客服"}),l.jsx(i.default,{href:"/purchase",children:l.jsx(c.z,{variant:"outline",size:"sm",className:"mt-2",children:"充值升级Pro"})})]})]})]})]})]}),(0,l.jsxs)(d.Zb,{className:"mt-8 bg-yellow-50",children:[l.jsx(d.Ol,{children:l.jsx(d.ll,{className:"text-yellow-800",children:"使用技巧"})}),(0,l.jsxs)(d.aY,{className:"text-sm text-yellow-700 space-y-2",children:[l.jsx("p",{children:"• 上传正面、清晰、光线充足的全身照效果最佳"}),l.jsx("p",{children:"• 服装图片建议使用平铺或模特展示图"}),l.jsx("p",{children:"• 避免复杂背景，纯色背景效果更好"}),l.jsx("p",{children:"• 每次生成大约需要30-60秒，请耐心等待"}),l.jsx("p",{children:"• 如果生成失败，积分会自动退还"})]})]})]}):null}},41190:(e,s,a)=>{"use strict";a.d(s,{I:()=>n});var l=a(10326),r=a(17577),t=a(51223);let n=r.forwardRef(({className:e,type:s,...a},r)=>l.jsx("input",{type:s,className:(0,t.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));n.displayName="Input"},14807:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>l});let l=(0,a(68570).createProxy)(String.raw`/Users/bytedance/Desktop/nababa-dress/src/app/generate/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),l=s.X(0,[276,850,771],()=>a(29735));module.exports=l})();