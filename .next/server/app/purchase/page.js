(()=>{var e={};e.id=214,e.ids=[214],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23310:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>c}),r(29934),r(44500),r(35866);var t=r(23191),a=r(88716),n=r(37922),i=r.n(n),l=r(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(s,d);let c=["",{children:["purchase",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,29934)),"/Users/bytedance/Desktop/nababa-dress/src/app/purchase/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,44500)),"/Users/bytedance/Desktop/nababa-dress/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/bytedance/Desktop/nababa-dress/src/app/purchase/page.tsx"],x="/purchase/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/purchase/page",pathname:"/purchase",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},96392:(e,s,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},66806:(e,s,r)=>{Promise.resolve().then(r.bind(r,20248)),Promise.resolve().then(r.bind(r,88826))},9236:(e,s,r)=>{Promise.resolve().then(r.bind(r,66396))},66396:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>o});var t=r(10326),a=r(77109),n=r(17577),i=r(35047),l=r(91664),d=r(29752),c=r(38443);function o(){let{data:e,status:s}=(0,a.useSession)();(0,i.useRouter)();let[r,o]=(0,n.useState)([]),[x,u]=(0,n.useState)([]),[m,h]=(0,n.useState)(!0),[p,f]=(0,n.useState)(null),[g,j]=(0,n.useState)(!1),b=async()=>{try{let e=await fetch("/api/user/history?type=purchase&limit=10"),s=await e.json();s.success&&u(s.data||[])}catch(e){console.error("获取购买历史失败:",e)}},v=e=>{f(e),j(!0)},y=async()=>{if(p)try{let e=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({packageName:p.name,adminNote:"前端购买请求 - 待管理员处理"})}),s=await e.json();s.success?(alert(`购买请求已提交！
包名: ${p.name}
积分: ${s.data.creditsAdded}
状态: 待处理

请联系管理员完成支付确认。`),j(!1),f(null),b()):alert("提交失败: "+s.message)}catch(e){console.error("提交购买请求失败:",e),alert("提交失败，请稍后重试")}},N=e=>{switch(e){case"completed":return t.jsx(c.C,{variant:"success",children:"已完成"});case"pending":return t.jsx(c.C,{variant:"warning",children:"处理中"});case"failed":return t.jsx(c.C,{variant:"destructive",children:"失败"});default:return t.jsx(c.C,{variant:"secondary",children:e})}},w=e=>30===e?"\uD83D\uDD25 热门选择":98===e?"⭐ 最超值":6===e?"\uD83D\uDC8E 新手首选":null;return"loading"===s||m?t.jsx("main",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-48"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4].map(e=>t.jsx("div",{className:"h-48 bg-gray-200 rounded"},e))})]})}):e?.user?(0,t.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8 text-center",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"积分充值"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"选择积分包，享受AI虚拟试穿服务"}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["当前积分: ",t.jsx("span",{className:"font-semibold text-green-600",children:e.user.credits})]}),t.jsx("span",{children:"\xb7"}),(0,t.jsxs)("span",{children:["会员等级: ",t.jsx(c.C,{variant:"pro"===e.user.userLevel?"default":"plus"===e.user.userLevel?"info":"secondary",children:"pro"===e.user.userLevel?"Pro":"plus"===e.user.userLevel?"Plus":"Free"})]})]})]}),g?(0,t.jsxs)(d.Zb,{className:"max-w-md mx-auto",children:[(0,t.jsxs)(d.Ol,{className:"text-center",children:[t.jsx(d.ll,{children:"确认购买"}),(0,t.jsxs)(d.SZ,{children:["您选择了 ",p?.name]})]}),(0,t.jsxs)(d.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{children:"套餐名称:"}),t.jsx("span",{className:"font-medium",children:p?.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{children:"支付金额:"}),(0,t.jsxs)("span",{className:"font-bold text-green-600",children:["\xa5",p?.price]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{children:"获得积分:"}),t.jsx("span",{className:"font-medium",children:p?.totalCredits})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{children:"升级等级:"}),t.jsx(c.C,{variant:"default",children:"Pro用户"})]})]}),(0,t.jsxs)("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"当前采用离线支付方式"}),(0,t.jsxs)("div",{className:"bg-yellow-50 p-3 rounded text-xs text-yellow-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"支付流程:"}),t.jsx("p",{children:"1. 点击“确认购买”提交订单"}),t.jsx("p",{children:"2. 使用微信/支付宝转账给管理员"}),t.jsx("p",{children:"3. 联系管理员确认到账"}),t.jsx("p",{children:"4. 管理员处理后积分自动到账"})]})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[t.jsx(l.z,{variant:"outline",onClick:()=>j(!1),className:"flex-1",children:"返回选择"}),t.jsx(l.z,{onClick:y,className:"flex-1",children:"确认购买"})]})]})]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12",children:r.map((e,s)=>{let r=w(e.price),a=e.bonusCredits>0?Math.round(e.bonusCredits/e.baseCredits*100):0;return(0,t.jsxs)(d.Zb,{className:`relative cursor-pointer transition-all hover:shadow-lg ${98===e.price?"border-2 border-blue-500":"hover:border-gray-300"}`,onClick:()=>v(e),children:[r&&t.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:t.jsx(c.C,{variant:"default",className:"text-xs px-2 py-1",children:r})}),(0,t.jsxs)(d.Ol,{className:"text-center pb-2",children:[t.jsx(d.ll,{className:"text-lg",children:e.name}),t.jsx(d.SZ,{children:e.description})]}),(0,t.jsxs)(d.aY,{className:"text-center space-y-4",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:["\xa5",e.price]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"基础积分:"}),t.jsx("span",{children:e.baseCredits})]}),e.bonusCredits>0&&(0,t.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[t.jsx("span",{children:"赠送积分:"}),(0,t.jsxs)("span",{children:["+",e.bonusCredits]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-semibold border-t pt-2",children:[t.jsx("span",{children:"总积分:"}),t.jsx("span",{className:"text-green-600",children:e.totalCredits})]})]}),a>0&&(0,t.jsxs)(c.C,{variant:"success",className:"text-xs",children:["额外赠送 ",a,"%"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["约可生成 ",Math.floor(e.totalCredits/2)," 次单张"]}),t.jsx(l.z,{className:"w-full",children:"选择此套餐"})]})]},s)})}),(0,t.jsxs)(d.Zb,{className:"mb-8 bg-blue-50",children:[t.jsx(d.Ol,{children:t.jsx(d.ll,{className:"text-blue-800",children:"充值说明"})}),(0,t.jsxs)(d.aY,{className:"space-y-2 text-sm text-blue-700",children:[(0,t.jsxs)("p",{children:["• 充值任意积分包自动升级为 ",t.jsx(c.C,{variant:"default",className:"mx-1",children:"Pro"})," 用户"]}),t.jsx("p",{children:"• Pro用户享受每日签到、批量生成、最多10件服装等特权"}),t.jsx("p",{children:"• 当前采用离线支付方式，支付后请联系管理员确认到账"}),t.jsx("p",{children:"• 积分永不过期，可随时用于AI试穿生成"}),t.jsx("p",{children:"• 每次单张生成消耗2积分，批量生成消耗20积分"})]})]}),x.length>0&&(0,t.jsxs)(d.Zb,{children:[(0,t.jsxs)(d.Ol,{children:[t.jsx(d.ll,{children:"购买历史"}),t.jsx(d.SZ,{children:"您最近的积分充值记录"})]}),t.jsx(d.aY,{children:t.jsx("div",{className:"space-y-3",children:x.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[(0,t.jsxs)("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:e.package_name}),t.jsx("div",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleString("zh-CN")}),e.admin_note&&(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["备注: ",e.admin_note]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold",children:["+",e.credits_added," 积分"]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["\xa5",e.amount_paid]})]}),N(e.status)]})]},e.id))})})]})]}),t.jsx(d.Zb,{className:"mt-8 text-center bg-gray-50",children:(0,t.jsxs)(d.aY,{className:"pt-6",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"如有问题请联系客服"}),t.jsx("p",{className:"text-xs text-gray-500",children:"客服微信: xiaomaogengyi (工作时间: 9:00-18:00)"})]})})]}):null}},20248:(e,s,r)=>{"use strict";r.d(s,{Header:()=>c});var t=r(10326),a=r(77109),n=r(90434),i=r(35047),l=r(91664),d=r(38443);function c(){let{data:e,status:s}=(0,a.useSession)(),r=(0,i.useRouter)(),c=async()=>{await (0,a.signOut)({redirect:!1}),r.push("/")};return(0,t.jsxs)("header",{className:"border-b bg-white",children:[(0,t.jsxs)("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[t.jsx(n.default,{href:"/",className:"text-xl font-bold text-gray-900",children:"小猫更衣"}),"loading"===s?t.jsx("div",{className:"h-8 w-32 bg-gray-200 animate-pulse rounded"}):e?.user?(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("nav",{className:"hidden md:flex items-center space-x-4",children:[t.jsx(n.default,{href:"/dashboard",className:"text-gray-600 hover:text-gray-900",children:"控制台"}),t.jsx(n.default,{href:"/generate",className:"text-gray-600 hover:text-gray-900",children:"AI试穿"}),t.jsx(n.default,{href:"/purchase",className:"text-gray-600 hover:text-gray-900",children:"积分充值"}),t.jsx(n.default,{href:"/profile",className:"text-gray-600 hover:text-gray-900",children:"个人中心"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1 text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"积分:"}),t.jsx("span",{className:"font-semibold text-green-600",children:e.user.credits||0})]}),t.jsx(d.C,{variant:(e=>{switch(e){case"pro":return"default";case"plus":return"info";default:return"secondary"}})(e.user.userLevel),children:(e=>{switch(e){case"pro":return"Pro";case"plus":return"Plus";default:return"Free"}})(e.user.userLevel)}),t.jsx("span",{className:"text-sm text-gray-600 hidden lg:inline",children:e.user.email}),t.jsx(l.z,{variant:"outline",size:"sm",onClick:c,children:"退出"})]})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx(n.default,{href:"/auth/signin",children:t.jsx(l.z,{variant:"outline",size:"sm",children:"登录"})}),t.jsx(n.default,{href:"/auth/signup",children:t.jsx(l.z,{size:"sm",children:"注册"})})]})]}),e?.user&&t.jsx("div",{className:"md:hidden border-t bg-gray-50 px-4 py-2",children:(0,t.jsxs)("nav",{className:"flex justify-around",children:[t.jsx(n.default,{href:"/dashboard",className:"text-gray-600 hover:text-gray-900 text-sm",children:"控制台"}),t.jsx(n.default,{href:"/generate",className:"text-gray-600 hover:text-gray-900 text-sm",children:"AI试穿"}),t.jsx(n.default,{href:"/purchase",className:"text-gray-600 hover:text-gray-900 text-sm",children:"充值"}),t.jsx(n.default,{href:"/profile",className:"text-gray-600 hover:text-gray-900 text-sm",children:"个人"})]})})]})}},88826:(e,s,r)=>{"use strict";r.d(s,{AuthProvider:()=>n});var t=r(10326),a=r(77109);function n({children:e}){return t.jsx(a.SessionProvider,{children:e})}},38443:(e,s,r)=>{"use strict";r.d(s,{C:()=>l});var t=r(10326);r(17577);var a=r(79360),n=r(51223);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 hover:bg-green-200",warning:"border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:"border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...r}){return t.jsx("div",{className:(0,n.cn)(i({variant:s}),e),...r})}},91664:(e,s,r)=>{"use strict";r.d(s,{z:()=>c});var t=r(10326),a=r(17577),n=r(86438),i=r(79360),l=r(51223);let d=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef(({className:e,variant:s,size:r,asChild:a=!1,...i},c)=>{let o=a?n.g7:"button";return t.jsx(o,{className:(0,l.cn)(d({variant:s,size:r,className:e})),ref:c,...i})});c.displayName="Button"},29752:(e,s,r)=>{"use strict";r.d(s,{Ol:()=>l,SZ:()=>c,Zb:()=>i,aY:()=>o,ll:()=>d});var t=r(10326),a=r(17577),n=r(51223);let i=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));i.displayName="Card";let l=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...s}));l.displayName="CardHeader";let d=a.forwardRef(({className:e,...s},r)=>t.jsx("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));d.displayName="CardTitle";let c=a.forwardRef(({className:e,...s},r)=>t.jsx("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...s}));c.displayName="CardDescription";let o=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...s}));o.displayName="CardContent",a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter"},51223:(e,s,r)=>{"use strict";r.d(s,{cn:()=>n});var t=r(41135),a=r(31009);function n(...e){return(0,a.m6)((0,t.W)(e))}},44500:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>o,metadata:()=>c});var t=r(19510),a=r(45317),n=r.n(a);r(5023);var i=r(68570);let l=(0,i.createProxy)(String.raw`/Users/bytedance/Desktop/nababa-dress/src/components/providers/session-provider.tsx#AuthProvider`),d=(0,i.createProxy)(String.raw`/Users/bytedance/Desktop/nababa-dress/src/components/header.tsx#Header`),c={title:"小猫更衣 - AI虚拟试穿",description:"利用AI技术实现一键虚拟试穿，让每件服装都能展现最真实的穿着效果"};function o({children:e}){return t.jsx("html",{lang:"zh-CN",children:t.jsx("body",{className:n().className,children:(0,t.jsxs)(l,{children:[t.jsx(d,{}),e]})})})}},29934:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(68570).createProxy)(String.raw`/Users/bytedance/Desktop/nababa-dress/src/app/purchase/page.tsx#default`)},5023:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,850],()=>r(23310));module.exports=t})();