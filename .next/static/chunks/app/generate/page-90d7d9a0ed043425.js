(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{2559:function(e,s,r){Promise.resolve().then(r.bind(r,8326))},8326:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return m}});var t=r(7437),l=r(998),a=r(2265),n=r(6463),i=r(7138),c=r(6648),d=r(9733),o=r(8185),u=r(9055),x=r(1617),h=r(7209);function m(){var e,s;let{data:r,status:m,update:f}=(0,l.useSession)(),g=(0,n.useRouter)(),[p,j]=(0,a.useState)(null),[b,v]=(0,a.useState)(""),[N,y]=(0,a.useState)([]),[w,C]=(0,a.useState)(!1),[z,D]=(0,a.useState)(0),[S,R]=(0,a.useState)(""),[k,P]=(0,a.useState)([]),[Z,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if("unauthenticated"===m){g.push("/auth/signin");return}},[m,g]);let O=(e=>{switch(e){case"pro":return{maxClothing:10,canBatch:!0,singleCost:2,batchCost:20,title:"Pro用户"};case"plus":return{maxClothing:3,canBatch:!1,singleCost:2,batchCost:2,title:"Plus用户"};default:return{maxClothing:1,canBatch:!1,singleCost:2,batchCost:2,title:"免费用户"}}})(null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.userLevel),B=(null==r?void 0:null===(s=r.user)||void 0===s?void 0:s.credits)||0,E=e=>new Promise((s,r)=>{let t=new FileReader;t.readAsDataURL(e),t.onload=()=>s(t.result),t.onerror=e=>r(e)}),F=e=>{y(s=>s.filter(s=>s.id!==e))},Y=()=>0===N.length?0:O.canBatch&&N.length>1?O.batchCost:O.singleCost,I=()=>!(!p||0===N.length||B<Y()),A=async()=>{if(I()&&p&&0!==N.length){C(!0),D(0),R("正在上传图片..."),L(!1),P([]);try{R("正在处理图片..."),D(20);let e=await E(p),s=await Promise.all(N.map(e=>E(e.file)));R("正在分析照片..."),D(40);let r={userImage:e,clothingImages:s,generationType:N.length>1&&O.canBatch?"batch":"single"};R("正在生成图片..."),D(60);let t=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),l=await t.json();if(D(100),R("生成完成"),l.success&&l.data)P(l.data.images),L(!0),await f(),setTimeout(()=>{C(!1),D(0),R("")},1500);else throw Error(l.message||"生成失败")}catch(e){console.error("生成失败:",e),R("生成失败，积分已退还"),await f(),setTimeout(()=>{C(!1),D(0),R(""),alert(e instanceof Error?e.message:"生成失败，请稍后重试")},2e3)}}};return"loading"===m?(0,t.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsx)("div",{className:"h-96 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-96 bg-gray-200 rounded"})]})]})}):(null==r?void 0:r.user)?(0,t.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"AI虚拟试穿"}),(0,t.jsx)("p",{className:"text-gray-600",children:"上传您的照片和服装，AI为您生成逼真的试穿效果"})]}),(0,t.jsx)(o.Zb,{className:"mb-8 bg-blue-50",children:(0,t.jsx)(o.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(u.C,{variant:"pro"===r.user.userLevel?"default":"plus"===r.user.userLevel?"info":"secondary",children:O.title}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["当前积分: ",(0,t.jsx)("span",{className:"font-semibold text-green-600",children:B})]}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["最多 ",O.maxClothing," 件服装"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:["free"===r.user.userLevel&&(0,t.jsx)(i.default,{href:"/upgrade",children:(0,t.jsx)(d.z,{variant:"outline",size:"sm",children:"升级Plus"})}),("free"===r.user.userLevel||"plus"===r.user.userLevel)&&(0,t.jsx)(i.default,{href:"/purchase",children:(0,t.jsx)(d.z,{variant:"outline",size:"sm",children:"充值积分"})})]})]})})}),w&&(0,t.jsx)(o.Zb,{className:"mb-8 bg-green-50",children:(0,t.jsx)(o.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)("h3",{className:"font-medium text-green-800",children:S}),(0,t.jsx)(x.E,{value:z,className:"w-full h-3"}),(0,t.jsx)("p",{className:"text-sm text-green-600",children:"请耐心等待，生成时间约30-60秒"})]})})}),Z&&k.length>0&&(0,t.jsxs)(o.Zb,{className:"mb-8 bg-blue-50",children:[(0,t.jsxs)(o.Ol,{children:[(0,t.jsx)(o.ll,{className:"text-blue-800",children:"\uD83C\uDF89 生成完成！"}),(0,t.jsxs)(o.SZ,{children:["成功生成 ",k.length," 张试穿图片"]})]}),(0,t.jsxs)(o.aY,{children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:k.map((e,s)=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.default,{src:e,alt:"生成结果 ".concat(s+1),width:400,height:256,className:"w-full h-64 object-cover rounded-lg border",unoptimized:e.startsWith("data:")}),(0,t.jsxs)("div",{className:"absolute top-2 right-2 bg-white bg-opacity-90 px-2 py-1 rounded text-xs font-medium",children:[s+1,"/",k.length]})]},s))}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map((e,s)=>(0,t.jsx)("a",{href:e,download:"ai-tryon-result-".concat(s+1,".jpg"),target:"_blank",rel:"noopener noreferrer",className:"flex-1 min-w-0",children:(0,t.jsxs)(d.z,{variant:"outline",size:"sm",className:"w-full",children:["下载图片 ",s+1]})},s))}),(0,t.jsx)(d.z,{onClick:()=>L(!1),variant:"outline",className:"w-full",children:"生成更多图片"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{children:[(0,t.jsxs)(o.ll,{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{children:"\uD83D\uDCF7"}),(0,t.jsx)("span",{children:"上传您的照片"})]}),(0,t.jsx)(o.SZ,{children:"建议上传正面清晰的全身照片，效果更佳"})]}),(0,t.jsx)(o.aY,{children:(0,t.jsx)("div",{className:"space-y-4",children:b?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.default,{src:b,alt:"用户照片预览",width:400,height:256,className:"w-full h-64 object-cover rounded-lg",unoptimized:!0}),(0,t.jsx)(d.z,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{j(null),v("")},children:"删除"})]}):(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCF7"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"点击或拖拽上传您的照片"}),(0,t.jsx)(h.I,{type:"file",accept:"image/*",onChange:e=>{var s;let r=null===(s=e.target.files)||void 0===s?void 0:s[0];if(r){j(r);let e=new FileReader;e.onload=e=>{var s;v(null===(s=e.target)||void 0===s?void 0:s.result)},e.readAsDataURL(r)}},className:"hidden",id:"userPhoto",disabled:w}),(0,t.jsx)(d.z,{variant:"outline",asChild:!0,disabled:w,children:(0,t.jsx)("label",{htmlFor:"userPhoto",className:"cursor-pointer",children:"选择照片"})})]})})})]}),(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{children:[(0,t.jsxs)(o.ll,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{children:"\uD83D\uDC57"}),(0,t.jsx)("span",{children:"上传服装"})]}),(0,t.jsxs)(u.C,{variant:"outline",className:"text-xs",children:[N.length,"/",O.maxClothing]})]}),(0,t.jsxs)(o.SZ,{children:[O.title,"最多可上传 ",O.maxClothing," 件服装",O.canBatch&&N.length>1&&(0,t.jsx)("span",{className:"text-green-600 ml-2",children:"（将进行批量生成）"})]})]}),(0,t.jsx)(o.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[N.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:N.map(e=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.default,{src:e.preview,alt:"服装预览",width:200,height:128,className:"w-full h-32 object-cover rounded-lg",unoptimized:!0}),(0,t.jsx)(d.z,{variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>F(e.id),disabled:w,children:"\xd7"})]},e.id))}),N.length<O.maxClothing&&(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[(0,t.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDC57"}),(0,t.jsx)("p",{className:"text-gray-600 mb-3",children:"添加服装图片"}),(0,t.jsx)(h.I,{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let s=e.target.files;s&&Array.from(s).forEach(e=>{if(N.length>=O.maxClothing){alert("".concat(O.title,"最多可上传 ").concat(O.maxClothing," 件服装"));return}let s=Math.random().toString(36).substr(2,9),r=new FileReader;r.onload=r=>{var t;let l={id:s,file:e,preview:null===(t=r.target)||void 0===t?void 0:t.result};y(e=>[...e,l])},r.readAsDataURL(e)})},className:"hidden",id:"clothingUpload",disabled:w}),(0,t.jsx)(d.z,{variant:"outline",asChild:!0,disabled:w,children:(0,t.jsx)("label",{htmlFor:"clothingUpload",className:"cursor-pointer",children:"选择服装"})})]}),N.length>=O.maxClothing&&(0,t.jsxs)("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[(0,t.jsxs)("p",{className:"text-yellow-800 text-sm",children:["已达到 ",O.title," 的服装上传上限"]}),"pro"!==r.user.userLevel&&(0,t.jsx)(i.default,{href:"/purchase",children:(0,t.jsx)(d.z,{variant:"outline",size:"sm",className:"mt-2",children:"升级到Pro解锁更多"})})]})]})})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{children:[(0,t.jsx)(o.ll,{children:"生成预览"}),(0,t.jsx)(o.SZ,{children:"确认信息无误后开始生成"})]}),(0,t.jsxs)(o.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"用户照片:"}),(0,t.jsx)("span",{className:p?"text-green-600":"text-gray-400",children:p?"✓ 已上传":"未上传"})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"服装数量:"}),(0,t.jsxs)("span",{className:N.length>0?"text-green-600":"text-gray-400",children:[N.length," 件"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"生成模式:"}),(0,t.jsx)("span",{className:"font-medium",children:O.canBatch&&N.length>1?"批量生成":"单次生成"})]}),(0,t.jsxs)("div",{className:"flex justify-between font-semibold border-t pt-2",children:[(0,t.jsx)("span",{children:"消耗积分:"}),(0,t.jsx)("span",{className:"text-green-600",children:Y()})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"剩余积分:"}),(0,t.jsx)("span",{className:B>=Y()?"text-green-600":"text-red-600",children:B-Y()})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[!I()&&(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[!p&&(0,t.jsx)("p",{children:"• 请上传您的照片"}),0===N.length&&(0,t.jsx)("p",{children:"• 请至少上传一件服装"}),B<Y()&&(0,t.jsxs)("p",{className:"text-red-600",children:["• 积分不足，需要 ",Y()," 积分"]})]}),(0,t.jsx)(d.z,{className:"w-full h-12 text-lg",onClick:A,disabled:!I()||w,children:w?(0,t.jsx)("span",{children:S}):(0,t.jsxs)("span",{children:["开始生成 (",Y()," 积分)"]})}),B<Y()&&(0,t.jsx)(i.default,{href:"/purchase",children:(0,t.jsx)(d.z,{variant:"outline",className:"w-full",children:"充值积分"})})]})]})]}),(0,t.jsxs)(o.Zb,{className:"bg-blue-50",children:[(0,t.jsx)(o.Ol,{children:(0,t.jsxs)(o.ll,{className:"text-blue-800",children:[O.title,"特权"]})}),(0,t.jsxs)(o.aY,{className:"space-y-2 text-sm text-blue-700",children:[(0,t.jsxs)("p",{children:["• 单次生成消耗 ",O.singleCost," 积分"]}),O.canBatch?(0,t.jsxs)("p",{children:["• 批量生成消耗 ",O.batchCost," 积分（多件服装一次生成）"]}):(0,t.jsxs)("p",{children:["• 每件服装单独生成，消耗 ",O.singleCost," 积分"]}),(0,t.jsxs)("p",{children:["• 最多可上传 ",O.maxClothing," 件服装"]}),(0,t.jsx)("p",{children:"• 生成失败自动退还积分"}),"free"===r.user.userLevel&&(0,t.jsxs)("div",{className:"pt-2 border-t border-blue-200",children:[(0,t.jsx)("p",{className:"font-medium",children:"升级Plus解锁:"}),(0,t.jsx)("p",{children:"• 最多3件服装，每日签到"}),(0,t.jsx)(i.default,{href:"/upgrade",children:(0,t.jsx)(d.z,{variant:"outline",size:"sm",className:"mt-2",children:"免费升级Plus"})})]}),"pro"!==r.user.userLevel&&(0,t.jsxs)("div",{className:"pt-2 border-t border-blue-200",children:[(0,t.jsx)("p",{className:"font-medium",children:"升级Pro解锁:"}),(0,t.jsx)("p",{children:"• 最多10件服装，批量生成，专属客服"}),(0,t.jsx)(i.default,{href:"/purchase",children:(0,t.jsx)(d.z,{variant:"outline",size:"sm",className:"mt-2",children:"充值升级Pro"})})]})]})]})]})]}),(0,t.jsxs)(o.Zb,{className:"mt-8 bg-yellow-50",children:[(0,t.jsx)(o.Ol,{children:(0,t.jsx)(o.ll,{className:"text-yellow-800",children:"使用技巧"})}),(0,t.jsxs)(o.aY,{className:"text-sm text-yellow-700 space-y-2",children:[(0,t.jsx)("p",{children:"• 上传正面、清晰、光线充足的全身照效果最佳"}),(0,t.jsx)("p",{children:"• 服装图片建议使用平铺或模特展示图"}),(0,t.jsx)("p",{children:"• 避免复杂背景，纯色背景效果更好"}),(0,t.jsx)("p",{children:"• 每次生成大约需要30-60秒，请耐心等待"}),(0,t.jsx)("p",{children:"• 如果生成失败，积分会自动退还"})]})]})]}):null}},9055:function(e,s,r){"use strict";r.d(s,{C:function(){return i}});var t=r(7437);r(2265);var l=r(3027),a=r(9354);let n=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 hover:bg-green-200",warning:"border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:"border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:r,...l}=e;return(0,t.jsx)("div",{className:(0,a.cn)(n({variant:r}),s),...l})}},9733:function(e,s,r){"use strict";r.d(s,{z:function(){return d}});var t=r(7437),l=r(2265),a=r(2974),n=r(3027),i=r(9354);let c=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=l.forwardRef((e,s)=>{let{className:r,variant:l,size:n,asChild:d=!1,...o}=e,u=d?a.g7:"button";return(0,t.jsx)(u,{className:(0,i.cn)(c({variant:l,size:n,className:r})),ref:s,...o})});d.displayName="Button"},8185:function(e,s,r){"use strict";r.d(s,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return n},aY:function(){return o},ll:function(){return c}});var t=r(7437),l=r(2265),a=r(9354);let n=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...l})});n.displayName="Card";let i=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...l})});i.displayName="CardHeader";let c=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("h3",{ref:s,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...l})});c.displayName="CardTitle";let d=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("p",{ref:s,className:(0,a.cn)("text-sm text-muted-foreground",r),...l})});d.displayName="CardDescription";let o=l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,a.cn)("p-6 pt-0",r),...l})});o.displayName="CardContent",l.forwardRef((e,s)=>{let{className:r,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,a.cn)("flex items-center p-6 pt-0",r),...l})}).displayName="CardFooter"},7209:function(e,s,r){"use strict";r.d(s,{I:function(){return n}});var t=r(7437),l=r(2265),a=r(9354);let n=l.forwardRef((e,s)=>{let{className:r,type:l,...n}=e;return(0,t.jsx)("input",{type:l,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...n})});n.displayName="Input"},1617:function(e,s,r){"use strict";r.d(s,{E:function(){return i}});var t=r(7437),l=r(2265),a=r(974),n=r(9354);let i=l.forwardRef((e,s)=>{let{className:r,value:l,...i}=e;return(0,t.jsx)(a.fC,{ref:s,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...i,children:(0,t.jsx)(a.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});i.displayName=a.fC.displayName},9354:function(e,s,r){"use strict";r.d(s,{cn:function(){return a}});var t=r(4839),l=r(6164);function a(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,l.m6)((0,t.W)(s))}}},function(e){e.O(0,[557,998,138,929,971,23,744],function(){return e(e.s=2559)}),_N_E=e.O()}]);