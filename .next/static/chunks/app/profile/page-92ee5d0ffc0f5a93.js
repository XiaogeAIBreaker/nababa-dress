(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{1474:function(e,s,r){Promise.resolve().then(r.bind(r,529))},6463:function(e,s,r){"use strict";var l=r(1169);r.o(l,"useRouter")&&r.d(s,{useRouter:function(){return l.useRouter}})},529:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return o}});var l=r(7437),a=r(998),t=r(2265),n=r(6463),i=r(7138),c=r(9733),d=r(8185),u=r(9055);function o(){let{data:e,status:s}=(0,a.useSession)(),r=(0,n.useRouter)(),[o,x]=(0,t.useState)("overview"),[h,m]=(0,t.useState)([]),[f,p]=(0,t.useState)(null),[j,g]=(0,t.useState)(!0);(0,t.useEffect)(()=>{if("unauthenticated"===s){r.push("/auth/signin");return}"authenticated"===s&&(v(),b("checkin"))},[s,r]);let v=async()=>{try{let e=await fetch("/api/user/stats"),s=await e.json();s.success&&p(s.data)}catch(e){console.error("获取用户统计失败:",e)}finally{g(!1)}},b=async e=>{try{let s=await fetch("/api/user/history?type=".concat(e,"&limit=20")),r=await s.json();r.success&&m(r.data||[])}catch(e){console.error("获取历史数据失败:",e),m([])}},N=e=>{x(e),"overview"!==e&&b(e)},y=e=>new Date(e).toLocaleString("zh-CN"),w=e=>{switch(e){case"completed":return(0,l.jsx)(u.C,{variant:"success",children:"已完成"});case"pending":return(0,l.jsx)(u.C,{variant:"warning",children:"处理中"});case"failed":return(0,l.jsx)(u.C,{variant:"destructive",children:"失败"});case"success":return(0,l.jsx)(u.C,{variant:"success",children:"成功"});default:return null}};if("loading"===s||j)return(0,l.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,l.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,l.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsx)("div",{className:"lg:col-span-1 h-64 bg-gray-200 rounded"}),(0,l.jsx)("div",{className:"lg:col-span-2 h-64 bg-gray-200 rounded"})]})]})});if(!(null==e?void 0:e.user))return null;let C=(e=>{switch(e){case"pro":return{title:"Pro用户",color:"text-purple-600",bgColor:"bg-purple-50"};case"plus":return{title:"Plus用户",color:"text-blue-600",bgColor:"bg-blue-50"};default:return{title:"免费用户",color:"text-gray-600",bgColor:"bg-gray-50"}}})(e.user.userLevel);return(0,l.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"个人中心"}),(0,l.jsx)("p",{className:"text-gray-600",children:"管理您的账户信息和使用历史"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,l.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,l.jsxs)(d.Zb,{className:C.bgColor,children:[(0,l.jsx)(d.Ol,{children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-gray-300 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl",children:"\uD83D\uDC64"}),(0,l.jsx)(d.ll,{className:"text-lg",children:e.user.email}),(0,l.jsx)(d.SZ,{children:(0,l.jsx)(u.C,{variant:"pro"===e.user.userLevel?"default":"plus"===e.user.userLevel?"info":"secondary",children:C.title})})]})}),(0,l.jsxs)(d.aY,{className:"text-center space-y-3",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"当前积分:"}),(0,l.jsx)("span",{className:"font-semibold text-green-600",children:e.user.credits})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"总生成数:"}),(0,l.jsx)("span",{className:"font-semibold",children:(null==f?void 0:f.total_generations)||0})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"成功生成:"}),(0,l.jsx)("span",{className:"font-semibold",children:(null==f?void 0:f.successful_generations)||0})]}),e.user.wechatUpgraded&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"微信验证:"}),(0,l.jsx)(u.C,{variant:"success",className:"h-5",children:"✓"})]})]}),(0,l.jsxs)("div",{className:"pt-3 border-t space-y-2",children:["free"===e.user.userLevel&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.default,{href:"/upgrade",children:(0,l.jsx)(c.z,{variant:"outline",size:"sm",className:"w-full",children:"升级Plus"})}),(0,l.jsx)(i.default,{href:"/purchase",children:(0,l.jsx)(c.z,{size:"sm",className:"w-full",children:"充值积分"})})]}),"plus"===e.user.userLevel&&(0,l.jsx)(i.default,{href:"/purchase",children:(0,l.jsx)(c.z,{size:"sm",className:"w-full",children:"充值升级Pro"})}),"pro"===e.user.userLevel&&(0,l.jsx)(i.default,{href:"/purchase",children:(0,l.jsx)(c.z,{variant:"outline",size:"sm",className:"w-full",children:"充值积分"})})]})]})]}),(0,l.jsxs)(d.Zb,{children:[(0,l.jsx)(d.Ol,{children:(0,l.jsx)(d.ll,{className:"text-base",children:"使用统计"})}),(0,l.jsxs)(d.aY,{className:"space-y-3 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"累计获得积分:"}),(0,l.jsx)("span",{className:"font-semibold text-green-600",children:((null==f?void 0:f.total_checkin_credits)||0)+((null==f?void 0:f.total_purchased_credits)||0)})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"累计消耗积分:"}),(0,l.jsx)("span",{className:"font-semibold text-red-600",children:(null==f?void 0:f.total_credits_used)||0})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"积分余额:"}),(0,l.jsx)("span",{className:"font-semibold",children:e.user.credits||0})]}),(0,l.jsxs)("div",{className:"pt-2 border-t text-xs text-gray-500",children:["签到次数: ",(null==f?void 0:f.total_checkins)||0," \xb7 充值次数: ",(null==f?void 0:f.total_purchases)||0]})]})]})]}),(0,l.jsxs)("div",{className:"lg:col-span-3",children:[(0,l.jsx)(d.Zb,{className:"mb-6",children:(0,l.jsx)(d.aY,{className:"pt-6",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:[{key:"overview",label:"概览",icon:"\uD83D\uDCCA"},{key:"checkin",label:"签到历史",icon:"✅"},{key:"purchase",label:"充值记录",icon:"\uD83D\uDCB3"},{key:"generation",label:"生成历史",icon:"\uD83C\uDFA8"}].map(e=>(0,l.jsxs)(c.z,{variant:o===e.key?"default":"outline",size:"sm",onClick:()=>N(e.key),children:[(0,l.jsx)("span",{className:"mr-1",children:e.icon}),e.label]},e.key))})})}),(0,l.jsxs)(d.Zb,{children:[(0,l.jsxs)(d.Ol,{children:[(0,l.jsxs)(d.ll,{children:["overview"===o&&"账户概览","checkin"===o&&"签到历史","purchase"===o&&"充值记录","generation"===o&&"生成历史"]}),(0,l.jsxs)(d.SZ,{children:["overview"===o&&"您的账户使用情况总览","checkin"===o&&"最近的签到记录","purchase"===o&&"积分充值和消费记录","generation"===o&&"AI试穿生成历史"]})]}),(0,l.jsxs)(d.aY,{children:["overview"===o&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,l.jsx)("h3",{className:"font-medium text-green-800 mb-2",children:"积分状况"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-green-600 mb-1",children:e.user.credits||0}),(0,l.jsxs)("p",{className:"text-sm text-green-600",children:["可生成约 ",Math.floor((e.user.credits||0)/2)," 次"]})]}),(0,l.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,l.jsx)("h3",{className:"font-medium text-blue-800 mb-2",children:"使用情况"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:(null==f?void 0:f.total_generations)||0}),(0,l.jsxs)("p",{className:"text-sm text-blue-600",children:["历史生成总数 (成功 ",(null==f?void 0:f.successful_generations)||0," 次)"]})]})]}),(0,l.jsxs)("div",{className:"p-4 rounded-lg ".concat(C.bgColor),children:[(0,l.jsxs)("h3",{className:"font-medium mb-3 ".concat(C.color),children:[C.title,"特权"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium mb-2",children:"当前特权:"}),(0,l.jsxs)("ul",{className:"space-y-1 text-gray-600",children:[(0,l.jsxs)("li",{children:["• 签到频率: ","free"===e.user.userLevel?"每周":"每日"]}),(0,l.jsxs)("li",{children:["• 服装数量: ","pro"===e.user.userLevel?"10件":"plus"===e.user.userLevel?"3件":"1件"]}),(0,l.jsxs)("li",{children:["• 生成模式: ","pro"===e.user.userLevel?"批量生成":"单次生成"]}),(0,l.jsxs)("li",{children:["• 客服支持: ","pro"===e.user.userLevel?"专属":"plus"===e.user.userLevel?"优先":"基础"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium mb-2",children:"升级建议:"}),"free"===e.user.userLevel&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"升级Plus享受每日签到"}),(0,l.jsx)(i.default,{href:"/upgrade",children:(0,l.jsx)(c.z,{size:"sm",variant:"outline",children:"免费升级Plus"})})]}),"pro"!==e.user.userLevel&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"充值积分自动升级Pro"}),(0,l.jsx)(i.default,{href:"/purchase",children:(0,l.jsx)(c.z,{size:"sm",children:"充值升级Pro"})})]}),"pro"===e.user.userLevel&&(0,l.jsx)("p",{className:"text-sm text-green-600",children:"您已享受最高等级特权！"})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsx)(i.default,{href:"/dashboard",children:(0,l.jsxs)(c.z,{variant:"outline",className:"w-full h-16 flex flex-col",children:[(0,l.jsx)("span",{className:"text-xl mb-1",children:"\uD83C\uDFE0"}),(0,l.jsx)("span",{className:"text-sm",children:"控制台"})]})}),(0,l.jsx)(i.default,{href:"/generate",children:(0,l.jsxs)(c.z,{variant:"outline",className:"w-full h-16 flex flex-col",children:[(0,l.jsx)("span",{className:"text-xl mb-1",children:"\uD83C\uDFA8"}),(0,l.jsx)("span",{className:"text-sm",children:"AI试穿"})]})}),(0,l.jsx)(i.default,{href:"/purchase",children:(0,l.jsxs)(c.z,{variant:"outline",className:"w-full h-16 flex flex-col",children:[(0,l.jsx)("span",{className:"text-xl mb-1",children:"\uD83D\uDC8E"}),(0,l.jsx)("span",{className:"text-sm",children:"充值积分"})]})}),"free"===e.user.userLevel&&(0,l.jsx)(i.default,{href:"/upgrade",children:(0,l.jsxs)(c.z,{variant:"outline",className:"w-full h-16 flex flex-col",children:[(0,l.jsx)("span",{className:"text-xl mb-1",children:"⭐"}),(0,l.jsx)("span",{className:"text-sm",children:"升级"})]})})]})]}),"overview"!==o&&(0,l.jsx)("div",{className:"space-y-4",children:h.length>0?h.map(e=>(0,l.jsx)("div",{className:"border-b pb-4 last:border-b-0",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"font-medium",children:e.description}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:y(e.created_at)})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[e.amount&&(0,l.jsxs)("span",{className:"font-semibold ".concat("checkin"===e.type||"purchase"===e.type?"text-green-600":"text-red-600"),children:["generation"===e.type?"-":"+",e.amount," 积分"]}),w(e.status)]})]})},e.id)):(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCCB"}),(0,l.jsx)("p",{children:"暂无记录"}),(0,l.jsxs)("p",{className:"text-sm mt-2",children:["checkin"===o&&"还没有签到记录，去控制台签到吧","purchase"===o&&"还没有充值记录，去充值积分吧","generation"===o&&"还没有生成记录，去尝试AI试穿吧"]})]})})]})]})]})]})]})}},9055:function(e,s,r){"use strict";r.d(s,{C:function(){return i}});var l=r(7437);r(2265);var a=r(3027),t=r(9354);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 hover:bg-green-200",warning:"border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:"border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:r,...a}=e;return(0,l.jsx)("div",{className:(0,t.cn)(n({variant:r}),s),...a})}},9733:function(e,s,r){"use strict";r.d(s,{z:function(){return d}});var l=r(7437),a=r(2265),t=r(2974),n=r(3027),i=r(9354);let c=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,s)=>{let{className:r,variant:a,size:n,asChild:d=!1,...u}=e,o=d?t.g7:"button";return(0,l.jsx)(o,{className:(0,i.cn)(c({variant:a,size:n,className:r})),ref:s,...u})});d.displayName="Button"},8185:function(e,s,r){"use strict";r.d(s,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return n},aY:function(){return u},ll:function(){return c}});var l=r(7437),a=r(2265),t=r(9354);let n=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,t.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,l.jsx)("h3",{ref:s,className:(0,t.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,l.jsx)("p",{ref:s,className:(0,t.cn)("text-sm text-muted-foreground",r),...a})});d.displayName="CardDescription";let u=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,t.cn)("p-6 pt-0",r),...a})});u.displayName="CardContent",a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,t.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},9354:function(e,s,r){"use strict";r.d(s,{cn:function(){return t}});var l=r(4839),a=r(6164);function t(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.m6)((0,l.W)(s))}}},function(e){e.O(0,[557,998,138,971,23,744],function(){return e(e.s=1474)}),_N_E=e.O()}]);