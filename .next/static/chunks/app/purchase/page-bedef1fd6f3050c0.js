(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{8046:function(e,s,r){Promise.resolve().then(r.bind(r,1102))},6463:function(e,s,r){"use strict";var t=r(1169);r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}})},1102:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return o}});var t=r(7437),a=r(998),n=r(2265),l=r(6463),i=r(9733),c=r(8185),d=r(9055);function o(){let{data:e,status:s}=(0,a.useSession)(),r=(0,l.useRouter)(),[o,x]=(0,n.useState)([]),[u,m]=(0,n.useState)([]),[h,f]=(0,n.useState)(!0),[p,j]=(0,n.useState)(null),[g,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if("unauthenticated"===s){r.push("/auth/signin");return}"authenticated"===s&&(v(),y())},[s,r]);let v=async()=>{try{let e=await fetch("/api/purchase"),s=await e.json();s.success&&x(s.data)}catch(e){console.error("获取积分包失败:",e)}finally{f(!1)}},y=async()=>{try{let e=await fetch("/api/user/history?type=purchase&limit=10"),s=await e.json();s.success&&m(s.data||[])}catch(e){console.error("获取购买历史失败:",e)}},N=e=>{j(e),b(!0)},w=async()=>{if(p)try{let e=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({packageName:p.name,adminNote:"前端购买请求 - 待管理员处理"})}),s=await e.json();s.success?(alert("购买请求已提交！\n包名: ".concat(p.name,"\n积分: ").concat(s.data.creditsAdded,"\n状态: 待处理\n\n请联系管理员完成支付确认。")),b(!1),j(null),y()):alert("提交失败: "+s.message)}catch(e){console.error("提交购买请求失败:",e),alert("提交失败，请稍后重试")}},C=e=>{switch(e){case"completed":return(0,t.jsx)(d.C,{variant:"success",children:"已完成"});case"pending":return(0,t.jsx)(d.C,{variant:"warning",children:"处理中"});case"failed":return(0,t.jsx)(d.C,{variant:"destructive",children:"失败"});default:return(0,t.jsx)(d.C,{variant:"secondary",children:e})}},k=e=>30===e?"\uD83D\uDD25 热门选择":98===e?"⭐ 最超值":6===e?"\uD83D\uDC8E 新手首选":null;return"loading"===s||h?(0,t.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4].map(e=>(0,t.jsx)("div",{className:"h-48 bg-gray-200 rounded"},e))})]})}):(null==e?void 0:e.user)?(0,t.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8 text-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"积分充值"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"选择积分包，享受AI虚拟试穿服务"}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["当前积分: ",(0,t.jsx)("span",{className:"font-semibold text-green-600",children:e.user.credits})]}),(0,t.jsx)("span",{children:"\xb7"}),(0,t.jsxs)("span",{children:["会员等级: ",(0,t.jsx)(d.C,{variant:"pro"===e.user.userLevel?"default":"plus"===e.user.userLevel?"info":"secondary",children:"pro"===e.user.userLevel?"Pro":"plus"===e.user.userLevel?"Plus":"Free"})]})]})]}),g?(0,t.jsxs)(c.Zb,{className:"max-w-md mx-auto",children:[(0,t.jsxs)(c.Ol,{className:"text-center",children:[(0,t.jsx)(c.ll,{children:"确认购买"}),(0,t.jsxs)(c.SZ,{children:["您选择了 ",null==p?void 0:p.name]})]}),(0,t.jsxs)(c.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"套餐名称:"}),(0,t.jsx)("span",{className:"font-medium",children:null==p?void 0:p.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"支付金额:"}),(0,t.jsxs)("span",{className:"font-bold text-green-600",children:["\xa5",null==p?void 0:p.price]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"获得积分:"}),(0,t.jsx)("span",{className:"font-medium",children:null==p?void 0:p.totalCredits})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,t.jsx)("span",{children:"升级等级:"}),(0,t.jsx)(d.C,{variant:"default",children:"Pro用户"})]})]}),(0,t.jsxs)("div",{className:"text-center space-y-3",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"当前采用离线支付方式"}),(0,t.jsxs)("div",{className:"bg-yellow-50 p-3 rounded text-xs text-yellow-800",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"支付流程:"}),(0,t.jsx)("p",{children:"1. 点击“确认购买”提交订单"}),(0,t.jsx)("p",{children:"2. 使用微信/支付宝转账给管理员"}),(0,t.jsx)("p",{children:"3. 联系管理员确认到账"}),(0,t.jsx)("p",{children:"4. 管理员处理后积分自动到账"})]})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(i.z,{variant:"outline",onClick:()=>b(!1),className:"flex-1",children:"返回选择"}),(0,t.jsx)(i.z,{onClick:w,className:"flex-1",children:"确认购买"})]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12",children:o.map((e,s)=>{let r=k(e.price),a=e.bonusCredits>0?Math.round(e.bonusCredits/e.baseCredits*100):0;return(0,t.jsxs)(c.Zb,{className:"relative cursor-pointer transition-all hover:shadow-lg ".concat(98===e.price?"border-2 border-blue-500":"hover:border-gray-300"),onClick:()=>N(e),children:[r&&(0,t.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,t.jsx)(d.C,{variant:"default",className:"text-xs px-2 py-1",children:r})}),(0,t.jsxs)(c.Ol,{className:"text-center pb-2",children:[(0,t.jsx)(c.ll,{className:"text-lg",children:e.name}),(0,t.jsx)(c.SZ,{children:e.description})]}),(0,t.jsxs)(c.aY,{className:"text-center space-y-4",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:["\xa5",e.price]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"基础积分:"}),(0,t.jsx)("span",{children:e.baseCredits})]}),e.bonusCredits>0&&(0,t.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[(0,t.jsx)("span",{children:"赠送积分:"}),(0,t.jsxs)("span",{children:["+",e.bonusCredits]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-semibold border-t pt-2",children:[(0,t.jsx)("span",{children:"总积分:"}),(0,t.jsx)("span",{className:"text-green-600",children:e.totalCredits})]})]}),a>0&&(0,t.jsxs)(d.C,{variant:"success",className:"text-xs",children:["额外赠送 ",a,"%"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["约可生成 ",Math.floor(e.totalCredits/2)," 次单张"]}),(0,t.jsx)(i.z,{className:"w-full",children:"选择此套餐"})]})]},s)})}),(0,t.jsxs)(c.Zb,{className:"mb-8 bg-blue-50",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsx)(c.ll,{className:"text-blue-800",children:"充值说明"})}),(0,t.jsxs)(c.aY,{className:"space-y-2 text-sm text-blue-700",children:[(0,t.jsxs)("p",{children:["• 充值任意积分包自动升级为 ",(0,t.jsx)(d.C,{variant:"default",className:"mx-1",children:"Pro"})," 用户"]}),(0,t.jsx)("p",{children:"• Pro用户享受每日签到、批量生成、最多10件服装等特权"}),(0,t.jsx)("p",{children:"• 当前采用离线支付方式，支付后请联系管理员确认到账"}),(0,t.jsx)("p",{children:"• 积分永不过期，可随时用于AI试穿生成"}),(0,t.jsx)("p",{children:"• 每次单张生成消耗2积分，批量生成消耗20积分"})]})]}),u.length>0&&(0,t.jsxs)(c.Zb,{children:[(0,t.jsxs)(c.Ol,{children:[(0,t.jsx)(c.ll,{children:"购买历史"}),(0,t.jsx)(c.SZ,{children:"您最近的积分充值记录"})]}),(0,t.jsx)(c.aY,{children:(0,t.jsx)("div",{className:"space-y-3",children:u.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:e.package_name}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleString("zh-CN")}),e.admin_note&&(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["备注: ",e.admin_note]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold",children:["+",e.credits_added," 积分"]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["\xa5",e.amount_paid]})]}),C(e.status)]})]},e.id))})})]})]}),(0,t.jsx)(c.Zb,{className:"mt-8 text-center bg-gray-50",children:(0,t.jsxs)(c.aY,{className:"pt-6",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"如有问题请联系客服"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"客服微信: xiaomaogengyi (工作时间: 9:00-18:00)"})]})})]}):null}},9055:function(e,s,r){"use strict";r.d(s,{C:function(){return i}});var t=r(7437);r(2265);var a=r(3027),n=r(9354);let l=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 hover:bg-green-200",warning:"border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:"border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:r,...a}=e;return(0,t.jsx)("div",{className:(0,n.cn)(l({variant:r}),s),...a})}},9733:function(e,s,r){"use strict";r.d(s,{z:function(){return d}});var t=r(7437),a=r(2265),n=r(2974),l=r(3027),i=r(9354);let c=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,s)=>{let{className:r,variant:a,size:l,asChild:d=!1,...o}=e,x=d?n.g7:"button";return(0,t.jsx)(x,{className:(0,i.cn)(c({variant:a,size:l,className:r})),ref:s,...o})});d.displayName="Button"},8185:function(e,s,r){"use strict";r.d(s,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return o},ll:function(){return c}});var t=r(7437),a=r(2265),n=r(9354);let l=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});l.displayName="Card";let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("h3",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});d.displayName="CardDescription";let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",r),...a})});o.displayName="CardContent",a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},9354:function(e,s,r){"use strict";r.d(s,{cn:function(){return n}});var t=r(4839),a=r(6164);function n(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.m6)((0,t.W)(s))}}},function(e){e.O(0,[557,998,971,23,744],function(){return e(e.s=8046)}),_N_E=e.O()}]);